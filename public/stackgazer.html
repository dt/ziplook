<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stackgazer</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EðŸ”%3C/text%3E%3C/svg%3E">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
    </style>
  <script type="module">function Mt(r){const t=r.indexOf("/");return t===-1?!r.startsWith("main"):!r.substring(0,t).includes(".")}function Ft(r,t){if(r.startsWith(t))return!0;if(t.includes("(")||t.includes("[")||t.includes("*")||t.includes("+")||t.includes("?")||t.includes("\\"))try{return new RegExp(t).test(r)}catch{return!1}return!1}function Ht(r,t){if(r.length===0)return"empty";let e="",n=0;for(;n<r.length;){const a=r[n].func;let o=!1;for(const d of t)if("skip"in d&&a.startsWith(d.skip)){n++,o=!0;break}if(o)continue;let s=!1;for(const d of t)if("fold"in d&&Ft(a,d.fold)){if(e.startsWith(d.to)||(e=d.to+(e?" â†’ "+e:"")),n++,d.while)for(;n<r.length;){const h=r[n];let p=!1;for(const f of t)if("skip"in f&&h.func.startsWith(f.skip)){p=!0;break}if(p){n++;continue}let g=!1;if(d.while==="stdlib"&&Mt(h.func))g=!0;else if(d.while!=="stdlib")try{g=new RegExp(d.while).test(h.func)}catch{g=h.func.startsWith(d.while)}if(g)n++;else break}s=!0;break}if(s)continue;let l=a;for(const d of t)if("trim"in d)if(d.trim.startsWith("s/")){const h=d.trim.match(/^s\/(.+)\/(.*)\/$/);if(h)try{const[,p,g]=h,f=new RegExp(p);l=l.replace(f,g)}catch{}}else if(d.trim.startsWith("s|")){const h=d.trim.match(/^s\|(.*)\|([^|]*)\|([gimuy]*)$/);if(h)try{const[,p,g,f]=h,y=new RegExp(p,f||"");l=l.replace(y,g)}catch{}}else l.startsWith(d.trim)&&(l=l.slice(d.trim.length));e.startsWith(l)||(e=l+(e?" â†’ "+e:""));let c=null,u=-1;for(let d=n+1;d<r.length;d++){const h=r[d];for(const p of t)"find"in p&&Ft(h.func,p.find)&&d>u&&(c=p,u=d)}if(c){if(e.startsWith(c.to)||(e=c.to+(e?" â†’ "+e:"")),n=u+1,c.while)for(;n<r.length;){const d=r[n];let h=!1;for(const g of t)if("skip"in g&&d.func.startsWith(g.skip)){h=!0;break}if(h){n++;continue}let p=!1;if(c.while==="stdlib"&&Mt(d.func))p=!0;else if(c.while!=="stdlib")try{p=new RegExp(c.while).test(d.func)}catch{p=d.func.startsWith(c.while)}if(p)n++;else break}continue}return e||(r.length>0?r[r.length-1].func:"")}return e||(r.length>0?r[r.length-1].func:"")}function Ot(r,t){const e=t.indexOf(" --"),n=e!==-1?t.substring(0,e).trim():t,i=n.lastIndexOf("#");let a,o;if(i!==-1){a=n.substring(0,i);const s=n.substring(i+1);o=parseInt(s,10),isNaN(o)&&(o=0)}else a=n,o=1;try{const s=new RegExp(a),l=r.match(s);if(l)return l[o]||l[0]||""}catch(s){console.warn("Invalid match rule pattern:",a,s)}return null}function Tt(r){const t=r.indexOf("/");return t===-1?r:r.substring(0,t)}function Zt(r,t){if(r.length===0)return"<frameless stack>";for(let n=r.length-1;n>=0;n--){const a=r[n].func;if(!t.some(s=>"skip"in s&&a.startsWith(s.skip))){for(const s of t)if("match"in s){const l=Ot(a,s.match);if(l)return l}return Tt(a)}}const e=r[0];return Tt(e.func)}function Yt(r){const t=[];for(const e of r)t.push(e.func),t.push("".concat(e.file,":").concat(e.line));return t.join(" ").toLowerCase()}class Xt{constructor(t){this.categories=[],this.stackForTraceId=new Map,this.parsedFiles=new Map,this.currentFilter="",this.nextGroupId=1,this.nextFileId=1,this.nextCategoryId=1,this.goroutinesByID=new Map,this.goroutineToCategory=new Map,this.settings=t}generateStackName(t){return Ht(t,this.settings.titleManipulationRules)}generateCategoryName(t){return Zt(t,this.settings.categoryRules)}processFrame(t){const e={...t};for(const n of this.settings.functionPrefixesToTrim){const i=e.func.match(n);i&&(e.func=e.func.substring(i[0].length))}for(const n of this.settings.filePrefixesToTrim){const i=e.file.match(n);i&&(e.file=e.file.substring(i[0].length))}return e}processFrames(t){return t.map(e=>this.processFrame(e))}importParsedFile(t,e,n){const i="f".concat(this.nextFileId++);for(const a of t.groups){const o="s".concat(a.traceId);let{category:s,stack:l}=this.stackForTraceId.get(a.traceId)||{};if(!l){const d=this.processFrames(a.trace);l={id:o,name:this.generateStackName(d),trace:d,searchableText:Yt(d),pinned:!1,counts:{total:0,matches:0,visibilityChanged:!1,filterMatches:0,pinned:0,minWait:1/0,maxWait:-1/0,minMatchingWait:1/0,maxMatchingWait:-1/0,potentialMatches:0,states:new Map,matchingStates:new Map},files:[]}}if(!s){const d=this.generateCategoryName(l.trace);s=this.categories.find(h=>h.name===d),s||(s={id:"cat".concat(this.nextCategoryId++),name:d,stacks:[],pinned:!1,counts:{total:0,matches:0,visibilityChanged:!1,filterMatches:0,pinned:0,minWait:1/0,maxWait:-1/0,minMatchingWait:1/0,maxMatchingWait:-1/0,potentialMatches:0,states:new Map,matchingStates:new Map}},this.categories.push(s)),s.stacks.push(l),this.stackForTraceId.set(a.traceId,{category:s,stack:l})}const c={id:"g".concat(this.nextGroupId++),labels:a.labels,pinned:!1,counts:{total:a.count,matches:a.count,visibilityChanged:!1,filterMatches:a.count,pinned:0,minWait:1/0,maxWait:-1/0,minMatchingWait:1/0,maxMatchingWait:-1/0,potentialMatches:a.count,states:new Map,matchingStates:new Map},goroutines:a.goroutines.map(d=>{const h=a.labels.find(g=>g.startsWith("state=")),p=h?h.split("=")[1]:a.labels[0]||"unknown";return{...d,matches:!0,pinned:!1,stack:l,state:p}})};if(c.goroutines.length===0&&c.counts.total>0){const d=this.extractStateFromGroupLabels(c);c.counts.states.set(d,c.counts.total),c.counts.matchingStates.set(d,c.counts.total)}for(const d of c.goroutines)n&&(d.id="".concat(e,".").concat(d.id),d.creator!==""&&(d.creator="".concat(e,".").concat(d.creator)),d.created=d.created.map(h=>"".concat(e,".").concat(h))),this.goroutinesByID.set(d.id,d),this.goroutineToCategory.set(d.id,s);for(const d of c.goroutines){d.waitMinutes<c.counts.minWait&&(c.counts.minWait=d.waitMinutes),d.waitMinutes>c.counts.maxWait&&(c.counts.maxWait=d.waitMinutes),d.waitMinutes<c.counts.minMatchingWait&&(c.counts.minMatchingWait=d.waitMinutes),d.waitMinutes>c.counts.maxMatchingWait&&(c.counts.maxMatchingWait=d.waitMinutes);const h=c.counts.states.get(d.state)||0;c.counts.states.set(d.state,h+1);const p=c.counts.matchingStates.get(d.state)||0;c.counts.matchingStates.set(d.state,p+1)}let u=l.files.find(d=>d.fileId===i);if(!u)u={id:"s".concat(l.id,"-").concat(i),fileId:i,fileName:e,groups:[c],pinned:!1,counts:{total:c.counts.total,matches:c.counts.matches,visibilityChanged:!1,filterMatches:c.counts.filterMatches,pinned:0,minWait:c.counts.minWait,maxWait:c.counts.maxWait,minMatchingWait:c.counts.minMatchingWait,maxMatchingWait:c.counts.maxMatchingWait,potentialMatches:c.counts.potentialMatches,states:new Map(c.counts.states),matchingStates:new Map(c.counts.matchingStates)}},l.files.push(u);else{u.groups.push(c),u.counts.total+=c.counts.total,u.counts.matches+=c.counts.matches,u.counts.filterMatches+=c.counts.filterMatches,c.counts.minWait<u.counts.minWait&&(u.counts.minWait=c.counts.minWait),c.counts.maxWait>u.counts.maxWait&&(u.counts.maxWait=c.counts.maxWait),c.counts.minMatchingWait<u.counts.minMatchingWait&&(u.counts.minMatchingWait=c.counts.minMatchingWait),c.counts.maxMatchingWait>u.counts.maxMatchingWait&&(u.counts.maxMatchingWait=c.counts.maxMatchingWait);for(const[d,h]of c.counts.states){const p=u.counts.states.get(d)||0;u.counts.states.set(d,p+h)}for(const[d,h]of c.counts.matchingStates){const p=u.counts.matchingStates.get(d)||0;u.counts.matchingStates.set(d,p+h)}}l.counts.total+=c.counts.total,l.counts.matches+=c.counts.matches,l.counts.filterMatches+=c.counts.filterMatches,c.counts.minWait<l.counts.minWait&&(l.counts.minWait=c.counts.minWait),c.counts.maxWait>l.counts.maxWait&&(l.counts.maxWait=c.counts.maxWait),c.counts.minMatchingWait<l.counts.minMatchingWait&&(l.counts.minMatchingWait=c.counts.minMatchingWait),c.counts.maxMatchingWait>l.counts.maxMatchingWait&&(l.counts.maxMatchingWait=c.counts.maxMatchingWait);for(const[d,h]of c.counts.states){const p=l.counts.states.get(d)||0;l.counts.states.set(d,p+h)}for(const[d,h]of c.counts.matchingStates){const p=l.counts.matchingStates.get(d)||0;l.counts.matchingStates.set(d,p+h)}s.counts.total+=c.counts.total,s.counts.matches+=c.counts.matches,s.counts.filterMatches+=c.counts.filterMatches,c.counts.minWait<s.counts.minWait&&(s.counts.minWait=c.counts.minWait),c.counts.maxWait>s.counts.maxWait&&(s.counts.maxWait=c.counts.maxWait),c.counts.minMatchingWait<s.counts.minMatchingWait&&(s.counts.minMatchingWait=c.counts.minMatchingWait),c.counts.maxMatchingWait>s.counts.maxMatchingWait&&(s.counts.maxMatchingWait=c.counts.maxMatchingWait);for(const[d,h]of c.counts.states){const p=s.counts.states.get(d)||0;s.counts.states.set(d,p+h)}for(const[d,h]of c.counts.matchingStates){const p=s.counts.matchingStates.get(d)||0;s.counts.matchingStates.set(d,p+h)}}this.categories.sort((a,o)=>a.name.localeCompare(o.name));for(const a of this.categories){a.stacks.sort((o,s)=>o.name.localeCompare(s.name));for(const o of a.stacks){const s=/^n(\d+)$/;o.files.every(c=>s.test(c.fileName))?o.files.sort((c,u)=>{const d=parseInt(c.fileName.match(s)[1],10),h=parseInt(u.fileName.match(s)[1],10);return d-h}):o.files.sort((c,u)=>c.fileName.localeCompare(u.fileName))}}}getCategories(){return this.categories}getGoroutineByID(t){return this.goroutinesByID.get(t)}getFileNames(){const t=Array.from(this.parsedFiles.keys()),e=/^n(\d+)$/;return t.every(i=>e.test(i))?t.sort((i,a)=>{const o=parseInt(i.match(e)[1],10),s=parseInt(a.match(e)[1],10);return o-s}):t.sort()}lookupGoroutine(t){const e=this.goroutinesByID.get(t);return e?{...e}:void 0}addFile(t,e){if(this.parsedFiles.size==1){const i=this.parsedFiles.keys().next().value;this.renameFile(i,i,!0)}const n=e||t.extractedName||t.originalName;this.parsedFiles.set(n,t),this.importParsedFile(t,n,this.parsedFiles.size>1)}removeFile(t){if(!this.parsedFiles.has(t))return!1;if(this.parsedFiles.delete(t),this.categories=this.categories.filter(e=>(e.stacks=e.stacks.filter(n=>(n.files=n.files.filter(i=>i.fileName===t?(i.groups.forEach(a=>{a.goroutines.forEach(o=>{this.goroutinesByID.delete(o.id),this.goroutineToCategory.delete(o.id)})}),!1):!0),n.files.length===0?!1:(n.counts.matches=n.files.reduce((i,a)=>i+a.counts.matches,0),n.counts.total=n.files.reduce((i,a)=>i+a.counts.total,0),n.counts.filterMatches=n.files.reduce((i,a)=>i+a.counts.filterMatches,0),!0))),e.stacks.length===0?!1:(e.counts.matches=e.stacks.reduce((n,i)=>n+i.counts.matches,0),e.counts.total=e.stacks.reduce((n,i)=>n+i.counts.total,0),e.counts.filterMatches=e.stacks.reduce((n,i)=>n+i.counts.filterMatches,0),!0))),this.rebuildStackForTraceIdMap(),this.parsedFiles.size===1){const e=this.getFileNames()[0];this.renameFile(e,e,!1)}return!0}rebuildStackForTraceIdMap(){this.stackForTraceId.clear();for(const t of this.categories)for(const e of t.stacks){const n=e.id.substring(1);this.stackForTraceId.set(n,{category:t,stack:e})}}renameFile(t,e,n){const i=this.parsedFiles.get(t);i&&(this.removeFile(t),this.parsedFiles.set(e,i),this.importParsedFile(i,e,n))}updateTitleRules(t){this.settings.titleManipulationRules=t,this.updateSettings(this.settings)}updateSettings(t){this.settings=t;const e=[];for(const[n,i]of this.parsedFiles)e.push({name:n,data:i});this.categories=[],this.parsedFiles.clear(),this.goroutinesByID.clear(),this.goroutineToCategory.clear(),this.stackForTraceId.clear(),this.nextGroupId=1,this.nextFileId=1,this.nextCategoryId=1;for(const n of e)this.addFile(n.data,n.name)}setFilter(t){this.currentFilter=t.filterString.trim().toLowerCase();const e=this.currentFilter===""?null:this.currentFilter;for(const n of this.categories){n.counts.minMatchingWait=1/0,n.counts.maxMatchingWait=-1/0,n.counts.matchingStates.clear();for(const i of n.stacks){if(i.counts.minMatchingWait=1/0,i.counts.maxMatchingWait=-1/0,i.counts.matchingStates.clear(),e==null||i.searchableText.includes(e)){if(t.minWait===void 0&&t.maxWait===void 0&&t.states===void 0&&t.excludedFiles===void 0){i.counts.matches=i.counts.total,i.counts.filterMatches=i.counts.total,i.counts.minMatchingWait=i.counts.minWait,i.counts.maxMatchingWait=i.counts.maxWait,i.counts.matchingStates=new Map(i.counts.states);for(const o of i.files){o.counts.matches=o.counts.total,o.counts.filterMatches=o.counts.total,o.counts.minMatchingWait=o.counts.minWait,o.counts.maxMatchingWait=o.counts.maxWait,o.counts.matchingStates=new Map(o.counts.states);for(const s of o.groups){this.setGroupVisibility(s,s.counts.total,o,i,n),s.counts.filterMatches=s.counts.total,s.counts.minMatchingWait=s.counts.minWait,s.counts.maxMatchingWait=s.counts.maxWait,s.counts.matchingStates=new Map(s.counts.states);for(const l of s.goroutines)this.setGoroutineVisibility(l,!0,s,o,i,n)}}}else{i.counts.matches=0,i.counts.filterMatches=0,i.counts.minMatchingWait=1/0,i.counts.maxMatchingWait=-1/0,i.counts.matchingStates.clear();for(const o of i.files){o.counts.matches=0,o.counts.filterMatches=0,o.counts.potentialMatches=0,o.counts.minMatchingWait=1/0,o.counts.maxMatchingWait=-1/0,o.counts.matchingStates.clear();for(const s of o.groups){this.setGroupVisibility(s,0,o,i,n),s.counts.filterMatches=0,s.counts.minMatchingWait=1/0,s.counts.maxMatchingWait=-1/0,s.counts.matchingStates.clear();for(const l of s.goroutines){let c=(t.minWait===void 0||l.waitMinutes>=t.minWait)&&(t.maxWait===void 0||l.waitMinutes<=t.maxWait),u=t.states===void 0||t.states.has(l.state),d=c&&u,h=t.excludedFiles===void 0||!t.excludedFiles.has(o.fileName);d&&!h&&o.counts.potentialMatches++,this.setGoroutineVisibility(l,d&&h,s,o,i,n),l.matches&&(s.counts.matches++,s.counts.filterMatches++,[s.counts,o.counts,i.counts].forEach(p=>{l.waitMinutes<p.minMatchingWait&&(p.minMatchingWait=l.waitMinutes),l.waitMinutes>p.maxMatchingWait&&(p.maxMatchingWait=l.waitMinutes);const g=p.matchingStates.get(l.state)||0;p.matchingStates.set(l.state,g+1)}))}s.goroutines.length===0&&s.counts.total>0&&(t.excludedFiles===void 0||!t.excludedFiles.has(o.fileName)?(this.setGroupVisibility(s,s.counts.total,o,i,n),s.counts.filterMatches=s.counts.total,s.counts.minMatchingWait=s.counts.minWait,s.counts.maxMatchingWait=s.counts.maxWait,s.counts.matchingStates=new Map(s.counts.states)):o.counts.potentialMatches+=s.counts.total),s.counts.matches===0&&(s.counts.minMatchingWait=1/0,s.counts.maxMatchingWait=-1/0)}o.counts.matches=o.groups.reduce((s,l)=>s+l.counts.matches,0),o.counts.filterMatches=o.groups.reduce((s,l)=>s+l.counts.filterMatches,0),o.counts.matches===0&&(o.counts.minMatchingWait=1/0,o.counts.maxMatchingWait=-1/0)}i.counts.matches=i.files.reduce((o,s)=>o+s.counts.matches,0),i.counts.filterMatches=i.files.reduce((o,s)=>o+s.counts.filterMatches,0),i.counts.matches===0&&(i.counts.minMatchingWait=1/0,i.counts.maxMatchingWait=-1/0)}if(i.pinned){i.counts.pinned=i.counts.total;for(const o of i.files){o.counts.pinned=o.counts.total;for(const s of o.groups)s.counts.pinned=s.counts.total}}else{i.counts.pinned=0;for(const o of i.files){if(o.pinned){o.counts.pinned=o.counts.total;for(const s of o.groups)s.counts.pinned=s.counts.total}else{o.counts.pinned=0;for(const s of o.groups)s.pinned?s.counts.pinned=s.counts.total:s.counts.pinned=s.goroutines.filter(l=>l.pinned).length,o.counts.pinned+=s.counts.pinned}i.counts.pinned+=o.counts.pinned}}}else{i.counts.matches=0,i.counts.filterMatches=0;for(const o of i.files){o.counts.matches=0,o.counts.filterMatches=0,o.counts.potentialMatches=0,o.counts.minMatchingWait=1/0,o.counts.maxMatchingWait=-1/0,o.counts.matchingStates.clear();for(const s of o.groups){if(s.labels.some(c=>c.toLowerCase().includes(e)))if(t.minWait===void 0&&t.maxWait===void 0&&t.states===void 0&&t.excludedFiles===void 0){s.counts.matches=s.counts.total,s.counts.filterMatches=s.counts.total,s.counts.minMatchingWait=s.counts.minWait,s.counts.maxMatchingWait=s.counts.maxWait,s.counts.matchingStates=new Map(s.counts.states);for(const c of s.goroutines)this.setGoroutineVisibility(c,!0,s,o,i,n)}else{this.setGroupVisibility(s,0,o,i,n),s.counts.filterMatches=0,s.counts.minMatchingWait=1/0,s.counts.maxMatchingWait=-1/0,s.counts.matchingStates.clear();for(const c of s.goroutines){let u=(t.minWait===void 0||c.waitMinutes>=t.minWait)&&(t.maxWait===void 0||c.waitMinutes<=t.maxWait),d=t.states===void 0||t.states.has(c.state),h=u&&d,p=t.excludedFiles===void 0||!t.excludedFiles.has(o.fileName);if(h&&!p&&o.counts.potentialMatches++,this.setGoroutineVisibility(c,h&&p,s,o,i,n),c.matches){s.counts.matches++,s.counts.filterMatches++,c.waitMinutes<s.counts.minMatchingWait&&(s.counts.minMatchingWait=c.waitMinutes),c.waitMinutes>s.counts.maxMatchingWait&&(s.counts.maxMatchingWait=c.waitMinutes);const g=s.counts.matchingStates.get(c.state)||0;s.counts.matchingStates.set(c.state,g+1)}}s.goroutines.length===0&&s.counts.total>0&&(t.excludedFiles===void 0||!t.excludedFiles.has(o.fileName)?(this.setGroupVisibility(s,s.counts.total,o,i,n),s.counts.filterMatches=s.counts.total,s.counts.minMatchingWait=s.counts.minWait,s.counts.maxMatchingWait=s.counts.maxWait,s.counts.matchingStates=new Map(s.counts.states)):o.counts.potentialMatches+=s.counts.total),s.counts.matches===0&&(s.counts.minMatchingWait=1/0,s.counts.maxMatchingWait=-1/0)}else{const c=s.pinned||o.pinned||i.pinned||n.pinned;this.setGroupVisibility(s,0,o,i,n),s.counts.filterMatches=0,s.counts.minMatchingWait=1/0,s.counts.maxMatchingWait=-1/0,s.counts.matchingStates.clear();for(const u of s.goroutines){let d=e==null||u.id.includes(e),h=(t.minWait===void 0||u.waitMinutes>=t.minWait)&&(t.maxWait===void 0||u.waitMinutes<=t.maxWait),p=t.states===void 0||t.states.has(u.state),g=d&&h&&p,f=t.excludedFiles===void 0||!t.excludedFiles.has(o.fileName);if(g&&!f&&o.counts.potentialMatches++,this.setGoroutineVisibility(u,g&&f,s,o,i,n),u.matches)s.counts.filterMatches++,s.counts.matches++;else if(c||u.pinned||t.forcedGoroutine&&u.id===t.forcedGoroutine){let y=t.excludedFiles===void 0||!t.excludedFiles.has(o.fileName);this.setGoroutineVisibility(u,y,s,o,i,n),s.counts.matches++}if(u.matches){u.waitMinutes<s.counts.minMatchingWait&&(s.counts.minMatchingWait=u.waitMinutes),u.waitMinutes>s.counts.maxMatchingWait&&(s.counts.maxMatchingWait=u.waitMinutes);const y=s.counts.matchingStates.get(u.state)||0;s.counts.matchingStates.set(u.state,y+1)}}if(s.counts.matches===0&&(s.counts.minMatchingWait=1/0,s.counts.maxMatchingWait=-1/0),s.goroutines.length===0&&s.counts.total>0){let u=t.excludedFiles===void 0||!t.excludedFiles.has(o.fileName);c&&u?(this.setGroupVisibility(s,s.counts.total,o,i,n),s.counts.minMatchingWait=s.counts.minWait,s.counts.maxMatchingWait=s.counts.maxWait,s.counts.matchingStates=new Map(s.counts.states)):c&&!u&&(o.counts.potentialMatches+=s.counts.total)}s.pinned?s.counts.pinned=s.counts.total:s.counts.pinned=s.goroutines.filter(u=>u.pinned).length}if(s.counts.matches>0){s.counts.minMatchingWait<o.counts.minMatchingWait&&(o.counts.minMatchingWait=s.counts.minMatchingWait),s.counts.maxMatchingWait>o.counts.maxMatchingWait&&(o.counts.maxMatchingWait=s.counts.maxMatchingWait);for(const[c,u]of s.counts.matchingStates){const d=o.counts.matchingStates.get(c)||0;o.counts.matchingStates.set(c,d+u)}}o.counts.matches+=s.counts.matches,o.counts.filterMatches+=s.counts.filterMatches}if(o.counts.matches>0){o.counts.minMatchingWait<i.counts.minMatchingWait&&(i.counts.minMatchingWait=o.counts.minMatchingWait),o.counts.maxMatchingWait>i.counts.maxMatchingWait&&(i.counts.maxMatchingWait=o.counts.maxMatchingWait);for(const[s,l]of o.counts.matchingStates){const c=i.counts.matchingStates.get(s)||0;i.counts.matchingStates.set(s,c+l)}}i.counts.matches+=o.counts.matches,i.counts.filterMatches+=o.counts.filterMatches}if(i.counts.matches===0&&(i.counts.minMatchingWait=1/0,i.counts.maxMatchingWait=-1/0),i.pinned&&i.counts.matches===0&&(i.counts.matches=i.counts.total,i.counts.minMatchingWait=i.counts.minWait,i.counts.maxMatchingWait=i.counts.maxWait,i.counts.matchingStates=new Map(i.counts.states)),i.pinned){i.counts.pinned=i.counts.total;for(const o of i.files){o.counts.pinned=o.counts.total;for(const s of o.groups)s.counts.pinned=s.counts.total}}else{i.counts.pinned=0;for(const o of i.files){if(o.pinned){o.counts.pinned=o.counts.total;for(const s of o.groups)s.counts.pinned=s.counts.total}else{o.counts.pinned=0;for(const s of o.groups)s.pinned?s.counts.pinned=s.counts.total:s.counts.pinned=s.goroutines.filter(l=>l.pinned).length,o.counts.pinned+=s.counts.pinned}i.counts.pinned+=o.counts.pinned}}}if(i.counts.matches>0){i.counts.minMatchingWait<n.counts.minMatchingWait&&(n.counts.minMatchingWait=i.counts.minMatchingWait),i.counts.maxMatchingWait>n.counts.maxMatchingWait&&(n.counts.maxMatchingWait=i.counts.maxMatchingWait);for(const[o,s]of i.counts.matchingStates){const l=n.counts.matchingStates.get(o)||0;n.counts.matchingStates.set(o,l+s)}}}if(n.stacks.every(i=>i.counts.matches===0)&&(n.counts.minMatchingWait=1/0,n.counts.maxMatchingWait=-1/0),n.counts.matches=n.stacks.reduce((i,a)=>i+a.counts.matches,0),n.counts.filterMatches=n.stacks.reduce((i,a)=>i+a.counts.filterMatches,0),n.pinned){n.counts.pinned=n.counts.total;for(const i of n.stacks){i.counts.pinned=i.counts.total;for(const a of i.files){a.counts.pinned=a.counts.total;for(const o of a.groups)o.counts.pinned=o.counts.total}}}else n.counts.pinned=n.stacks.reduce((i,a)=>i+a.counts.pinned,0)}}setGoroutineVisibility(t,e,n,i,a,o){const s=t.matches;t.matches=e,s!==e&&(n.counts.visibilityChanged=!0,i.counts.visibilityChanged=!0,a.counts.visibilityChanged=!0,o.counts.visibilityChanged=!0)}setGroupVisibility(t,e,n,i,a){const o=t.counts.matches;t.counts.matches=e;const s=o>0,l=e>0;s!==l&&(t.counts.visibilityChanged=!0,n.counts.visibilityChanged=!0,i.counts.visibilityChanged=!0,a.counts.visibilityChanged=!0)}clearFilter(){return this.setFilter({filterString:""})}toggleCategoryPin(t){const e=this.categories.find(n=>n.id===t);return e?(e.pinned=!e.pinned,e.pinned):!1}toggleStackPin(t){for(const e of this.categories){const n=e.stacks.find(i=>i.id===t);if(n)return n.pinned=!n.pinned,n.pinned}return!1}toggleGroupPin(t){for(const e of this.categories)for(const n of e.stacks)for(const i of n.files){const a=i.groups.find(o=>o.id===t);if(a)return a.pinned=!a.pinned,a.pinned}return!1}toggleGoroutinePin(t){const e=this.goroutinesByID.get(t);return e?(e.pinned=!e.pinned,e.pinned):!1}toggleStackPinWithChildren(t){return this.categories.forEach(e=>{const n=e?.stacks.find(i=>i.id===t);if(n){const i=!n.pinned;n.pinned=i;for(const a of n.files)for(const o of a.groups){o.pinned=i;for(const s of o.goroutines)s.pinned=i}}}),!1}toggleGroupPinWithChildren(t){for(const e of this.categories)for(const n of e.stacks)for(const i of n.files){const a=i.groups.find(o=>o.id===t);if(a){const o=!a.pinned;a.pinned=o;for(const s of a.goroutines)s.pinned=o;return o}}return!1}toggleCategoryPinWithChildren(t){const e=this.categories.find(n=>n.id===t);if(e){const n=!e.pinned;e.pinned=n;for(const i of e.stacks){i.pinned=n;for(const a of i.files)for(const o of a.groups){o.pinned=n;for(const s of o.goroutines)s.pinned=n}}return n}return!1}unpinAllItems(){for(const t of this.categories)t.pinned=!1;for(const t of this.categories)for(const e of t.stacks){e.pinned=!1;for(const n of e.files){n.pinned=!1;for(const i of n.groups){i.pinned=!1;for(const a of i.goroutines)a.pinned=!1}}}}hasAnyPinnedItems(){for(const t of this.categories){if(t.pinned)return!0;for(const e of t.stacks){if(e.pinned)return!0;for(const n of e.files){if(n.pinned)return!0;for(const i of n.groups){if(i.pinned)return!0;for(const a of i.goroutines)if(a.pinned)return!0}}}}return!1}getCurrentFilter(){return this.currentFilter}getStackStatistics(){let t=0,e=0,n=0,i=0,a=0;return this.categories.forEach(o=>{n+=o.counts.total,i+=o.counts.matches,t+=o.stacks.length,e+=o.stacks.filter(s=>s.counts.matches>0).length,a+=o.counts.pinned}),{total:t,visible:e,totalGoroutines:n,visibleGoroutines:i,pinnedGoroutines:a}}clear(){this.categories=[],this.parsedFiles.clear(),this.goroutinesByID.clear(),this.goroutineToCategory.clear(),this.stackForTraceId.clear(),this.currentFilter="",this.nextGroupId=1,this.nextFileId=1,this.nextCategoryId=1}getFileStatistics(){const t=new Map;for(const e of this.categories)for(const n of e.stacks)for(const i of n.files){t.has(i.fileName)||t.set(i.fileName,{visible:0,total:0,potential:0});const a=t.get(i.fileName);a.total+=i.counts.total,a.visible+=i.counts.matches,a.potential+=i.counts.potentialMatches}return t}getStateStatistics(){const t=new Map;for(const e of this.categories)for(const[n,i]of e.counts.states){const a=t.get(n)||{visible:0,total:0};a.total+=i,t.set(n,a)}for(const e of this.categories)for(const[n,i]of e.counts.matchingStates){const a=t.get(n);a&&(a.visible+=i)}return t}extractStateFromGroupLabels(t){for(const e of t.labels)if(e.startsWith("state="))return e.substring(6);return"unspecified"}getCategoryForGoroutine(t){return this.goroutineToCategory.get(t)}}var H=function(r,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(r):n?n.value:t.get(r)},$,j;/*!
 * Private helpers. These are only used by other helpers.
 */const Wt=2n**32n-1n,yt=2**32-1,At=yt+1,Kt=typeof Buffer>"u"?r=>new TextEncoder().encode(r):r=>Buffer.from(r,"utf8");function Pt(r){if(!r.length)return 0;let t=0;for(;t<r.length&&r[t++]>=128;);return t}function $t(r){if(!r.length)return BigInt(0);let t=BigInt(r[0]&127),e=0;for(;r[e++]>=128;)t|=BigInt(r[e]&127)<<BigInt(7*e);return t}function ht(r,t=0){return{value:r,offset:t}}function jt(r,t){switch(r){case te:for(let e=0;e<t.length;e++)if(!(t[e]&128))return ht(t.slice(0,e+1));return ht(t);case ee:{const e=Pt(t),n=F(t);return ht(t.slice(e,Number(n)+e),e)}default:throw new Error("Unrecognized value type: ".concat(r))}}function Jt(r){return typeof r!="bigint"?(r>>>0)%At:Number(r&Wt)}function Qt(r){return typeof r!="bigint"?r/At>>>0:Number(r>>32n&Wt)}function Dt(r){const t=r<0;t&&(r=-r);let e=Jt(r),n=Qt(r);return t&&(n=~n>>>0,e=~e>>>0,++e>yt&&(e=0,++n>yt&&(n=0))),[n,e]}const te=0,ee=2;function F(r){if(Pt(r)>4)return $t(r);if(!r.length)return 0;let e=r[0]&127,n=0;for(;r[n++]>=128;)e|=(r[n]&127)<<7*n;return e}function wt(r){const t=[];let e=0;for(let n=0;n<r.length;n++)(r[n]&128)===0&&(t.push(F(r.slice(e,n+1))),e=n+1);return t}function Z(r,t){return t==null?[r]:(t.push(r),t)}function tt(r){if(r===0||r===0n)return 0;const[t,e]=Dt(r),n=e,i=(e>>>28|t<<4)>>>0,a=t>>>24;return a!==0?a<128?9:10:i!==0?i<16384?i<128?5:6:i<2097152?7:8:n<16384?n<128?1:2:n<2097152?3:4}function Rt(r){return typeof r>"u"?0:typeof r=="number"||typeof r=="bigint"?tt(r)||1:r.length}function St(r){let t=0;for(const e of r)t+=Rt(e);return t}function I(r){const t=tt(r);return t?1+t:0}function vt(r){let t=0;for(const e of r)t+=tt(e)||1;return t?1+tt(t)+t:0}function Gt(r){const t=Rt(r);return t?1+tt(t)+t:0}function Y(r){let t=0;for(const e of r)t+=Gt(e);return t}function C(r,t,e){if(e===0||e===0n)return r[t++]=0,t;let[n,i]=Dt(e);for(;n;)r[t++]=i&127|128,i=(i>>>7|n<<25)>>>0,n>>>=7;for(;i>127;)r[t++]=i&127|128,i=i>>>7;return r[t++]=i,t}const _t=Symbol();class Q{constructor(t){this.strings=new Array,$.set(this,new Array),j.set(this,new Map),t!==_t&&this.dedup("")}get encodedLength(){let t=0;for(const e of H(this,$,"f"))t+=e.length;return t}_encodeToBuffer(t,e){for(const n of H(this,$,"f"))t.set(n,e),e+=n.length;return e}encode(t=new Uint8Array(this.encodedLength)){return this._encodeToBuffer(t,0),t}static _encodeStringFromUtf8(t){const e=new Uint8Array(1+t.length+(tt(t.length)||1));let n=0;return e[n++]=50,n=C(e,n,t.length),t.length>0&&e.set(t,n++),e}static _encodeString(t){return Q._encodeStringFromUtf8(Kt(t))}dedup(t){if(typeof t=="number")return t;if(!H(this,j,"f").has(t)){const e=this.strings.push(t)-1;H(this,j,"f").set(t,e),H(this,$,"f").push(Q._encodeString(t))}return H(this,j,"f").get(t)}_decodeString(t){const e=new TextDecoder().decode(t);H(this,j,"f").set(e,this.strings.push(e)-1),H(this,$,"f").push(Q._encodeStringFromUtf8(t))}}$=new WeakMap,j=new WeakMap;function O(r,t){const e={};let n=0;for(;n<r.length;){const i=r[n]>>3,a=r[n]&7;n++;const{offset:o,value:s}=jt(a,r.slice(n));n+=s.length+o,t(e,i,s)}return e}class X{static create(t){return t instanceof X?t:new X(t)}constructor(t){this.type=t.type||0,this.unit=t.unit||0}get length(){let t=0;return t+=I(this.type),t+=I(this.unit),t}_encodeToBuffer(t,e=0){return this.type&&(t[e++]=8,e=C(t,e,this.type)),this.unit&&(t[e++]=16,e=C(t,e,this.unit)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.type=F(n);break;case 2:t.unit=F(n);break}}static decode(t){return new this(O(t,this.decodeValue))}}class et{static create(t){return t instanceof et?t:new et(t)}constructor(t){this.key=t.key||0,this.str=t.str||0,this.num=t.num||0,this.numUnit=t.numUnit||0}get length(){let t=0;return t+=I(this.key),t+=I(this.str),t+=I(this.num),t+=I(this.numUnit),t}_encodeToBuffer(t,e=0){return this.key&&(t[e++]=8,e=C(t,e,this.key)),this.str&&(t[e++]=16,e=C(t,e,this.str)),this.num&&(t[e++]=24,e=C(t,e,this.num)),this.numUnit&&(t[e++]=32,e=C(t,e,this.numUnit)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.key=F(n);break;case 2:t.str=F(n);break;case 3:t.num=F(n);break;case 4:t.numUnit=F(n);break}}static decode(t){return new this(O(t,this.decodeValue))}}class nt{static create(t){return t instanceof nt?t:new nt(t)}constructor(t){this.locationId=t.locationId||[],this.value=t.value||[],this.label=(t.label||[]).map(et.create)}get length(){let t=0;return t+=vt(this.locationId),t+=vt(this.value),t+=Y(this.label),t}_encodeToBuffer(t,e=0){if(this.locationId.length){t[e++]=10,e=C(t,e,St(this.locationId));for(const n of this.locationId)e=C(t,e,n)}if(this.value.length){t[e++]=18,e=C(t,e,St(this.value));for(const n of this.value)e=C(t,e,n)}for(const n of this.label)t[e++]=26,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.locationId=wt(n);break;case 2:t.value=wt(n);break;case 3:t.label=Z(et.decode(n),t.label);break}}static decode(t){return new this(O(t,this.decodeValue))}}class it{static create(t){return t instanceof it?t:new it(t)}constructor(t){this.id=t.id||0,this.memoryStart=t.memoryStart||0,this.memoryLimit=t.memoryLimit||0,this.fileOffset=t.fileOffset||0,this.filename=t.filename||0,this.buildId=t.buildId||0,this.hasFunctions=!!t.hasFunctions,this.hasFilenames=!!t.hasFilenames,this.hasLineNumbers=!!t.hasLineNumbers,this.hasInlineFrames=!!t.hasInlineFrames}get length(){let t=0;return t+=I(this.id),t+=I(this.memoryStart),t+=I(this.memoryLimit),t+=I(this.fileOffset),t+=I(this.filename),t+=I(this.buildId),t+=I(this.hasFunctions?1:0),t+=I(this.hasFilenames?1:0),t+=I(this.hasLineNumbers?1:0),t+=I(this.hasInlineFrames?1:0),t}_encodeToBuffer(t,e=0){return this.id&&(t[e++]=8,e=C(t,e,this.id)),this.memoryStart&&(t[e++]=16,e=C(t,e,this.memoryStart)),this.memoryLimit&&(t[e++]=24,e=C(t,e,this.memoryLimit)),this.fileOffset&&(t[e++]=32,e=C(t,e,this.fileOffset)),this.filename&&(t[e++]=40,e=C(t,e,this.filename)),this.buildId&&(t[e++]=48,e=C(t,e,this.buildId)),this.hasFunctions&&(t[e++]=56,e=C(t,e,1)),this.hasFilenames&&(t[e++]=64,e=C(t,e,1)),this.hasLineNumbers&&(t[e++]=72,e=C(t,e,1)),this.hasInlineFrames&&(t[e++]=80,e=C(t,e,1)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.id=F(n);break;case 2:t.memoryStart=F(n);break;case 3:t.memoryLimit=F(n);break;case 4:t.fileOffset=F(n);break;case 5:t.filename=F(n);break;case 6:t.buildId=F(n);break;case 7:t.hasFunctions=!!F(n);break;case 8:t.hasFilenames=!!F(n);break;case 9:t.hasLineNumbers=!!F(n);break;case 10:t.hasInlineFrames=!!F(n);break}}static decode(t){return new this(O(t,this.decodeValue))}}class st{static create(t){return t instanceof st?t:new st(t)}constructor(t){this.functionId=t.functionId||0,this.line=t.line||0}get length(){let t=0;return t+=I(this.functionId),t+=I(this.line),t}_encodeToBuffer(t,e=0){return this.functionId&&(t[e++]=8,e=C(t,e,this.functionId)),this.line&&(t[e++]=16,e=C(t,e,this.line)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.functionId=F(n);break;case 2:t.line=F(n);break}}static decode(t){return new this(O(t,this.decodeValue))}}class ot{static create(t){return t instanceof ot?t:new ot(t)}constructor(t){this.id=t.id||0,this.mappingId=t.mappingId||0,this.address=t.address||0,this.line=(t.line||[]).map(st.create),this.isFolded=!!t.isFolded}get length(){let t=0;return t+=I(this.id),t+=I(this.mappingId),t+=I(this.address),t+=Y(this.line),t+=I(this.isFolded?1:0),t}_encodeToBuffer(t,e=0){this.id&&(t[e++]=8,e=C(t,e,this.id)),this.mappingId&&(t[e++]=16,e=C(t,e,this.mappingId)),this.address&&(t[e++]=24,e=C(t,e,this.address));for(const n of this.line)t[e++]=34,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return this.isFolded&&(t[e++]=40,e=C(t,e,1)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.id=F(n);break;case 2:t.mappingId=F(n);break;case 3:t.address=F(n);break;case 4:t.line=Z(st.decode(n),t.line);break;case 5:t.isFolded=!!F(n);break}}static decode(t){return new this(O(t,this.decodeValue))}}class at{static create(t){return t instanceof at?t:new at(t)}constructor(t){this.id=t.id||0,this.name=t.name||0,this.systemName=t.systemName||0,this.filename=t.filename||0,this.startLine=t.startLine||0}get length(){let t=0;return t+=I(this.id),t+=I(this.name),t+=I(this.systemName),t+=I(this.filename),t+=I(this.startLine),t}_encodeToBuffer(t,e=0){return this.id&&(t[e++]=8,e=C(t,e,this.id)),this.name&&(t[e++]=16,e=C(t,e,this.name)),this.systemName&&(t[e++]=24,e=C(t,e,this.systemName)),this.filename&&(t[e++]=32,e=C(t,e,this.filename)),this.startLine&&(t[e++]=40,e=C(t,e,this.startLine)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.id=F(n);break;case 2:t.name=F(n);break;case 3:t.systemName=F(n);break;case 4:t.filename=F(n);break;case 5:t.startLine=F(n);break}}static decode(t){return new this(O(t,this.decodeValue))}}class ne{constructor(t={}){this.sampleType=(t.sampleType||[]).map(X.create),this.sample=(t.sample||[]).map(nt.create),this.mapping=(t.mapping||[]).map(it.create),this.location=(t.location||[]).map(ot.create),this.function=(t.function||[]).map(at.create),this.stringTable=t.stringTable||new Q,this.dropFrames=t.dropFrames||0,this.keepFrames=t.keepFrames||0,this.timeNanos=t.timeNanos||0,this.durationNanos=t.durationNanos||0,this.periodType=t.periodType?X.create(t.periodType):void 0,this.period=t.period||0,this.comment=t.comment||[],this.defaultSampleType=t.defaultSampleType||0}get length(){let t=0;return t+=Y(this.sampleType),t+=Y(this.sample),t+=Y(this.mapping),t+=Y(this.location),t+=Y(this.function),t+=this.stringTable.encodedLength,t+=I(this.dropFrames),t+=I(this.keepFrames),t+=I(this.timeNanos),t+=I(this.durationNanos),t+=Gt(this.periodType),t+=I(this.period),t+=vt(this.comment),t+=I(this.defaultSampleType),t}_encodeSampleTypesToBuffer(t,e=0){for(const n of this.sampleType)t[e++]=10,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}_encodeSamplesToBuffer(t,e=0){for(const n of this.sample)t[e++]=18,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}_encodeMappingsToBuffer(t,e=0){for(const n of this.mapping)t[e++]=26,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}_encodeLocationsToBuffer(t,e=0){for(const n of this.location)t[e++]=34,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}_encodeFunctionsToBuffer(t,e=0){for(const n of this.function)t[e++]=42,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}_encodeBasicValuesToBuffer(t,e=0){if(this.dropFrames&&(t[e++]=56,e=C(t,e,this.dropFrames)),this.keepFrames&&(t[e++]=64,e=C(t,e,this.keepFrames)),this.timeNanos&&(t[e++]=72,e=C(t,e,this.timeNanos)),this.durationNanos&&(t[e++]=80,e=C(t,e,this.durationNanos)),typeof this.periodType<"u"&&(t[e++]=90,e=C(t,e,this.periodType.length),e=this.periodType._encodeToBuffer(t,e)),this.period&&(t[e++]=96,e=C(t,e,this.period)),this.comment.length){t[e++]=106,e=C(t,e,St(this.comment));for(const n of this.comment)e=C(t,e,n)}return this.defaultSampleType&&(t[e++]=112,e=C(t,e,this.defaultSampleType)),e}_encodeToBuffer(t,e=0){return e=this._encodeSampleTypesToBuffer(t,e),e=this._encodeSamplesToBuffer(t,e),e=this._encodeMappingsToBuffer(t,e),e=this._encodeLocationsToBuffer(t,e),e=this._encodeFunctionsToBuffer(t,e),e=this.stringTable._encodeToBuffer(t,e),e=this._encodeBasicValuesToBuffer(t,e),e}async _encodeToBufferAsync(t,e=0){return e=this._encodeSampleTypesToBuffer(t,e),await new Promise(setImmediate),e=this._encodeSamplesToBuffer(t,e),await new Promise(setImmediate),e=this._encodeMappingsToBuffer(t,e),await new Promise(setImmediate),e=this._encodeLocationsToBuffer(t,e),await new Promise(setImmediate),e=this._encodeFunctionsToBuffer(t,e),await new Promise(setImmediate),e=this.stringTable._encodeToBuffer(t,e),await new Promise(setImmediate),e=this._encodeBasicValuesToBuffer(t,e),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}async encodeAsync(t=new Uint8Array(this.length)){return await this._encodeToBufferAsync(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.sampleType=Z(X.decode(n),t.sampleType);break;case 2:t.sample=Z(nt.decode(n),t.sample);break;case 3:t.mapping=Z(it.decode(n),t.mapping);break;case 4:t.location=Z(ot.decode(n),t.location);break;case 5:t.function=Z(at.decode(n),t.function);break;case 6:{t.stringTable===void 0&&(t.stringTable=new Q(_t)),t.stringTable._decodeString(n);break}case 7:t.dropFrames=F(n);break;case 8:t.keepFrames=F(n);break;case 9:t.timeNanos=F(n);break;case 10:t.durationNanos=F(n);break;case 11:t.periodType=X.decode(n);break;case 12:t.period=F(n);break;case 13:t.comment=wt(n);break;case 14:t.defaultSampleType=F(n);break}}static decode(t){return new this(O(t,this.decodeValue))}}function ie(r){let t=2166136261;for(let e=0;e<r.length;e++)t^=r.charCodeAt(e),t*=16777619,t=t>>>0;return t.toString(16).padStart(8,"0")}async function mt(r){const t=r.map(s=>"".concat(s.func," ").concat(s.file,":").concat(s.line)).join("\n");if(!globalThis.crypto?.subtle){const s=ie(t);return(s+s+s).slice(0,24)}const n=new TextEncoder().encode(t),i=await globalThis.crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(s=>s.toString(16).padStart(2,"0")).join("").slice(-24)}class se{constructor(t){this.nameExtractionPatterns=t?.nameExtractionPatterns||[]}async parseFile(t,e){const n=await t.slice(0,2).arrayBuffer(),i=new Uint8Array(n),a=i.length>=2&&i[0]===31&&i[1]===139;let o=e||"unknown";if(/^\d+$/.test(o)&&(o="n"+o),a)return await this.parseFormat0(t,o);{const s=await t.text();return this.parseString(s,o)}}async parseString(t,e){return t.trim()?this.detectFormat1(t)?await this.parseFormat1(t,e):this.detectFormat2(t)?await this.parseFormat2(t,e):{success:!0,data:{originalName:e,groups:[]}}:{success:!0,data:{originalName:e,groups:[]}}}extractNameFromLine(t){for(const e of this.nameExtractionPatterns)try{if(!e.startsWith("s|"))continue;const n=e.slice(2).split("|");if(n.length<2)continue;const i=n[0],a=n[1],o=new RegExp(i),s=t.match(o);if(s){let l=a;if(l.startsWith("hex:"))l=l.slice(4),l=l.replace("$1",parseInt(s[1],16).toString());else for(let c=0;c<s.length;c++)l=l.replace("$".concat(c),s[c]||"");return l}}catch{continue}return null}detectFormat1(t){return t.startsWith("goroutine profile:")}detectFormat2(t){const e=t.trim();return/^goroutine \d+ (\[|gp=)/.test(e)||/\ngoroutine \d+ (\[|gp=)/.test(t)}extractGoroutineFromLabels(t){let e=null,n="",i="",a=0;const o=[];for(const c of t){const[u,d]=c.split("=",2);switch(u){case"go::goroutine":e=d;break;case"go::goroutine_created_by":n=d;break;case"go::goroutine_state":i=d;break;case"go::goroutine_wait_minutes":a=parseFloat(d)||0;break;default:o.push(c);break}}if(e===null)return null;const s=this.transformState(i);return{goroutine:{id:e,state:s,waitMinutes:a,creator:n,creatorExists:!1,created:[]},filteredLabels:o}}async parseFormat0(t,e){try{const n=t.stream().pipeThrough(new DecompressionStream("gzip")),a=await new Response(n).arrayBuffer(),o=new Uint8Array(a),s=ne.decode(o),l=[],c=[];for(const h of s.sample){const p=[],g=h.value||[],f=g.length>0?Number(g[0]):1,y=[],w=s.stringTable?.strings||[];if(h.label)for(const v of h.label){const M=w[Number(v.key)||0]||"";let k;v.num!==void 0&&v.num!==0?k=String(Number(v.num)):k=w[Number(v.str)||0]||"",M&&k?y.push("".concat(M,"=").concat(k)):M&&y.push(M)}let x=!0,S=null;for(const v of h.locationId||[]){const M=s.location.find(k=>k.id===v);if(M)for(const k of M.line||[]){const b=s.function.find(B=>B.id===k.functionId);if(b){const B=w[Number(b.name)||0]||"unknown",A=w[Number(b.filename)||0]||"unknown";if(x&&this.shouldSkipRuntimeFrame(B)){S=B;continue}x=!1,p.push({func:B,file:A,line:Number(k.line)||0})}}}if(p.length>0){const v=await mt(p);if(!y.some(b=>b.startsWith("go::goroutine=")))if(S){const b=this.synthesizeRuntimeLabel(S);b&&y.push(b)}else p[0]&&this.isSyscallFrame(p[0].func)&&y.push("state=syscall");const k=this.extractGoroutineFromLabels(y);k?c.push({traceId:v,trace:p,goroutine:k.goroutine,labels:k.filteredLabels}):l.push({traceId:v,count:f,labels:y,goroutines:[],trace:p})}}if(c.length>0){const h=new Map,p=new Map,g=new Map;for(const f of c){p.set(f.goroutine.id,!0);const y=f.goroutine.creator;y&&(g.get(y)??g.set(y,[]).get(y)).push(f.goroutine.id)}for(const f of c){const y=f.labels.slice().sort().join(","),w="".concat(f.traceId,":").concat(f.goroutine.state,":").concat(y);h.has(w)||h.set(w,{trace:f.trace,goroutines:[],labels:["state=".concat(f.goroutine.state),...f.labels]}),h.get(w).goroutines.push(f.goroutine)}for(const[f,y]of h){const w=f.split(":")[0];l.push({traceId:w,count:y.goroutines.length,labels:y.labels,goroutines:y.goroutines,trace:y.trace})}l.forEach(f=>f.goroutines.forEach(y=>{y.creatorExists=y.creator?p.has(y.creator):!1,y.created=g.get(y.id)??[]}))}let u=null;for(const h of l){for(const p of h.labels){const g=this.extractNameFromLine(p);if(g){u=g;break}}if(u)break}return{success:!0,data:{originalName:u||e,groups:l}}}catch(n){return{success:!1,error:"Failed to parse pprof format: ".concat(n instanceof Error?n.message:String(n))}}}async parseFormat2(t,e){const n=t.split("\n"),i=new Map,a=new Map,o=[];let s=null,l=0;for(;l<n.length;){const h=n[l].trim();if(s||(s=this.extractNameFromLine(h)),!h.startsWith("goroutine ")){l++;continue}let p=h.match(/^goroutine (\d+) \[([^\]]+)\]:/);if(p||(p=h.match(/^goroutine (\d+) gp=\S+ m=\S+(?:\s+mp=\S+)? \[([^\]]+)\]:/)),!p){l++;continue}const[,g,f]=p,y=parseInt(g),w=f.split(",").map(L=>L.trim()),x=[];let S=0;for(;S<w.length;){let L=w[S];if(L.startsWith('"')&&!L.endsWith('"'))for(;S+1<w.length&&(S++,L+=","+w[S],!w[S].endsWith('"')););x.push(L),S++}const v=x[0];let M=0;const k=[];for(let L=1;L<x.length;L++){const R=x[L],E=R.match(/^"([^"]+)":"([^"]+)"$/);if(E){const[,W,T]=E;k.push("".concat(W,"=").concat(T));continue}const D=R.match(/^(\d+(?:\.\d+)?)\s*minutes?$/);D?M=parseFloat(D[1]):R&&k.push(R)}l++;const b=[];let B="";for(;l<n.length&&n[l].trim();){const L=n[l].trim();if(s||(s=this.extractNameFromLine(L)),L.startsWith("created by ")){const R=L.match(/created by .+ in goroutine (\d+)/);B=R?R[1]:"",l++;break}if(L&&!L.startsWith("	")){const R=L.match(/^(.+)(\(.*\))$/);let E;if(R?E=R[1]:E=L,l++,l<n.length&&n[l].startsWith("	")){const W=n[l].trim().match(/^(.+?):(\d+)/);if(W){const[,T,N]=W,z=parseInt(N);b.push({func:E,file:T,line:z})}}}l++}const A=this.transformState(v),_=String(y),q={id:_,state:A,waitMinutes:M,creator:B,creatorExists:!1,created:[]};i.set(_,!0),(a.get(B)??a.set(B,[]).get(B)).push(_),o.push({goroutine:q,trace:b,labels:k})}const c=new Map;for(const{goroutine:h,trace:p,labels:g}of o){const f=await mt(p),y=g.slice().sort().join(","),w="".concat(f,":").concat(h.state,":").concat(y);if(!c.has(w)){const x=["state=".concat(h.state)];x.push(...g),c.set(w,{trace:p,goroutines:[],labels:x})}c.get(w).goroutines.push(h)}const u=[];for(const[h,{trace:p,goroutines:g,labels:f}]of c){const y=h.split(":")[0];u.push({traceId:y,count:g.length,labels:f,goroutines:g,trace:p})}u.forEach(h=>h.goroutines.forEach(p=>{p.creatorExists=p.creator?i.has(p.creator):!1,p.created=a.get(p.id)??[]}));const d={originalName:e,groups:u};return s&&(d.extractedName=/^\d+$/.test(s)?"n"+s:s),{success:!0,data:d}}async parseFormat1(t,e){const n=t.split("\n"),i=[];let a=0,o=null;const l=n[0]?.trim()?.match(/goroutine profile: total (\d+)/);l&&(a=parseInt(l[1]));let c=0;for(;c<n.length;){const d=n[c].trim();o||(o=this.extractNameFromLine(d));const h=d.match(/^(\d+) @/)||d.match(/^(\d+) goroutines? in stack:/);if(!h){c++;continue}const p=parseInt(h[1]);c++;const g=[];for(;c<n.length;){const y=n[c].trim();if(o||(o=this.extractNameFromLine(y)),y.startsWith("# labels:")){const w=y.match(/# labels:\s*({.*})/);if(w)try{const x=JSON.parse(w[1]);g.push(...Object.entries(x).map(([S,v])=>"".concat(S,"=").concat(v)))}catch{return{success:!1,error:"Failed to parse labels: ".concat(w[1])}}c++;continue}break}const f=[];for(;c<n.length;){const y=n[c].trim();if(o||(o=this.extractNameFromLine(y)),!y.startsWith("#")||y==="#")break;const w=y.match(/^#\s*0x[0-9a-f]+\s+([^\s]+)\s+(.+?):(\d+)/);if(w){let[,x,S,v]=w;x=x.replace(/\+0x[0-9a-fA-F]+$/,"");const M=parseInt(v);f.push({func:x,file:S,line:M})}c++}i.push({traceId:await mt(f),count:p,labels:g,goroutines:[],trace:f})}const u={originalName:e,totalGoroutines:a,groups:i};return o&&(u.extractedName=/^\d+$/.test(o)?"n"+o:o),{success:!0,data:u}}transformState(t){return t==="sync.WaitGroup.Wait"||t==="sync.Cond.Wait"?"wait":t==="sync.Mutex.Lock"?"semacquire":t}shouldSkipRuntimeFrame(t){return t==="runtime.gopark"||t==="runtime.goparkunlock"||t==="runtime.selectgo"||t==="runtime.chanrecv"||t==="runtime.chanrecv1"||t==="runtime.chanrecv2"||t==="runtime.chansend"||t==="runtime.semacquire"||t==="runtime.semacquire1"||t==="runtime.netpollblock"||t==="runtime.notetsleepg"||t==="runtime.sigNoteSleep"}isSyscallFrame(t){return t==="syscall.syscall6"||t==="syscall.Syscall"||t==="syscall.Syscall6"||t==="syscall.RawSyscall"||t==="syscall.RawSyscall6"}synthesizeRuntimeLabel(t){switch(t){case"runtime.chanrecv":case"runtime.chanrecv1":case"runtime.chanrecv2":return"state=chan receive";case"runtime.chansend":return"state=chan send";case"runtime.selectgo":return"state=select";case"runtime.gopark":case"runtime.goparkunlock":return"state=parked";case"runtime.semacquire":case"runtime.semacquire1":return"state=semacquire";case"runtime.netpollblock":return"state=netpoll";case"runtime.notetsleepg":return"state=sleep";case"runtime.sigNoteSleep":return"state=signal";default:return null}}}class It{static isZipFile(t){return t.name.toLowerCase().endsWith(".zip")||t.type==="application/zip"}static async readFileChunk(t,e,n){return await t.slice(e,e+n).arrayBuffer()}static async extractFiles(t,e=[/^(.*\/)?stacks\.txt$/]){if(typeof globalThis.DecompressionStream>"u")throw new Error("DecompressionStream is required by this app.");const n=t.size,i=Math.min(n,65558),a=await this.readFileChunk(t,n-i,i),o=new DataView(a),s=101010256,l=101075792,c=117853008,u=22;let d=-1;for(let E=a.byteLength-u;E>=0;E--)if(o.getUint32(E,!0)===s){d=E;break}if(d<0)throw new Error("ZIP: EOCD not found");const h=o.getUint16(d+4,!0),p=o.getUint16(d+6,!0);if(h!==0||p!==0)throw new Error("ZIP: multi-disk archives are not supported");let g=o.getUint16(d+10,!0),f=o.getUint32(d+12,!0),y=o.getUint32(d+16,!0);if(g===65535||f===4294967295||y===4294967295){let E=-1;for(let N=d-20;N>=Math.max(0,d-200);N--)if(o.getUint32(N,!0)===c){E=N;break}if(E<0)throw new Error("ZIP: ZIP64 EOCD Locator not found");const D=o.getUint32(E+8,!0)+o.getUint32(E+12,!0)*4294967296,W=await this.readFileChunk(t,D,56),T=new DataView(W);if(T.getUint32(0,!0)!==l)throw new Error("ZIP: Invalid ZIP64 EOCD signature");g=T.getUint32(32,!0),f=T.getUint32(40,!0)+T.getUint32(44,!0)*4294967296,y=T.getUint32(48,!0)+T.getUint32(52,!0)*4294967296}const x=await this.readFileChunk(t,y,f),S=new DataView(x),v=new Uint8Array(x),M=33639248,k=[];let b=0;const B=f,A=new TextDecoder("utf-8");for(;b<B&&k.length<g;){if(S.getUint32(b,!0)!==M)throw new Error("ZIP: bad central directory signature");const E=S.getUint16(b+8,!0),D=S.getUint16(b+10,!0);let W=S.getUint32(b+20,!0),T=S.getUint32(b+24,!0);const N=S.getUint16(b+28,!0),z=S.getUint16(b+30,!0),zt=S.getUint16(b+32,!0);let ut=S.getUint32(b+42,!0);const rt=b+46,bt=v.subarray(rt,rt+N),Ut=(E&2048)!==0?A.decode(bt):String.fromCharCode(...bt);let Ct=!1;const Et=rt+N;let V=Et;const qt=Et+z;for(;V<qt-4;){const Vt=S.getUint16(V,!0),lt=S.getUint16(V+2,!0);if(Vt===1){Ct=!0;let G=V+4;T===4294967295&&G+8<=V+4+lt&&(T=S.getUint32(G,!0)+S.getUint32(G+4,!0)*4294967296,G+=8),W===4294967295&&G+8<=V+4+lt&&(W=S.getUint32(G,!0)+S.getUint32(G+4,!0)*4294967296,G+=8),ut===4294967295&&G+8<=V+4+lt&&(ut=S.getUint32(G,!0)+S.getUint32(G+4,!0)*4294967296,G+=8);break}V+=4+lt}k.push({filename:Ut,method:D,flags:E,compSize:W,uncompSize:T,lfhOffset:ut,hasZip64Extra:Ct}),b=rt+N+z+zt}const _=67324752,q=async E=>{const D=await this.readFileChunk(t,E,30),W=new DataView(D);if(W.getUint32(0,!0)!==_)throw new Error("ZIP: bad local file header");const T=W.getUint16(26,!0),N=W.getUint16(28,!0);return E+30+T+N},L=[];let R=0;for(const E of k){if(!e.some(N=>N.test(E.filename)))continue;if(E.method!==0&&E.method!==8)throw new Error("ZIP: unsupported compression method ".concat(E.method," for ").concat(E.filename));const D=await q(E.lfhOffset),W=t.slice(D,D+E.compSize);let T;if(E.method===0)T=W;else{const N=new DecompressionStream("deflate-raw"),z=W.stream().pipeThrough(N);T=await new Response(z).blob()}L.push({path:E.filename,content:T}),R=R+E.uncompSize}return{files:L,totalSize:R}}}function m(r,t,...e){const n=document.createElement(r);if(t)for(const[i,a]of Object.entries(t))i==="className"?n.className=String(a):i==="contentEditable"?n.contentEditable=String(a):n.setAttribute(i,String(a));return e.forEach(i=>{typeof i=="string"?n.appendChild(document.createTextNode(i)):i instanceof HTMLElement&&n.appendChild(i)}),n}function P(r){return{content:{cloneNode:(t=!0)=>{const e=document.createDocumentFragment();return e.appendChild(r.cloneNode(!0)),e},firstElementChild:r}}}const oe=m("div",{className:"section expandable category-section"},m("div",{className:"header"},m("div",{className:"category-title"}),m("div",{className:"header-right"},m("div",{className:"category-count counts"}),m("div",{className:"category-stats"})),m("button",{className:"pin-button size-large"},"ðŸ“Œ")),m("div",{className:"section-content category-content"})),ae=m("div",{className:"section expandable stack-section"},m("div",{className:"header"},m("div",{className:"stack-title"}),m("div",{className:"header-right"},m("div",{className:"stack-count counts"}),m("div",{className:"stack-stats"})),m("button",{className:"pin-button size-large"},"ðŸ“Œ"),m("button",{className:"copy-button size-large"},"ðŸ“‹")),m("div",{className:"section-content stack-content"})),ce=m("div",{className:"section expandable file-section"},m("div",{className:"header"},m("span",{className:"title"},m("span",{className:"expand-icon"}),m("span",{className:"file-name"})),m("span",{className:"counts"})),m("div",{className:"section-content"})),re=m("div",{className:"section expandable group-section"},m("div",{className:"header"},m("span",{className:"title"},m("span",{className:"expand-icon"}),m("span",{className:"group-header-label"})),m("span",{className:"group-header-count counts"}),m("button",{className:"pin-button size-large"},"ðŸ“Œ")),m("div",{className:"section-content"})),le=m("div",{className:"goroutine-entry"},m("button",{className:"pin-button size-small"},"ðŸ“Œ"),m("div",{className:"goroutine-header"},m("div",{className:"goroutine-header-first-line"},m("span",{className:"goroutine-header-left"}),m("span",{className:"goroutine-created-by"})),m("div",{className:"goroutine-header-second-line"}))),de=m("div",{className:"unique-stack-content"}),ue=m("div",{className:"show-more-link"},m("span",{className:"show-more-text"},"Show ",m("span",{className:"show-more-link-clickable"})," more goroutines â–¼")),he=m("div",{className:"file-item"},m("span",{className:"file-name-text",contentEditable:!1}),m("div",{className:"file-stats counts"}),m("button",{className:"file-remove-btn"},"Ã—")),me=m("div",{className:"empty-state"},"Drop files here or click ",m("strong",null,"+")," to add"),pe=m("div",{className:"file-drop-area"},"Drop more files here"),ge=m("div",{className:"drop-message"},m("div",null,"ðŸ“ Drop Goroutine profiles here to get started"),m("div",{className:"demo-add-files"},"text and binary pprof profile formats auto-detected"),m("div",{className:"demo-add-files"},"traceback as file suffix (e.g. a crash log) also supported"),m("div",{className:"demo-add-files"},"all analysis done in-browser â€” nothing is uploaded anywhere"),m("div",{className:"demo-section-divider"},m("div",{className:"demo-try-demo"},"âš¡ï¸ Or try a quick demo with some example CockroachDB stack dumps:"),m("div",{className:"demo-buttons"},m("a",{id:"demoSingleBtn",href:"#",className:"demo-link"},"ðŸ“„ single node goroutine dump â†’"),m("a",{id:"demoZipBtn",href:"#",className:"demo-link"},"ðŸ“¦ zip file of stacks from 4 nodes â†’")))),fe=m("div",{className:"container"},m("button",{className:"narrow-back-btn",id:"narrowBackBtn",style:"display: none;",disabled:!0,title:"Go back to previous goroutine (Alt+â† or Backspace)"},"â†"),m("div",{className:"sidebar-overlay",id:"sidebarOverlay"}),m("button",{className:"narrow-close-btn",id:"narrowCloseBtn",style:"display: none;",title:"Hide sidebar"},"â€¹"),m("div",{className:"sidebar",id:"sidebar"}),m("div",{className:"main-content",id:"mainContent"})),ye=m("div",{className:"sidebar"},m("div",{className:"filter-section file-section"},m("div",{className:"files-header"},m("div",{className:"files-title"},m("h3",null,"Files ",m("button",{className:"add-file-btn",id:"addFileBtn",title:"Add more files"},"+"))),m("button",{className:"clear-all-btn",id:"clearAllBtn",title:"Clear all files"},"Ã—")),m("div",{className:"file-list-container",id:"fileListContainer"},m("div",{className:"file-list",id:"fileList"}))),m("div",{className:"filter-section"},m("div",{className:"filter-header"},m("h3",null,"Filter"),m("button",{className:"clear-all-btn",id:"clearFilterBtn",title:"Clear filter"},"Ã—")),m("input",{type:"text",className:"filter-input",id:"filterInput",placeholder:"e.g. flush wait:>5"}),m("div",{className:"filter-error",id:"filterError",style:"display: none;"})),m("div",{className:"filter-section"},m("h3",null,"Statistics"),m("div",{className:"stats",id:"stats"},m("div",{className:"stats-item"},"Stacks: ",m("span",{id:"stackCounts"},"0 / 0")),m("div",{className:"stats-item"},"Goroutines: ",m("span",{id:"goroutineCounts"},"0 / 0")),m("div",{className:"state-stats",id:"stateStats"}))),m("h3",{className:"narrow-controls-header",style:"display: none;"},"Controls"),m("div",{className:"narrow-controls",style:"display: none;"},m("div",{className:"narrow-controls-row"},m("button",{id:"narrowExpandAllBtn",className:"control-btn"},"Expand All"),m("button",{id:"narrowCollapseAllBtn",className:"control-btn"},"Collapse All")),m("div",{className:"narrow-controls-row"},m("button",{id:"narrowUnpinAllBtn",className:"control-btn"},"Unpin All")),m("div",{className:"narrow-controls-row"},m("select",{id:"narrowStackDisplayModeSelect",className:"narrow-select",title:"Choose how to display stack traces"},m("option",{value:"combined"},"Combined View"),m("option",{value:"side-by-side"},"Side by Side"),m("option",{value:"functions"},"Functions Only"),m("option",{value:"locations"},"Locations Only")))),m("div",{className:"settings-container"},m("a",{href:"https://github.com/dt/stackgazer",target:"_blank",className:"github-btn",title:"View on GitHub",id:"githubBtn"}),m("button",{className:"theme-toggle-btn",id:"themeToggleBtn",title:"Toggle light/dark theme"},"ðŸŒ™"),m("button",{className:"settings-btn",id:"settingsBtn",title:"Advanced Settings"},"âš™ï¸"))),we=m("div",{className:"main-content"},m("div",{className:"view-controls-bar"},m("div",{className:"narrow-filter-container",style:"display: none;"},m("button",{className:"narrow-menu-btn",id:"narrowMenuBtn"},"â˜°"),m("input",{type:"text",className:"narrow-filter-input",id:"narrowFilterInput",placeholder:"Filter stacks (e.g. flush wait:>5)"})),m("div",{className:"left-controls"},m("button",{id:"backBtn",className:"control-btn",disabled:!0,title:"Go back to previous goroutine (Alt+â† or Backspace)"},m("span",{className:"back-text"},"â† Back"))),m("div",{className:"right-controls"},m("select",{id:"stackDisplayModeSelect",title:"Choose how to display stack traces"},m("option",{value:"combined"},"Combined View"),m("option",{value:"side-by-side"},"Side by Side"),m("option",{value:"functions"},"Functions Only"),m("option",{value:"locations"},"Locations Only")),m("button",{id:"unpinAllBtn",className:"control-btn"},"Unpin All"),m("button",{id:"expandAllBtn",className:"control-btn"},"Expand All"),m("button",{id:"collapseAllBtn",className:"control-btn"},"Collapse All"))),m("div",{className:"drop-zone",id:"dropZone"}),m("div",{className:"copy-notification",id:"copyNotification",style:"display: none;"},"ðŸ“‹ Copied to clipboard!")),Se=m("div",{id:"ancestryModal",className:"ancestry-modal modal-visible"},m("div",{className:"ancestry-modal-content"},m("button",{className:"ancestry-modal-close"},"Ã—"),m("div",{className:"ancestry-tree-container"},m("div",{className:"ancestry-zoom-controls"},m("button",{className:"ancestry-zoom-in"},"+"),m("button",{className:"ancestry-zoom-out"},"âˆ’"),m("button",{className:"ancestry-fit-view"},"âŒ–"))))),ve=m("p",{className:"ancestry-empty-state"},"No ancestry data available"),ke=m("div",{className:"loading-overlay",id:"loadingOverlay",style:"display: none;"},m("div",{className:"loading-content"},m("div",{className:"loading-spinner"}),m("div",{className:"loading-message",id:"loadingMessage"},"Processing files..."),m("div",{className:"loading-details",id:"loadingDetails"}),m("div",{className:"loading-progress",id:"loadingProgressContainer",style:"display: none;"},m("div",{className:"loading-progress-indeterminate",id:"loadingProgressBar"}))));function xe(r){return m("div",{className:"setting-section"},m("div",{className:"setting-title"},m("span",{},r.title),m("button",{className:"setting-help-icon","data-tooltip":r.helpTooltip},"?")),m("div",{className:"setting-description"},r.description),m("div",{className:"default-rules-section settings-collapsed"},m("div",{className:"default-rules-header"},m("div",{className:"default-rules-title"},m("span",{className:"expand-icon"},"â–¼"),m("h5",{},"Default Rules")),m("label",{className:"toggle-switch"},m("input",{type:"checkbox",id:"useDefault".concat(r.id),checked:!0}),m("span",{className:"toggle-slider"}))),m("div",{className:"default-rules-content collapsed-settings"},m("textarea",{id:"default".concat(r.id),className:"setting-textarea default-rules-textarea",rows:r.defaultRows,readOnly:!0,placeholder:"Default rules will appear here..."}))),m("div",{className:"custom-rules-section settings-collapsed"},m("div",{className:"custom-rules-header"},m("div",{className:"custom-rules-title"},m("h5",{},"Custom Rules (0)"))),m("div",{className:"custom-rules-content collapsed-settings"},m("textarea",{id:"custom".concat(r.id),className:"setting-textarea",rows:r.customRows,placeholder:r.customPlaceholder||"Add your own rules here..."}))))}const be=m("div",{id:"settingsModal",className:"modal"},m("div",{className:"modal-content"},m("div",{className:"modal-header"},m("h3",null,"Advanced Settings"),m("button",{className:"modal-close",id:"settingsModalCloseBtn"},"Ã—")),m("div",{className:"modal-body",id:"settingsModalBody"}),m("div",{className:"settings-actions"},m("button",{id:"resetSettingsBtn",className:"btn btn-danger settings-reset-btn"},"Reset to Defaults"),m("button",{id:"saveSettingsBtn",className:"btn settings-save-btn"},"Save Settings")))),K={Categorization:{"Skip Rules":{description:"Skip these patterns when categorizing stacks.",tooltip:"One pattern per line. Frames matching these patterns will be ignored when determining category.",settingKey:"categorySkipRules"},"Match Rules":{description:"Extract category names using these patterns.",tooltip:"One pattern per line. Format: s|pattern|replacement| where replacement can use $1, $2, etc. for capture groups.",settingKey:"categoryMatchRules"}},"Stack Naming":{"Skip Rules":{description:"Skip these patterns when naming stacks.",tooltip:"One pattern per line. Frames matching these patterns will be ignored when building stack names.",settingKey:"nameSkipRules"},"Trim Rules":{description:"Trim prefixes or apply regex replacements.",tooltip:"One pattern per line. Format: 'prefix' to remove prefix, or 's|pattern|replacement|' for regex replacement.",settingKey:"nameTrimRules"},"Fold Rules":{description:"Fold frame sequences into concise names.",tooltip:"One rule per line. Format: s|pattern,while-pattern|replacement| where 'while-pattern' specifies what frames to consume after the match.",settingKey:"nameFoldRules"},"Find Rules":{description:"Find patterns in remaining frames and prepend to stack name.",tooltip:"One rule per line. Format: s|pattern,while-pattern|replacement| to scan remaining frames and pull up matching information.",settingKey:"nameFindRules"}},"Fie Parsing":{"Function Trim Prefixes":{description:"Remove these prefixes from function names for cleaner display.",tooltip:"One prefix per line. Example: 'github.com/myorg/' would trim 'github.com/myorg/mypackage.Function' to 'mypackage.Function'",settingKey:"functionTrimPrefixes"},"File Trim Prefixes":{description:"Remove these prefixes from file paths for cleaner display.",tooltip:"One prefix per line. Example: '/go/src/' would trim '/go/src/myproject/main.go' to 'myproject/main.go'",settingKey:"fileTrimPrefixes"},"File Name Extraction":{description:"File name extraction allows automatic file naming during parsing based on content patterns or labels found in stack traces. When a pattern matches, the extracted name becomes the file name instead of the original filename.",tooltip:"Patterns to extract custom file names from stack trace content or labels during parsing. Format: regex pattern with replacement template. Examples: 'tags=([^,\\s]+)' with replacement '$1' extracts 'n1' from 'tags=n1'",settingKey:"nameExtractionPatterns"},"Zip File Path Patterns":{description:"Pattern to identify stack trace files in zip archives.",tooltip:"Regex pattern to match files inside zip archives that should be extracted and parsed as stack trace files. Examples: '^(.*\\/)?stacks\\.txt$', '^logs\\/.*\\.txt$', '^.*\\.log$'",settingKey:"zipFilePatterns"}}},Bt={category:P(oe),stack:P(ae),fileSection:P(ce),group:P(re),goroutine:P(le),stackTrace:P(de),showMore:P(ue),fileItem:P(he),fileEmptyState:P(me),fileDropArea:P(pe),dropZoneEmpty:P(ge),container:P(fe),sidebar:P(ye),mainContent:P(we),settingsModal:P(be),ancestryModal:P(Se),ancestryEmptyState:P(ve),loadingOverlay:P(ke)};function Ce(r){const t=document.createDocumentFragment();return r.forEach(([e,n])=>{const i=document.createElement("div"),a=document.createElement("span");a.textContent=e;const o=document.createElement("span");o.textContent="".concat(n.visible," / ").concat(n.total),i.appendChild(a),i.appendChild(o),t.appendChild(i)}),t}class Ee{constructor(){this.navigationHistory=[],this.expandedGroups=new Set,this.expandedFiles=new Set}addToNavigationHistory(t){return this.navigationHistory.length>0&&this.navigationHistory[this.navigationHistory.length-1]===t?{canGoBack:this.navigationHistory.length>0}:(this.navigationHistory.push(t),{canGoBack:this.navigationHistory.length>0})}navigateBack(){return this.navigationHistory.length===0?{targetGoroutineId:null,canGoBack:!1}:{targetGoroutineId:this.navigationHistory.pop(),canGoBack:this.navigationHistory.length>0}}canNavigateBack(){return this.navigationHistory.length>0}toggleGroupExpansion(t){const e=this.expandedGroups.has(t);return e?this.expandedGroups.delete(t):this.expandedGroups.add(t),{isExpanded:!e}}toggleFileExpansion(t){const e=this.expandedFiles.has(t);return e?this.expandedFiles.delete(t):this.expandedFiles.add(t),{isExpanded:!e}}isGroupExpanded(t){return this.expandedGroups.has(t)}isFileExpanded(t){return this.expandedFiles.has(t)}expandAllGroups(t){return t.forEach(e=>this.expandedGroups.add(e)),{expandedGroups:new Set(this.expandedGroups),expandedFiles:new Set(this.expandedFiles)}}collapseAllGroups(){return this.expandedGroups.clear(),{expandedGroups:new Set(this.expandedGroups),expandedFiles:new Set(this.expandedFiles)}}reset(){this.navigationHistory=[],this.expandedGroups.clear(),this.expandedFiles.clear()}}const Me=["running","runnable","syscall","IO wait","semacquire","select","chan receive","chan send","wait"];function Lt(r){const t=Me.indexOf(r);return t===-1?1/0:t}function pt(r){return r.sort(([t],[e])=>{const n=Lt(t),i=Lt(e);return n!==i?n-i:t.localeCompare(e)})}const Fe={functionTrimPrefixes:[],fileTrimPrefixes:[],categorySkipRules:["runtime.goexit","sync.","internal/","golang.org/x/sync/errgroup","google.golang.org/grpc"],categoryMatchRules:["s|^((([^/.\\[]*\\.[^/\\[]*)*/)?[^/\\.\\[]+(/[^/.\\[]+)?)|$1|"],nameSkipRules:["runtime.gopark","runtime.selectgo","runtime.semacquire1","sync.runtime_notifyListWait","sync.runtime_Semacquire","golang.org/x/sync/errgroup.(*Group).Wait"],nameTrimRules:["s|\\[[^\\]]*\\]||","s|\\.func\\d+(\\.\\d+)?$||","util/","s|^server.\\(\\*Node\\).Batch$|batch|"],nameFoldRules:["s|sync.(*Cond).Wait,|condwait|","s|sync.(*WaitGroup).Wait,|waitgroup|","s|net/http,stdlib|net/http|","s|syscall.Syscall,stdlib|syscall|","s|internal/poll.runtime_pollWait,stdlib|netpoll|","s|google.golang.org/grpc/internal/transport.(*Stream).waitOnHeader,google.golang.org/grpc|grpc|","s|google.golang.org/grpc/internal/transport.(*recvBufferReader).read,(google.golang.org/grpc.*|io.Read)|recv|"],nameFindRules:[],zipFilePatterns:["^(.*/)?stacks.txt$"],nameExtractionPatterns:[]};function U(r,t){const e=[];return t?.ignoreDefault||e.push(...r),t?.custom&&e.push(...t.custom),e}function Nt(r,t){return{functionTrimPrefixes:U(r.functionTrimPrefixes,t.functionTrimPrefixes),fileTrimPrefixes:U(r.fileTrimPrefixes,t.fileTrimPrefixes),zipFilePatterns:U(r.zipFilePatterns,t.zipFilePatterns),categorySkipRules:U(r.categorySkipRules,t.categorySkipRules),categoryMatchRules:U(r.categoryMatchRules,t.categoryMatchRules),nameSkipRules:U(r.nameSkipRules,t.nameSkipRules),nameTrimRules:U(r.nameTrimRules,t.nameTrimRules),nameFoldRules:U(r.nameFoldRules,t.nameFoldRules),nameFindRules:U(r.nameFindRules,t.nameFindRules),nameExtractionPatterns:U(r.nameExtractionPatterns,t.nameExtractionPatterns)}}const J=class J{constructor(t,e){this.storedSettings={},this.changeCallback=null;const n=this.getBuiltinDefaults(),i=t?t(n):n;this.validateAppSettings(i,"customizer"),this.defaultSettings=i,this.settings={...this.defaultSettings},e||this.loadSettings()}getBuiltinDefaults(){return{...Fe}}validateAppSettings(t,e){if(!t||typeof t!="object")throw new Error("".concat(e," must return an object, got ").concat(typeof t));const n=this.getBuiltinDefaults();for(const i in t){if(!(i in n))continue;const a=n[i],o=t[i];if(!this.typesMatch(a,o)){const s=this.getTypeDescription(a),l=this.getTypeDescription(o);let c="";throw s.includes("[]")&&l==="string"&&(c=' If you\'re migrating from the old string format, convert "rule1\\nrule2" to ["rule1", "rule2"]'),new Error("".concat(e,": '").concat(i,"' must be ").concat(s,", got ").concat(l).concat(c))}if(Array.isArray(a)&&Array.isArray(o)&&a.length>0&&typeof a[0]=="string"&&!o.every(s=>typeof s=="string"))throw new Error("".concat(e,": '").concat(i,"' must be string[], but contains non-string items"))}}typesMatch(t,e){if(t==null)return e==null;if(Array.isArray(t)!==Array.isArray(e))return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length===0||e.length===0)return!0;const n=typeof t[0];return e.every(i=>typeof i===n)}return typeof t=="object"&&typeof e=="object"?!0:typeof t==typeof e}getTypeDescription(t){if(t===null)return"null";if(Array.isArray(t)){if(t.length===0)return"array (empty)";const e=typeof t[0];return t.every(n=>typeof n===e)?"".concat(e,"[]"):"mixed[]"}return typeof t}loadSettings(){try{const t=localStorage.getItem(J.STORAGE_KEY);t?this.storedSettings=JSON.parse(t):this.storedSettings={},this.settings=Nt(this.defaultSettings,this.storedSettings)}catch(t){console.warn("Failed to load settings from localStorage:",t),this.storedSettings={},this.settings={...this.defaultSettings}}}saveSettings(){try{localStorage.setItem(J.STORAGE_KEY,JSON.stringify(this.storedSettings))}catch(t){console.warn("Failed to save settings to localStorage:",t)}}getSettings(){return{...this.settings}}updateSetting(t,e){e.ignoreDefault||e.custom&&e.custom.length>0?this.storedSettings[t]=e:delete this.storedSettings[t],this.settings=Nt(this.defaultSettings,this.storedSettings),this.saveSettings(),this.notifyChange()}getStoredSettings(){return{...this.storedSettings}}resetToDefaults(){this.storedSettings={},this.settings={...this.defaultSettings},localStorage.removeItem(J.STORAGE_KEY),this.notifyChange()}onChange(t){this.changeCallback=t}notifyChange(){this.changeCallback&&this.changeCallback(this.getSettings())}importSettings(t){try{const e=JSON.parse(t),n=this.defaultSettings,i=Object.keys(n),a=Object.keys(e);for(const o of a)if(!i.includes(o))throw new Error("Unknown setting: ".concat(o));return this.settings={...n,...e},this.saveSettings(),this.notifyChange(),!0}catch(e){return console.error("Failed to import settings:",e),!1}}getFunctionTrimPrefixes(){return this.parseRegexPrefixes(this.settings.functionTrimPrefixes)}getZipFilePatterns(){return this.parseRegexPrefixes(this.settings.zipFilePatterns)}getFileTrimPrefixes(){return this.parseRegexPrefixes(this.settings.fileTrimPrefixes)}getCategorySkipRules(){return this.settings.categorySkipRules.map(t=>t.trim()).filter(t=>t.length>0)}getCategoryRules(){const t=[],e=this.getCategorySkipRules();for(const i of e)t.push({skip:i});const n=this.settings.categoryMatchRules.map(i=>i.trim()).filter(i=>i.length>0);for(const i of n)if(i.startsWith("s|")){const a=i.match(/^s\|([^|]+)\|([^|]*)\|$/);if(a){const[,o]=a;t.push({match:o})}}else t.push({match:i});return t}parseRegexPrefixes(t){return!t||!Array.isArray(t)?[]:t.map(e=>e.trim()).filter(e=>e.length>0).map(e=>{try{const n=e.startsWith("^")?e:"^".concat(e);return new RegExp(n)}catch(n){console.warn('Invalid regex pattern "'.concat(e,'":'),n);const i=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp("^".concat(i))}})}parseTextRules(t,e){if(!t||!Array.isArray(t))return[];const n=t.map(a=>a.trim()).filter(a=>a.length>0),i=[];for(const a of n)if(a.startsWith("s|")){const o=a.match(/^s\|(.*)\|([^|]*)\|$/);if(o){const[,s,l]=o,c=s.split(","),u=c[0],d=c[1]||void 0;e==="fold"?i.push({fold:u,to:l,while:d}):e==="find"?i.push({find:u,to:l,while:d}):e==="trim"&&i.push({trim:a})}}else e==="skip"?i.push({skip:a}):e==="trim"&&i.push({trim:a});return i}getTitleManipulationRules(){const t=[];return t.push(...this.parseTextRules(this.settings.nameSkipRules,"skip")),t.push(...this.parseTextRules(this.settings.nameTrimRules,"trim")),t.push(...this.parseTextRules(this.settings.nameFoldRules,"fold")),t.push(...this.parseTextRules(this.settings.nameFindRules,"find")),t}getZipFilePatternRegex(){const t=this.settings.zipFilePatterns;return!t||!Array.isArray(t)||t.length===0?[/^(.*\/)?stacks\.txt$/]:t.map(e=>{try{return new RegExp(e)}catch(n){return console.warn('Invalid zip file pattern regex "'.concat(e,'":'),n),/^(.*\/)?stacks\.txt$/}})}getDefaults(){return{...this.defaultSettings}}};J.STORAGE_KEY="stackgazer-settings";let kt=J;function Te(r){var t=0,e=r.children,n=e&&e.length;if(!n)t=1;else for(;--n>=0;)t+=e[n].value;r.value=t}function Ie(){return this.eachAfter(Te)}function Be(r,t){let e=-1;for(const n of this)r.call(t,n,++e,this);return this}function Le(r,t){for(var e=this,n=[e],i,a,o=-1;e=n.pop();)if(r.call(t,e,++o,this),i=e.children)for(a=i.length-1;a>=0;--a)n.push(i[a]);return this}function Ne(r,t){for(var e=this,n=[e],i=[],a,o,s,l=-1;e=n.pop();)if(i.push(e),a=e.children)for(o=0,s=a.length;o<s;++o)n.push(a[o]);for(;e=i.pop();)r.call(t,e,++l,this);return this}function We(r,t){let e=-1;for(const n of this)if(r.call(t,n,++e,this))return n}function Ae(r){return this.eachAfter(function(t){for(var e=+r(t.data)||0,n=t.children,i=n&&n.length;--i>=0;)e+=n[i].value;t.value=e})}function Pe(r){return this.eachBefore(function(t){t.children&&t.children.sort(r)})}function De(r){for(var t=this,e=Re(t,r),n=[t];t!==e;)t=t.parent,n.push(t);for(var i=n.length;r!==e;)n.splice(i,0,r),r=r.parent;return n}function Re(r,t){if(r===t)return r;var e=r.ancestors(),n=t.ancestors(),i=null;for(r=e.pop(),t=n.pop();r===t;)i=r,r=e.pop(),t=n.pop();return i}function Ge(){for(var r=this,t=[r];r=r.parent;)t.push(r);return t}function _e(){return Array.from(this)}function ze(){var r=[];return this.eachBefore(function(t){t.children||r.push(t)}),r}function Ue(){var r=this,t=[];return r.each(function(e){e!==r&&t.push({source:e.parent,target:e})}),t}function*qe(){var r=this,t,e=[r],n,i,a;do for(t=e.reverse(),e=[];r=t.pop();)if(yield r,n=r.children)for(i=0,a=n.length;i<a;++i)e.push(n[i]);while(e.length)}function xt(r,t){r instanceof Map?(r=[void 0,r],t===void 0&&(t=Oe)):t===void 0&&(t=He);for(var e=new ct(r),n,i=[e],a,o,s,l;n=i.pop();)if((o=t(n.data))&&(l=(o=Array.from(o)).length))for(n.children=o,s=l-1;s>=0;--s)i.push(a=o[s]=new ct(o[s])),a.parent=n,a.depth=n.depth+1;return e.eachBefore(Ye)}function Ve(){return xt(this).eachBefore(Ze)}function He(r){return r.children}function Oe(r){return Array.isArray(r)?r[1]:null}function Ze(r){r.data.value!==void 0&&(r.value=r.data.value),r.data=r.data.data}function Ye(r){var t=0;do r.height=t;while((r=r.parent)&&r.height<++t)}function ct(r){this.data=r,this.depth=this.height=0,this.parent=null}ct.prototype=xt.prototype={constructor:ct,count:Ie,each:Be,eachAfter:Ne,eachBefore:Le,find:We,sum:Ae,sort:Pe,path:De,ancestors:Ge,descendants:_e,leaves:ze,links:Ue,copy:Ve,[Symbol.iterator]:qe};function Xe(r,t){return r.parent===t.parent?1:2}function gt(r){var t=r.children;return t?t[0]:r.t}function ft(r){var t=r.children;return t?t[t.length-1]:r.t}function Ke(r,t,e){var n=e/(t.i-r.i);t.c-=n,t.s+=e,r.c+=n,t.z+=e,t.m+=e}function $e(r){for(var t=0,e=0,n=r.children,i=n.length,a;--i>=0;)a=n[i],a.z+=t,a.m+=t,t+=a.s+(e+=a.c)}function je(r,t,e){return r.a.parent===t.parent?r.a:e}function dt(r,t){this._=r,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}dt.prototype=Object.create(ct.prototype);function Je(r){for(var t=new dt(r,0),e,n=[t],i,a,o,s;e=n.pop();)if(a=e._.children)for(e.children=new Array(s=a.length),o=s-1;o>=0;--o)n.push(i=e.children[o]=new dt(a[o],o)),i.parent=e;return(t.parent=new dt(null,0)).children=[t],t}function Qe(){var r=Xe,t=1,e=1,n=null;function i(c){var u=Je(c);if(u.eachAfter(a),u.parent.m=-u.z,u.eachBefore(o),n)c.eachBefore(l);else{var d=c,h=c,p=c;c.eachBefore(function(x){x.x<d.x&&(d=x),x.x>h.x&&(h=x),x.depth>p.depth&&(p=x)});var g=d===h?1:r(d,h)/2,f=g-d.x,y=t/(h.x+g+f),w=e/(p.depth||1);c.eachBefore(function(x){x.x=(x.x+f)*y,x.y=x.depth*w})}return c}function a(c){var u=c.children,d=c.parent.children,h=c.i?d[c.i-1]:null;if(u){$e(c);var p=(u[0].z+u[u.length-1].z)/2;h?(c.z=h.z+r(c._,h._),c.m=c.z-p):c.z=p}else h&&(c.z=h.z+r(c._,h._));c.parent.A=s(c,h,c.parent.A||d[0])}function o(c){c._.x=c.z+c.parent.m,c.m+=c.parent.m}function s(c,u,d){if(u){for(var h=c,p=c,g=u,f=h.parent.children[0],y=h.m,w=p.m,x=g.m,S=f.m,v;g=ft(g),h=gt(h),g&&h;)f=gt(f),p=ft(p),p.a=c,v=g.z+x-h.z-y+r(g._,h._),v>0&&(Ke(je(g,c,d),c,v),y+=v,w+=v),x+=g.m,y+=h.m,S+=f.m,w+=p.m;g&&!ft(p)&&(p.t=g,p.m+=x-w),h&&!gt(f)&&(f.t=h,f.m+=y-S,d=c)}return d}function l(c){c.x*=t,c.y=c.depth*e}return i.separation=function(c){return arguments.length?(r=c,i):r},i.size=function(c){return arguments.length?(n=!1,t=+c[0],e=+c[1],i):n?null:[t,e]},i.nodeSize=function(c){return arguments.length?(n=!0,t=+c[0],e=+c[1],i):n?[t,e]:null},i}class tn{constructor(t,e){this.filterInputValue="",this.stackDisplayMode="combined",this.hiddenFiles=new Set,this.filterDebounceTimer=null,this.loadingDelayTimer=null,this.currentTheme="dark",this.initialTheme=void 0,this.settingsManager=new kt(e),this.appState=new Ee;const n=this.settingsManager.getSettings(),i=this.convertToProfileCollectionSettings(n);this.profileCollection=new Xt(i),this.parser=new se({nameExtractionPatterns:i.nameExtractionPatterns}),window.debugProfileCollection=this.profileCollection,window.debugApp=this,this.settingsManager.onChange(a=>{this.onSettingsChanged(a)}),this.initializeTemplates(),this.init(t)}init(t){if(this.container=document.getElementById(t),!this.container)throw new Error('Container element with ID "'.concat(t,'" not found'));this.createAppStructure(),this.initializeUI(),this.initializeTheme(),this.loadUIState(),this.updateUnpinButtonVisibility(),this.createTooltip()}initializeTemplates(){this.templates=Bt}createAppStructure(){if(!this.container)throw new Error("Container not initialized. Call init() first.");const e=this.templates.container.content.cloneNode(!0).firstElementChild,i=this.templates.sidebar.content.cloneNode(!0).firstElementChild,o=this.templates.mainContent.content.cloneNode(!0).firstElementChild,l=this.templates.settingsModal.content.cloneNode(!0).firstElementChild,u=this.templates.loadingOverlay.content.cloneNode(!0).firstElementChild,d=e.querySelector("#sidebar"),h=e.querySelector("#mainContent");d&&h&&(d.replaceWith(i),h.replaceWith(o)),this.container.appendChild(e),this.container.appendChild(l),this.container.appendChild(u)}initializeUI(){this.clearUrlAnchor(),this.setupEventListeners(),this.updateDropZone(),this.setupNavigationHistory();const t=document.querySelector(".main-content");t&&t.classList.add("filtered")}loadUIState(){const t=localStorage.getItem("stacktrace-filter");if(t){this.filterInputValue=t;const n=document.getElementById("filterInput"),i=document.getElementById("narrowFilterInput");n&&(n.value=t),i&&(i.value=t),this.setFilter({filterString:t})}const e=localStorage.getItem("stacktrace-display-mode");if(e&&["combined","side-by-side","functions","locations"].includes(e)){this.stackDisplayMode=e;const n=document.getElementById("stackDisplayModeSelect"),i=document.getElementById("narrowStackDisplayModeSelect");n&&(n.value=e),i&&(i.value=e),this.updateStackDisplayMode(this.stackDisplayMode)}}saveUIState(){localStorage.setItem("stacktrace-filter",this.filterInputValue),localStorage.setItem("stacktrace-display-mode",this.stackDisplayMode)}openFileDialog(){const t=document.createElement("input");t.type="file",t.accept=".txt,.log",t.multiple=!0,t.onchange=e=>{const n=e.target.files;n&&n.length>0&&this.handleFiles(Array.from(n))},t.click()}setupEventListeners(){const t=document.getElementById("filterInput");t&&t.addEventListener("input",v=>{const M=v.target.value;this.filterInputValue=M,this.debouncedSetFilter(M),this.syncFilterInputs()});const e=document.getElementById("clearFilterBtn");e&&e.addEventListener("click",()=>{this.clearFilter()});const n=document.getElementById("clearAllBtn");n&&n.addEventListener("click",()=>{this.clearAllFiles()});const i=document.getElementById("expandAllBtn");i&&i.addEventListener("click",()=>{this.expandAllStacks()});const a=document.getElementById("collapseAllBtn");a&&a.addEventListener("click",()=>{this.collapseAllStacks()});const o=document.getElementById("unpinAllBtn");o&&o.addEventListener("click",()=>{this.unpinAllItems()});const s=document.getElementById("addFileBtn");s&&s.addEventListener("click",()=>{this.openFileDialog()});const l=document.getElementById("stackDisplayModeSelect");l&&l.addEventListener("change",v=>{const M=v.target.value;this.stackDisplayMode=M,this.updateStackDisplayMode(M),this.saveUIState();const k=document.getElementById("narrowStackDisplayModeSelect");k&&(k.value=M)});const c=document.getElementById("themeToggleBtn");c&&c.addEventListener("click",()=>{this.toggleTheme()}),window.addEventListener("dragover",v=>{v.preventDefault(),v.stopPropagation()}),window.addEventListener("drop",v=>{v.preventDefault(),v.stopPropagation();const M=v.dataTransfer?.files;M&&M.length>0&&this.handleFiles(Array.from(M))}),window.addEventListener("paste",v=>{v.target.matches('input, textarea, [contenteditable="true"]')||(v.preventDefault(),this.handleClipboardPaste(v))});const u=document.getElementById("backBtn");u&&u.addEventListener("click",()=>{this.navigateBack()}),window.addEventListener("keydown",v=>{(v.altKey&&v.key==="ArrowLeft"||v.key==="Backspace"&&!v.target.matches('input, textarea, [contenteditable="true"]'))&&(v.preventDefault(),this.navigateBack())});const d=document.getElementById("narrowMenuBtn");d&&d.addEventListener("click",()=>{this.toggleNarrowSidebar()});const h=document.getElementById("sidebarOverlay");h&&h.addEventListener("click",()=>{this.closeNarrowSidebar()});const p=document.getElementById("narrowCloseBtn");p&&p.addEventListener("click",()=>{this.closeNarrowSidebar()});const g=document.getElementById("narrowFilterInput");g&&g.addEventListener("input",v=>{const M=v.target.value;this.filterInputValue=M,this.debouncedSetFilter(M),this.syncFilterInputs()});const f=document.getElementById("narrowExpandAllBtn");f&&f.addEventListener("click",()=>{this.expandAllStacks()});const y=document.getElementById("narrowCollapseAllBtn");y&&y.addEventListener("click",()=>{this.collapseAllStacks()});const w=document.getElementById("narrowUnpinAllBtn");w&&w.addEventListener("click",()=>{this.unpinAllItems()});const x=document.getElementById("narrowBackBtn");x&&x.addEventListener("click",()=>{this.navigateBack()});const S=document.getElementById("narrowStackDisplayModeSelect");S&&S.addEventListener("change",v=>{const M=v.target.value;this.stackDisplayMode=M,this.updateStackDisplayMode(M),this.saveUIState();const k=document.getElementById("stackDisplayModeSelect");k&&(k.value=M)}),window.addEventListener("resize",()=>{this.handleResizeForNarrowMode()}),this.setupSettingsModal()}handleCopyButtonClick(t){t.stopPropagation();const e=t.currentTarget,n=e.dataset.stackId,i=e.dataset.categoryId;if(!n||!i)return;const o=this.profileCollection.getCategories().find(l=>l.id===i);if(!o)return;const s=o.stacks.find(l=>l.id===n);s&&this.copyStackToClipboard(s,o)}handlePinButtonClick(t){t.stopPropagation();const e=t.currentTarget,n=e.closest("[data-pin-type]");if(!n)return;const i=n.dataset.pinType,a=n.dataset.pinId;if(!i||!a)return;let o=!1;switch(i){case"category":o=this.profileCollection.toggleCategoryPin(a);break;case"stack":o=this.profileCollection.toggleStackPin(a);break;case"group":o=this.profileCollection.toggleGroupPin(a);break;case"goroutine":o=this.profileCollection.toggleGoroutinePin(a);break;default:return}n.classList.toggle("pinned",o),e.classList.toggle("pinned",o),this.setFilter(this.buildCurrentFilter()),this.updateVisibility(),this.updateStats()}handlePinButtonDoubleClick(t){t.stopPropagation();const n=t.currentTarget.closest("[data-pin-type]");if(!n)return;const i=n.dataset.pinType,a=n.dataset.pinId;if(!(!i||!a)){switch(i){case"category":this.profileCollection.toggleCategoryPinWithChildren(a),this.refreshPinStates();break;case"stack":this.profileCollection.toggleStackPinWithChildren(a),this.refreshPinStates();break;case"group":this.profileCollection.toggleGroupPinWithChildren(a),this.refreshPinStates();break}this.setFilter(this.buildCurrentFilter()),this.updateVisibility(),this.updateStats()}}handleNavigationClick(t){t.preventDefault(),t.stopPropagation();const e=t.currentTarget,n=e.dataset.targetId,i=e.dataset.sourceId;n&&i&&this.navigateToGoroutine(n,i)}handleShowAllCreatedClick(t){t.preventDefault(),t.stopPropagation();const e=t.currentTarget,n=e.dataset.creatorId,i=e.dataset.secondLineId;if(n&&i){const a=this.profileCollection.getGoroutineByID(n);if(a){const o=document.getElementById(i);o&&this.showAllCreatedGoroutines(n,a.created,o)}}}handleTooltipMouseEnter(t){const n=t.currentTarget.dataset.tooltipGoroutineId;n&&this.showGoroutinePreviewTooltip(n,t)}handleTooltipMouseLeave(){this.hideTooltip()}handleTooltipMouseMove(t){this.tooltip.style.left="".concat(t.pageX-20,"px"),this.tooltip.style.top="".concat(t.pageY+10,"px")}handleShowMoreClick(t){t.stopPropagation();const e=t.currentTarget,n=e.dataset.groupId;if(!n)return;const i=e.parentElement;if(!i)return;const a=this.findGroupById(n);if(!a)return;const o=new Set(Array.from(i.querySelectorAll(".goroutine-entry")).map(s=>s.id.replace("goroutine-","")));a.goroutines.forEach(s=>{if(!o.has(s.id)){const l=this.createGoroutineElement(s);i.appendChild(l)}}),e.remove(),this.setFilter(this.buildCurrentFilter())}findGroupById(t){const e=this.profileCollection.getCategories();for(const n of e)for(const i of n.stacks)for(const a of i.files)for(const o of a.groups)if(o.id===t)return o;return null}handleFileRenameClick(t){t.stopPropagation();const e=t.currentTarget,n=e.dataset.fileName;n&&this.startFileRename(e,n)}handleFileToggleClick(t){const e=t.target,n=t.currentTarget;if(e.classList.contains("file-name-text")||e.classList.contains("file-remove-btn"))return;t.stopPropagation();const i=n.dataset.fileName;i&&(this.hiddenFiles.has(i)?this.hiddenFiles.delete(i):this.hiddenFiles.add(i),this.setFilter(this.buildCurrentFilter()),this.updateVisibility(),this.updateStats(),this.renderFiles())}handleFileSoloClick(t){const e=t.target,n=t.currentTarget;if(e.classList.contains("file-name-text")||e.classList.contains("file-remove-btn"))return;t.stopPropagation();const i=n.dataset.fileName;if(!i)return;const a=this.profileCollection.getFileNames(),o=a.filter(l=>!this.hiddenFiles.has(l));o.length===1&&o[0]===i?this.hiddenFiles.clear():(this.hiddenFiles.clear(),a.forEach(l=>{l!==i&&this.hiddenFiles.add(l)})),this.setFilter(this.buildCurrentFilter()),this.updateVisibility(),this.updateStats(),this.renderFiles()}handleFileRemoveClick(t){t.stopPropagation();const n=t.currentTarget.dataset.fileName;n&&(this.profileCollection.removeFile(n),this.render())}handleChainIconClick(t){t.stopPropagation();const n=t.currentTarget.dataset.goroutineId;n&&this.showAncestryTree(n)}toggleNarrowSidebar(){const t=document.querySelector(".sidebar"),e=document.getElementById("sidebarOverlay"),n=document.getElementById("narrowMenuBtn"),i=document.getElementById("narrowCloseBtn");t&&e&&n&&(t.classList.contains("narrow-open")?this.closeNarrowSidebar():(t.classList.add("narrow-open"),e.classList.add("active"),n.classList.add("active"),i&&i.classList.add("visible")))}closeNarrowSidebar(){const t=document.querySelector(".sidebar"),e=document.getElementById("sidebarOverlay"),n=document.getElementById("narrowMenuBtn"),i=document.getElementById("narrowCloseBtn");t&&e&&n&&(t.classList.remove("narrow-open"),e.classList.remove("active"),n.classList.remove("active"),i&&i.classList.remove("visible"))}handleResizeForNarrowMode(){window.innerWidth>900&&this.closeNarrowSidebar(),this.syncFilterInputs()}syncFilterInputs(){const t=document.getElementById("filterInput"),e=document.getElementById("narrowFilterInput");t&&e&&(t.value=this.filterInputValue,e.value=this.filterInputValue)}async handleClipboardPaste(t){const e=t.clipboardData;if(!e)return;const n=e.files;if(n&&n.length>0){await this.handleFiles(Array.from(n));return}const i=e.getData("text/plain");if(i&&i.trim()){const a=new Blob([i],{type:"text/plain"}),o=new File([a],"paste",{type:"text/plain"});await this.handleFiles([o])}}async handleFiles(t){const e=t.length,n=t.map(i=>i.name).join(", ");this.showLoadingOverlay(e===1?"Processing file...":"Processing ".concat(e," files..."),e===1?t[0].name:n);try{for(let i=0;i<t.length;i++){const a=t[i];if(e>1&&this.updateLoadingMessage("Processing file ".concat(i+1," of ").concat(e,"..."),a.name),a.name.toLowerCase().endsWith(".zip")||a.type==="application/zip")await this.handleZipFile(a);else{console.time("ðŸ“„ File Import: ".concat(a.name));const o=await this.parser.parseFile(a,a.name);if(o.success)this.profileCollection.addFile(o.data),console.timeEnd("ðŸ“„ File Import: ".concat(a.name));else{console.timeEnd("ðŸ“„ File Import: ".concat(a.name)),console.error("Failed to parse ".concat(a.name,":"),o.error),this.hideLoadingOverlay(),alert("Failed to parse ".concat(a.name,": ").concat(o.error));return}}}this.updateLoadingMessage("Rendering results...","Organizing data and applying filters"),this.render(),this.setFilter(this.buildCurrentFilter()),this.hideLoadingOverlay()}catch(i){console.error("Error handling files:",i),this.hideLoadingOverlay(),alert("Error handling files: ".concat(i))}}findCommonPrefix(t){if(t.length===0||t.length===1)return"";let e=t[0];for(let n=1;n<t.length;n++)for(;t[n].indexOf(e)!==0;)if(e=e.substring(0,e.length-1),e==="")return"";return e}findCommonSuffix(t){if(t.length===0||t.length===1)return"";let e=t[0];for(let n=1;n<t.length;n++)for(;!t[n].endsWith(e);)if(e=e.substring(1),e==="")return"";return e}async handleZipFile(t){try{console.time("ðŸ—œ Zip Import: ".concat(t.name)),this.updateLoadingMessage("Extracting ZIP file...","Reading ".concat(t.name));const e=this.settingsManager.getZipFilePatternRegex(),n=await It.extractFiles(t,e);if(n.files.length===0)throw console.warn("No stack trace files found in zip matching pattern: ".concat(e)),new Error("No stack trace files found in zip file. Looking for files matching: ".concat(e));const i=n.files.map(s=>s.path),a=this.findCommonPrefix(i),o=this.findCommonSuffix(i);for(let s=0;s<n.files.length;s++){const l=n.files[s],c=l.path.split("/").pop()||l.path;let u=l.path;a&&(u=u.substring(a.length)),o&&(u=u.substring(0,u.length-o.length)),n.files.length>1?this.updateLoadingMessage("Processing ZIP entry ".concat(s+1," of ").concat(n.files.length,"..."),c):this.updateLoadingMessage("Processing ZIP entry...",c),console.time("  ðŸ“„ Zip Entry: ".concat(c));const d=await this.parser.parseFile(l.content,u);if(d.success)this.profileCollection.addFile(d.data),console.timeEnd("  ðŸ“„ Zip Entry: ".concat(c));else throw console.timeEnd("  ðŸ“„ Zip Entry: ".concat(c)),console.error("Failed to parse ".concat(c," from zip:"),d.error),new Error("Failed to parse ".concat(c," from zip: ").concat(d.error))}console.timeEnd("ðŸ—œ Zip Import: ".concat(t.name))}catch(e){throw console.timeEnd("ðŸ—œ Zip Import: ".concat(t.name)),console.error("Error processing zip file ".concat(t.name,":"),e),e}}debouncedSetFilter(t){this.filterDebounceTimer!==null&&clearTimeout(this.filterDebounceTimer);const e=this.parseFilterString(t);this.showFilterError(e.error),e.error||(this.filterDebounceTimer=window.setTimeout(()=>{this.parseFilterString(this.filterInputValue).error||this.setFilter(this.buildCurrentFilter()),this.saveUIState(),this.filterDebounceTimer=null},300))}showFilterError(t){const e=document.getElementById("filterInput"),n=document.getElementById("filterError");t?(e.classList.add("error"),n.textContent=t,n.style.display="block"):(e.classList.remove("error"),n.style.display="none")}setFilter(t){this.profileCollection.setFilter(t),this.updateVisibility(),this.updateStats()}parseWaitValue(t){if(!/^\d*\.?\d+$/.test(t.trim()))return null;const e=parseFloat(t);return isNaN(e)?null:e}parseFilterString(t){const e=t.split(" ").map(c=>c.trim()).filter(c=>c.length>0),n=[];let i,a,o=!1,s=!1,l=!1;for(const c of e)if(c.startsWith("wait:")){const u=c.substring(5);if(u.startsWith(">")){if(o)return{filterString:"",error:"Multiple minimum wait constraints not allowed (e.g., wait:>5 wait:>10)"};if(l)return{filterString:"",error:"Exact wait time cannot be combined with other wait constraints"};const d=this.parseWaitValue(u.substring(1));if(d===null)return{filterString:"",error:"Invalid wait filter: ".concat(c)};i=d+1,o=!0}else if(u.startsWith("<")){if(s)return{filterString:"",error:"Multiple maximum wait constraints not allowed (e.g., wait:<5 wait:<10)"};if(l)return{filterString:"",error:"Exact wait time cannot be combined with other wait constraints"};const d=this.parseWaitValue(u.substring(1));if(d===null)return{filterString:"",error:"Invalid wait filter: ".concat(c)};a=d-1,s=!0}else if(u.endsWith("+")){if(o)return{filterString:"",error:"Multiple minimum wait constraints not allowed (e.g., wait:5+ wait:>10)"};if(l)return{filterString:"",error:"Exact wait time cannot be combined with other wait constraints"};const d=this.parseWaitValue(u.slice(0,-1));if(d===null)return{filterString:"",error:"Invalid wait filter: ".concat(c)};i=d,o=!0}else if(u.includes("-")){if(o||s)return{filterString:"",error:"Range wait constraint cannot be combined with other wait constraints"};if(l)return{filterString:"",error:"Exact wait time cannot be combined with other wait constraints"};const d=u.split("-");if(d.length!==2)return{filterString:"",error:"Invalid range format: ".concat(c," (use wait:min-max)")};const h=this.parseWaitValue(d[0]),p=this.parseWaitValue(d[1]);if(h===null||p===null)return{filterString:"",error:"Invalid wait filter: ".concat(c)};if(h>p)return{filterString:"",error:"Invalid range: minimum (".concat(h,") cannot be greater than maximum (").concat(p,")")};i=h,a=p,o=!0,s=!0}else{if(l)return{filterString:"",error:"Multiple exact wait constraints not allowed (e.g., wait:5 wait:10)"};if(o||s)return{filterString:"",error:"Exact wait time cannot be combined with other wait constraints"};const d=this.parseWaitValue(u);if(d===null)return{filterString:"",error:"Invalid wait filter: ".concat(c)};i=d,a=d,l=!0}}else n.push(c);return n.length>1?{filterString:"",error:"Only one search term allowed (plus wait: filters)"}:i!==void 0&&i<0?{filterString:"",error:"Minimum wait time cannot be negative"}:a!==void 0&&a<0?{filterString:"",error:"Maximum wait time cannot be negative"}:i!==void 0&&a!==void 0&&i>a?{filterString:"",error:"Minimum wait time cannot be greater than maximum"}:{filterString:n.join(" "),minWait:i,maxWait:a}}buildCurrentFilter(t={}){const e=this.parseFilterString(this.filterInputValue);return{filterString:e.filterString,minWait:e.minWait,maxWait:e.maxWait,excludedFiles:this.hiddenFiles.size>0?this.hiddenFiles:void 0,...t}}clearFilter(){this.filterDebounceTimer!==null&&(clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=null),this.filterInputValue="",this.syncFilterInputs(),this.showFilterError(),this.profileCollection.clearFilter(),this.updateVisibility(),this.updateStats(),this.saveUIState()}clearAllFiles(){this.profileCollection.clear(),this.updateDropZone(),this.renderFiles(),this.updateStats(),this.saveUIState()}initializeTheme(){const t=localStorage.getItem("stackgazer-theme");this.currentTheme=t||this.initialTheme||"dark",this.applyTheme(this.currentTheme)}toggleTheme(){this.currentTheme=this.currentTheme==="dark"?"light":"dark",this.applyTheme(this.currentTheme),localStorage.setItem("stackgazer-theme",this.currentTheme)}applyTheme(t){const e=document.body,n=document.getElementById("themeToggleBtn");t==="light"?(e.setAttribute("data-theme","light"),n&&(n.textContent="â˜€ï¸",n.title="Switch to dark theme")):(e.removeAttribute("data-theme"),n&&(n.textContent="ðŸŒ™",n.title="Switch to light theme"))}expandAllStacks(){const t=document.querySelectorAll(".category-section");Array.from(t).some(n=>n.classList.contains("container-collapsed"))?t.forEach(n=>{const i=n.querySelector(".section-content");i&&(i.style.display=""),n.classList.remove("container-collapsed")}):document.querySelectorAll(".stack-section").forEach(i=>{const a=i.querySelector(".section-content");a&&(a.style.display=""),i.classList.remove("container-collapsed")})}collapseAllStacks(){const t=document.querySelectorAll(".stack-section");Array.from(t).some(n=>!n.classList.contains("container-collapsed"))?t.forEach(n=>{const i=n.querySelector(".section-content");i&&(i.style.display="none"),n.classList.add("container-collapsed")}):document.querySelectorAll(".category-section").forEach(i=>{const a=i.querySelector(".section-content");a&&(a.style.display="none"),i.classList.add("container-collapsed")})}toggleContainerCollapse(t){if(t.classList.contains("category-section")||t.classList.contains("stack-section"))if(t.classList.contains("container-collapsed")){t.classList.remove("container-collapsed");const i=t.querySelector(".section-content");i&&(i.style.display="")}else{t.classList.add("container-collapsed");const i=t.querySelector(".section-content");i&&(i.style.display="none")}else t.classList.toggle("section-collapsed")}updateVisibility(t=!1){const e=this.profileCollection.getCategories();let n=!1;for(const i of e){for(const a of i.stacks){for(const o of a.files){for(const s of o.groups)if(s.counts.visibilityChanged){n=!0;break}if(n)break}if(n)break}if(n)break}if(n)for(const i of e){for(const a of i.stacks){for(const o of a.files)o.counts.visibilityChanged=o.groups.reduce((s,l)=>s||l.counts.visibilityChanged,!1);a.counts.visibilityChanged=a.files.reduce((o,s)=>o||s.counts.visibilityChanged,!1)}i.counts.visibilityChanged=i.stacks.reduce((a,o)=>a||o.counts.visibilityChanged,!1)}for(const i of e){if(!t&&!i.counts.visibilityChanged)continue;const a=document.getElementById(i.id);if(a)if(i.counts.matches==0)a.classList.add("filtered");else{a.classList.remove("filtered"),this.updateDisplayedCount(a,i.counts);for(const o of i.stacks){if(!t&&!o.counts.visibilityChanged)continue;const s=document.getElementById(o.id);if(s)if(o.counts.matches==0)s.classList.add("filtered");else{s.classList.remove("filtered"),this.updateDisplayedCount(s,o.counts);for(const l of o.files){if(!t&&!l.counts.visibilityChanged)continue;const c=document.getElementById(l.id);if(c)if(l.counts.matches===0)c.classList.add("filtered");else{c.classList.remove("filtered"),this.updateDisplayedCount(c,l.counts);for(const u of l.groups){if(!t&&!u.counts.visibilityChanged)continue;const d=document.getElementById(u.id);if(d){if(u.counts.matches===0)d.classList.add("filtered");else{d.classList.remove("filtered"),this.updateDisplayedCount(d,u.counts);for(const h of u.goroutines){const p=document.getElementById("goroutine-".concat(h.id));p&&p.classList.toggle("filtered",!h.matches)}}u.counts.visibilityChanged=!1}}l.counts.visibilityChanged=!1}}o.counts.visibilityChanged=!1}}i.counts.visibilityChanged=!1}}}updateDisplayedCount(t,e){const n=t.querySelector(".counts");n&&(e.total===e.filterMatches?n.textContent="".concat(e.total," goroutines"):n.textContent="".concat(e.filterMatches," (of ").concat(e.total,") goroutines"))}render(){this.renderFiles(),this.renderStacks(),this.updateDropZone(),this.profileCollection.setFilter(this.buildCurrentFilter()),this.updateVisibility(!0),this.updateStats()}addExpandCollapseHandler(t){const e=t.querySelector(".header");e&&(e.addEventListener("mousedown",this.handleHeaderMouseDown.bind(this)),e.addEventListener("mouseup",this.handleHeaderMouseUp.bind(this)))}handleHeaderMouseDown(t){const e=t.currentTarget,n=window.getSelection();e.__selectionAtMouseDown=n?n.toString():""}handleHeaderMouseUp(t){const e=t.currentTarget,n=e.closest(".section");if(!n)return;const i=t.target;if(i.tagName==="BUTTON"||i.closest("button"))return;const a=window.getSelection(),o=a?a.toString():"";if((e.__selectionAtMouseDown||"")!==o)return;t.stopPropagation(),t.preventDefault();const l=!n.classList.contains("container-collapsed")||n.classList.contains("section-collapsed");if(this.toggleContainerCollapse(n),l&&e.getBoundingClientRect().top<0&&(e.scrollIntoView({behavior:"instant",block:"start"}),n.classList.contains("stack-section"))){const u=n.closest(".category-section"),d=u?u.querySelector(".header"):null;if(d){const h=d.clientHeight,p=e.style.scrollMarginTop;e.style.scrollMarginTop="".concat(h-2,"px"),e.scrollIntoView({behavior:"instant",block:"start"}),e.style.scrollMarginTop=p}}}renderFiles(){const t=document.getElementById("fileList"),e=document.getElementById("fileListContainer");if(!t)return;const n=this.profileCollection.getFileNames();if(t.textContent="",n.length===0){const l=this.templates.fileEmptyState.content.cloneNode(!0).firstElementChild;l.classList.add("cursor-pointer"),l.addEventListener("click",()=>{this.openFileDialog()}),t.appendChild(l),e&&e.classList.add("has-files");return}e&&e.classList.add("has-files");const i=this.getFileStatistics();n.forEach(s=>{const c=this.templates.fileItem.content.cloneNode(!0).firstElementChild;c.dataset.fileName=s,this.hiddenFiles.has(s)&&c.classList.add("file-hidden");const u=c.querySelector(".file-name-text");u.textContent=s,u.dataset.fileName=s,u.addEventListener("click",this.handleFileRenameClick.bind(this));const d=i.get(s)||{visible:0,total:0,potential:0},h=c.querySelector(".file-stats"),g=this.hiddenFiles.has(s)?d.potential:d.visible;h.textContent="".concat(g," / ").concat(d.total," goroutines"),c.addEventListener("click",this.handleFileToggleClick.bind(this)),c.addEventListener("dblclick",this.handleFileSoloClick.bind(this));const f=c.querySelector(".file-remove-btn");f.dataset.fileName=s,f.addEventListener("click",this.handleFileRemoveClick.bind(this)),t.appendChild(c)});const o=this.templates.fileDropArea.content.cloneNode(!0).firstElementChild;t.appendChild(o)}renderStacks(){const t=document.getElementById("dropZone");if(!t)return;const e=this.profileCollection.getCategories();if(e.length===0){this.updateDropZone();return}t.className="drop-zone has-content";const n=document.createElement("div");n.className="stack-display",n.id="stackDisplay",e.forEach(i=>{const a=this.createCategoryElement(i);n.appendChild(a)}),t.textContent="",t.appendChild(n)}createCategoryElement(t){const n=this.templates.category.content.cloneNode(!0).firstElementChild;n.id=t.id,n.dataset.pinType="category",n.dataset.pinId=t.id;const i=n.querySelector(".category-title");i.textContent=t.name;const a=n.querySelector(".pin-button");a.title="Pin/unpin this category",a.addEventListener("click",this.handlePinButtonClick.bind(this)),a.addEventListener("dblclick",this.handlePinButtonDoubleClick.bind(this)),this.updateDisplayedCount(n,t.counts);const o=n.querySelector(".category-content");for(const s of t.stacks){const l=this.createStackElement(s,t);o.appendChild(l)}return this.addExpandCollapseHandler(n),n}createStackElement(t,e){const i=this.templates.stack.content.cloneNode(!0).firstElementChild;i.id=t.id,i.dataset.pinType="stack",i.dataset.pinId=t.id;const a=i.querySelector(".stack-title");a.textContent=t.name;const o=i.querySelector(".pin-button");o.title="Pin/unpin this stack",o.addEventListener("click",this.handlePinButtonClick.bind(this)),o.addEventListener("dblclick",this.handlePinButtonDoubleClick.bind(this));const s=i.querySelector(".copy-button");s.title="Copy stack name and trace to clipboard",s.dataset.stackId=t.id,s.dataset.categoryId=e.id,s.addEventListener("click",this.handleCopyButtonClick.bind(this)),this.updateDisplayedCount(i,t.counts);const l=i.querySelector(".stack-content"),c=this.createTraceElement(t.trace);l.appendChild(c);const u=t.files;for(const d of u){const h=this.createFileSection(d.id,d.fileName,d.groups);l.appendChild(h)}return this.addExpandCollapseHandler(i),i}createFileSection(t,e,n){const a=this.templates.fileSection.content.cloneNode(!0).firstElementChild;a.id=t,n.length===1&&a.classList.add("single-group");const o=a.querySelector(".file-name");o.textContent=e;const s=a.querySelector(".section-content");return n.forEach(l=>{const c=this.createGroupSection(l.id,l,e);s.appendChild(c)}),this.addExpandCollapseHandler(a),a}createGroupSection(t,e,n){const a=this.templates.group.content.cloneNode(!0).firstElementChild;a.id=t,a.dataset.pinType="group",a.dataset.pinId=e.id;const o=a.querySelector(".expand-icon");e.goroutines.length===0&&o.remove();const s=a.querySelector(".group-header-label");if(n){const p=e.labels.length>0?" [".concat(e.labels.join(", "),"]"):"";s.textContent="".concat(n).concat(p)}else e.labels.length>0?s.textContent="[".concat(e.labels.join(", "),"]"):s.textContent="Goroutines";const l=a.querySelector(".pin-button");l.title="Pin/unpin this group",l.addEventListener("click",this.handlePinButtonClick.bind(this)),l.addEventListener("dblclick",this.handlePinButtonDoubleClick.bind(this)),e.goroutines.length>0&&this.addExpandCollapseHandler(a);const c=a.querySelector(".section-content"),u=4,d=e.goroutines.slice(0,u),h=e.goroutines.slice(u);if(d.forEach(p=>{const g=this.createGoroutineElement(p);c.appendChild(g)}),h.length>0){const g=this.templates.showMore.content.cloneNode(!0).firstElementChild,f=g.querySelector(".show-more-link-clickable");f.textContent=h.length.toString(),g.dataset.groupId=e.id,g.addEventListener("click",this.handleShowMoreClick.bind(this)),c.appendChild(g)}return a}createTraceElement(t){const n=this.templates.stackTrace.content.cloneNode(!0).firstElementChild;return n.setAttribute("data-display-mode",this.stackDisplayMode),n.__traceData=t,this.updateTraceElementContent(n,t),n}updateTraceElementContent(t,e){const n=t.getAttribute("data-display-mode")||"combined";let i="";switch(n){case"combined":i=this.formatStackCombined(e);break;case"side-by-side":i=this.formatStackSideBySide(e);break;case"functions":i=this.formatStackFunctions(e);break;case"locations":i=this.formatStackLocations(e);break;default:i=this.formatStackCombined(e)}t.innerHTML=i}createGoroutineElement(t){const n=this.templates.goroutine.content.cloneNode(!0).firstElementChild;n.id="goroutine-".concat(t.id),n.dataset.pinType="goroutine",n.dataset.pinId=t.id;const i=n.querySelector(".pin-button");i.title="Pin/unpin this goroutine",i.addEventListener("click",this.handlePinButtonClick.bind(this));const a=t.waitMinutes>0?" (".concat(t.waitMinutes," minutes)"):"",o=n.querySelector(".goroutine-header-left");if(o.textContent="".concat(t.id).concat(a,":"),t.creator&&t.creator!==t.id||t.created.length>0){const u=document.createElement("span");u.className="chain-icon",u.textContent="ðŸ•¸ï¸",u.style.marginLeft="0.5em",u.style.cursor="pointer",u.title="View ancestry tree",u.dataset.goroutineId=t.id,u.addEventListener("click",this.handleChainIconClick.bind(this)),o.appendChild(u)}const l=n.querySelector(".goroutine-created-by");if(t.creator&&t.creator!==t.id)if(l.textContent="created by ",t.creatorExists){const u=document.createElement("span");u.className="creator-link",u.textContent=t.creator,u.dataset.targetId=t.creator,u.dataset.sourceId=t.id,u.addEventListener("click",this.handleNavigationClick.bind(this)),this.addTooltipToLink(u,t.creator),l.appendChild(u)}else{const u=document.createElement("span");u.className="creator-missing",u.textContent=t.creator,l.appendChild(u)}else l.remove();const c=n.querySelector(".goroutine-header-second-line");if(t.created.length>0){const u="second-line-".concat(t.id);c.id=u;const d=document.createElement("span");d.className="created-goroutines-label",d.textContent="created ".concat(t.created.length," goroutine").concat(t.created.length>1?"s":"",": "),c.appendChild(d);const h=5;if(t.created.slice(0,h).forEach((g,f)=>{if(f>0){const w=document.createElement("span");w.textContent=", ",c.appendChild(w)}const y=document.createElement("span");y.className="creator-link",y.textContent=g,y.dataset.targetId=g,y.dataset.sourceId=t.id,y.addEventListener("click",this.handleNavigationClick.bind(this)),this.addTooltipToLink(y,g),c.appendChild(y)}),t.created.length>h){const g=document.createElement("span");g.textContent=" and ";const f=document.createElement("span");f.textContent="".concat(t.created.length-h," more"),f.className="created-goroutines-more creator-link",f.classList.add("cursor-pointer"),f.dataset.creatorId=t.id,f.dataset.secondLineId=u,f.addEventListener("click",this.handleShowAllCreatedClick.bind(this)),c.appendChild(g),c.appendChild(f)}}else c.remove();return n}updateDropZone(){const t=document.getElementById("dropZone");if(!t)return;if(this.profileCollection.getCategories().length===0){t.classList.remove("has-content"),t.textContent="";const n=Bt.dropZoneEmpty.content.cloneNode(!0);t.appendChild(n),this.setupDemoButtons()}}updateStats(){const t=this.profileCollection.getStackStatistics(),e=document.getElementById("stackCounts"),n=document.getElementById("goroutineCounts");if(e){let i=0;this.profileCollection.getCategories().forEach(a=>{for(const o of a.stacks)o.counts.pinned>0&&i++}),i>0?e.textContent="".concat(t.visible," (").concat(i,"ðŸ“Œ) / ").concat(t.total):e.textContent="".concat(t.visible," / ").concat(t.total)}n&&(t.pinnedGoroutines>0?n.textContent="".concat(t.visibleGoroutines," (").concat(t.pinnedGoroutines,"ðŸ“Œ) / ").concat(t.totalGoroutines):n.textContent="".concat(t.visibleGoroutines," / ").concat(t.totalGoroutines)),this.updateStateStats(),this.updateSidebarStateStats(),this.updateFileStats(),this.updateUnpinButtonVisibility()}updateStateStats(){const t=this.profileCollection.getCategories();for(const e of t){this.updateCategoryStateStats(e);for(const n of e.stacks)this.updateStackStateStats(n)}}updateCategoryStateStats(t){const e=document.getElementById(t.id);if(!e)return;const n=e.querySelector(".category-stats");if(!n)return;const i=Array.from(t.counts.matchingStates.entries()),a=pt(i);if(a.length===0){n.textContent="";return}const o=a.map(([l,c])=>"".concat(c," ").concat(l)),s=this.formatWaitTime(t.counts.minMatchingWait,t.counts.maxMatchingWait);n.textContent=s?"".concat(o.join(", ")," â€¢ ").concat(s):o.join(", ")}updateStackStateStats(t){const e=document.getElementById(t.id);if(!e)return;const n=e.querySelector(".stack-stats");if(!n)return;const i=Array.from(t.counts.matchingStates.entries()),a=pt(i);if(a.length===0){n.textContent="";return}const o=a.map(([l,c])=>"".concat(c," ").concat(l)),s=this.formatWaitTime(t.counts.minMatchingWait,t.counts.maxMatchingWait);n.textContent=s?"".concat(o.join(", ")," â€¢ ").concat(s):o.join(", ")}formatWaitTime(t,e){return!isFinite(t)||!isFinite(e)||t===0&&e===0?"":t===e?"".concat(t,"mins"):"".concat(t,"-").concat(e,"mins")}updateSidebarStateStats(){const t=document.getElementById("stateStats");if(!t)return;const e=this.profileCollection.getStateStatistics();if(e.size===0){t.textContent="";return}const n=Array.from(e.entries()),i=pt(n);t.textContent="";const a=Ce(i);t.appendChild(a)}refreshPinStates(){const t=this.profileCollection.getCategories();for(const e of t){const n=document.getElementById(e.id),i=n?.querySelector(".pin-button");n&&i&&(n.classList.toggle("pinned",e.pinned),i.classList.toggle("pinned",e.pinned));for(const a of e.stacks){const o=document.getElementById(a.id),s=o?.querySelector(".pin-button");o&&s&&(o.classList.toggle("pinned",a.pinned),s.classList.toggle("pinned",a.pinned));for(const l of a.files)for(const c of l.groups){const u=document.getElementById(c.id),d=u?.querySelector(".pin-button");u&&d&&(u.classList.toggle("pinned",c.pinned),d.classList.toggle("pinned",c.pinned));for(const h of c.goroutines){const p=document.getElementById("goroutine-".concat(h.id)),g=p?.querySelector(".pin-button");p&&g&&(p.classList.toggle("pinned",h.pinned),g.classList.toggle("pinned",h.pinned))}}}}}updateFileStats(){const t=this.getFileStatistics();document.querySelectorAll(".file-item").forEach(n=>{const i=n.dataset.fileName;if(i){const a=n.querySelector(".file-stats");if(a){const o=t.get(i)||{visible:0,total:0,potential:0},l=this.hiddenFiles.has(i)?o.potential:o.visible;a.textContent="".concat(l," / ").concat(o.total," goroutines")}}})}getFileStatistics(){return this.profileCollection.getFileStatistics()}updateUnpinButtonVisibility(){const t=document.getElementById("unpinAllBtn"),e=document.getElementById("narrowUnpinAllBtn"),n=this.profileCollection.hasAnyPinnedItems();t&&t.classList.toggle("hidden",!n),e&&e.classList.toggle("hidden",!n)}unpinAllItems(){this.profileCollection.unpinAllItems(),document.querySelectorAll(".pinned").forEach(t=>{t.classList.remove("pinned")}),this.setFilter({filterString:this.filterInputValue}),this.updateVisibility(),this.updateStats()}updateStackDisplayMode(t){document.querySelectorAll(".unique-stack-content").forEach(e=>{e.setAttribute("data-display-mode",t);const n=e.__traceData;n&&this.updateTraceElementContent(e,n)})}formatStackCombined(t){let e="";for(const n of t)e+='<div class="stack-line">',e+='<span class="function-name">'.concat(this.escapeHtml(n.func),"</span>"),e+="</div>",e+='<div class="stack-line">	<span class="file-path">'.concat(this.escapeHtml(n.file),'</span>:<span class="line-number">').concat(n.line,"</span></div>");return e}formatStackSideBySide(t){let e='<div class="side-by-side-container">';e+='<div class="side-by-side-headers">',e+='<div class="column-header">Functions</div>',e+='<div class="column-header">Locations</div>',e+="</div>";for(const n of t)e+='<div class="side-by-side-row">',e+='<div class="function-side">',e+='<span class="function-name">'.concat(this.escapeHtml(n.func),"</span>"),e+="</div>",e+='<div class="location-side">',e+='<span class="file-location"><span class="file-path">'.concat(this.escapeHtml(n.file),'</span>:<span class="line-number">').concat(n.line,"</span></span>"),e+="</div>",e+="</div>";return e+="</div>",e}formatStackFunctions(t){let e="";for(const n of t)e+='<div class="stack-line">',e+='<span class="function-name">'.concat(this.escapeHtml(n.func),"</span>"),e+="</div>";return e}formatStackLocations(t){let e="";for(const n of t)e+='<div class="stack-line">',e+='<span class="file-path">'.concat(this.escapeHtml(n.file),'</span>:<span class="line-number">').concat(n.line,"</span>"),e+="</div>";return e}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}startFileRename(t,e){if(t.getAttribute("contenteditable")==="true")return;const n=t.textContent||"";t.setAttribute("contenteditable","true"),t.classList.add("editing"),t.setAttribute("title","Press Enter to save, Escape to cancel"),t.focus();const i=document.createRange();i.selectNodeContents(t);const a=window.getSelection();a&&(a.removeAllRanges(),a.addRange(i));const o=()=>{const c=t.textContent?.trim()||"";if(t.setAttribute("contenteditable","false"),t.classList.remove("editing"),t.removeAttribute("title"),c&&c!==n){if(this.profileCollection.getFileNames().filter(d=>d!==e).includes(c)){alert('A file named "'.concat(c,'" already exists.')),t.textContent=n;return}this.profileCollection.renameFile(e,c,this.profileCollection.getFileNames().length>1),this.render()}else t.textContent=n},s=c=>{c.key==="Enter"?(c.preventDefault(),o(),t.removeEventListener("keydown",s),t.removeEventListener("blur",l)):c.key==="Escape"&&(c.preventDefault(),t.textContent=n,t.setAttribute("contenteditable","false"),t.classList.remove("editing"),t.removeAttribute("title"),t.removeEventListener("keydown",s),t.removeEventListener("blur",l))},l=()=>{o(),t.removeEventListener("keydown",s),t.removeEventListener("blur",l)};t.addEventListener("keydown",s),t.addEventListener("blur",l)}showLoadingOverlay(t,e){this.loadingDelayTimer!==null&&(clearTimeout(this.loadingDelayTimer),this.loadingDelayTimer=null),this.loadingDelayTimer=window.setTimeout(()=>{const n=document.getElementById("loadingOverlay"),i=document.getElementById("loadingMessage"),a=document.getElementById("loadingDetails");n&&i&&(i.textContent=t,a&&e?(a.textContent=e,a.style.display="block"):a&&(a.style.display="none"),n.style.display="flex"),this.loadingDelayTimer=null},300)}hideLoadingOverlay(){this.loadingDelayTimer!==null&&(clearTimeout(this.loadingDelayTimer),this.loadingDelayTimer=null);const t=document.getElementById("loadingOverlay");t&&(t.style.display="none")}updateLoadingMessage(t,e){if(this.loadingDelayTimer!==null){clearTimeout(this.loadingDelayTimer),this.loadingDelayTimer=null;const a=document.getElementById("loadingOverlay");a&&(a.style.display="flex")}const n=document.getElementById("loadingMessage"),i=document.getElementById("loadingDetails");n&&(n.textContent=t),i&&e?(i.textContent=e,i.style.display="block"):i&&(i.style.display="none")}setupDemoButtons(){const t=document.getElementById("demoSingleBtn"),e=document.getElementById("demoZipBtn");t&&t.addEventListener("click",async n=>{n.preventDefault(),this.showLoadingOverlay("Loading demo file...","Downloading single node goroutine dump");try{await this.loadFromUrl("https://raw.githubusercontent.com/dt/crdb-stacks-examples/refs/heads/main/stacks/files/1/stacks.txt","crdb-demo-single.txt")}catch(i){const a=i&&i.message?i.message:String(i);console.error("Demo file load error:",i),this.hideLoadingOverlay(),alert("Failed to load demo file. Please try again or check your internet connection (".concat(a,")."))}}),e&&e.addEventListener("click",async n=>{n.preventDefault(),this.showLoadingOverlay("Loading demo ZIP...","Downloading ZIP file with 4 node stack dumps");try{await this.loadFromUrl("https://raw.githubusercontent.com/dt/crdb-stacks-examples/refs/heads/main/stacks.zip","crdb-demo.zip")}catch(i){console.error("Demo zip load error:",i),this.hideLoadingOverlay(),alert("Failed to load demo zip file. Please try again or check your internet connection.")}})}async loadFromUrl(t,e){try{const n=await fetch(t);if(!n.ok)throw new Error("HTTP error! status: ".concat(n.status));if(e.endsWith(".zip")){console.time("ðŸŒ URL Zip Import: ".concat(e));const i=await n.arrayBuffer(),a=new File([i],e,{type:"application/zip"}),o=this.settingsManager.getZipFilePatternRegex(),s=await It.extractFiles(a,o),l=s.files.map(d=>d.path),c=this.findCommonPrefix(l),u=this.findCommonSuffix(l);for(const d of s.files){const h=d.path.split("/").pop()||d.path;let p=d.path;c&&(p=p.substring(c.length)),u&&(p=p.substring(0,p.length-u.length)),console.time("  ðŸ“„ URL Zip Entry: ".concat(h));const g=await this.parser.parseFile(d.content,p);g.success?(this.profileCollection.addFile(g.data),console.timeEnd("  ðŸ“„ URL Zip Entry: ".concat(h))):(console.timeEnd("  ðŸ“„ URL Zip Entry: ".concat(h)),console.error("URL zip - Failed to parse ".concat(h,":"),g.error))}s.files.length===0&&console.warn("URL zip - No stack trace files found matching pattern: ".concat(o)),console.timeEnd("ðŸŒ URL Zip Import: ".concat(e))}else{console.time("ðŸŒ URL File Import: ".concat(e));const i=await n.arrayBuffer(),a=new File([i],e),o=await this.parser.parseFile(a,e);if(o.success)this.profileCollection.addFile(o.data),console.timeEnd("ðŸŒ URL File Import: ".concat(e));else throw console.timeEnd("ðŸŒ URL File Import: ".concat(e)),console.error("Failed to parse ".concat(e,":"),o.error),new Error(o.error)}this.updateLoadingMessage("Rendering results...","Organizing data and applying filters"),this.render(),this.setFilter(this.buildCurrentFilter()),this.hideLoadingOverlay()}catch(n){throw e.endsWith(".zip")?console.timeEnd("ðŸŒ URL Zip Import: ".concat(e)):console.timeEnd("ðŸŒ URL File Import: ".concat(e)),console.error("URL load error:",n),n}}showAllCreatedGoroutines(t,e,n){n.textContent="";const i=document.createElement("span");i.className="created-goroutines-label",i.textContent="created ".concat(e.length," goroutine").concat(e.length>1?"s":"",": "),n.appendChild(i),e.forEach((a,o)=>{if(o>0){const l=document.createElement("span");l.textContent=", ",n.appendChild(l)}const s=document.createElement("span");s.className="creator-link",s.textContent=a,s.dataset.targetId=a,s.dataset.sourceId=t,s.addEventListener("click",this.handleNavigationClick.bind(this)),this.addTooltipToLink(s,a),n.appendChild(s)})}setupNavigationHistory(){window.addEventListener("popstate",t=>{t.state&&t.state.goroutineId&&this.navigateToGoroutineInternal(t.state.goroutineId,!1,void 0)})}navigateToGoroutine(t,e){this.navigateToGoroutineInternal(t,!0,e)}navigateToGoroutineInternal(t,e,n){e&&n&&(this.addToNavigationHistory(n),history.pushState({goroutineId:n},"Goroutine ".concat(n),"#goroutine-".concat(n)));const i=this.profileCollection.lookupGoroutine(t);if(!i){console.warn("Goroutine ".concat(t," not found in profile collection"));return}this.setFilter(this.buildCurrentFilter({forcedGoroutine:void 0})),i.matches||this.setFilter(this.buildCurrentFilter({forcedGoroutine:t}));let a=document.getElementById("goroutine-".concat(t));if(!a&&(console.warn("Goroutine ".concat(t," not found in DOM - might be filtered out")),this.expandGroupsContainingGoroutine(t),a=document.getElementById("goroutine-".concat(t)),!a)){alert("Goroutine ".concat(t," not found in DOM after expanding groups"));return}this.expandParentContainers(a),this.scrollToAndHighlightGoroutine(a,t,e)}expandGroupsContainingGoroutine(t){document.querySelectorAll(".show-more-link").forEach(n=>{n.click()})}expandParentContainers(t){let e=t;for(;e;){if(e.classList.contains("expandable")&&(e.classList.contains("container-collapsed")||e.classList.contains("section-collapsed"))){e.classList.remove("container-collapsed"),e.classList.remove("section-collapsed");const n=e.querySelector(".section-content");n&&(n.style.display="")}e=e.parentElement}}scrollToAndHighlightGoroutine(t,e,n){n&&history.pushState({goroutineId:e},"Goroutine ".concat(e),"#goroutine-".concat(e)),document.querySelectorAll(".goroutine-entry.highlighted").forEach(i=>{i.classList.remove("highlighted")}),t.classList.add("highlighted"),t.scrollIntoView({behavior:"instant",block:"center"}),this.updateBackButtonState(),setTimeout(()=>{t.classList.remove("highlighted")},3e3)}addToNavigationHistory(t){const e=this.appState.addToNavigationHistory(t);this.updateBackButtonState(e.canGoBack)}navigateBack(){const t=this.appState.navigateBack();t.targetGoroutineId&&(this.navigateToGoroutineInternal(t.targetGoroutineId,!1,void 0),history.pushState({goroutineId:t.targetGoroutineId},"Goroutine ".concat(t.targetGoroutineId),"#goroutine-".concat(t.targetGoroutineId))),this.updateBackButtonState(t.canGoBack)}updateBackButtonState(t){const e=document.getElementById("backBtn"),n=document.getElementById("narrowBackBtn"),i=t!==void 0?t:this.appState.canNavigateBack();e&&(e.disabled=!i),n&&(n.disabled=!i)}clearUrlAnchor(){window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}convertToProfileCollectionSettings(t){return{functionPrefixesToTrim:this.settingsManager.getFunctionTrimPrefixes(),filePrefixesToTrim:this.settingsManager.getFileTrimPrefixes(),titleManipulationRules:this.settingsManager.getTitleManipulationRules(),nameExtractionPatterns:t.nameExtractionPatterns,zipFilePatterns:this.settingsManager.getZipFilePatterns(),categoryRules:this.settingsManager.getCategoryRules()}}onSettingsChanged(t){const e=this.convertToProfileCollectionSettings(t);this.profileCollection.updateSettings(e),this.profileCollection.getCategories().length>0&&this.render()}setupSettingsModal(){const t=document.getElementById("settingsBtn"),e=document.getElementById("settingsModal"),n=document.getElementById("settingsModalCloseBtn"),i=document.getElementById("resetSettingsBtn"),a=document.getElementById("saveSettingsBtn");t&&e&&t.addEventListener("click",()=>{this.openSettingsModal()}),n&&e&&n.addEventListener("click",()=>{this.loadSettingsIntoModal(),e.classList.add("modal-hidden"),e.classList.remove("modal-visible")}),e&&e.addEventListener("click",o=>{o.target===e&&(this.loadSettingsIntoModal(),e.classList.add("modal-hidden"),e.classList.remove("modal-visible"))}),document.addEventListener("keydown",o=>{o.key==="Escape"&&e&&e.classList.contains("modal-visible")&&(this.loadSettingsIntoModal(),e.classList.add("modal-hidden"),e.classList.remove("modal-visible"))}),i&&i.addEventListener("click",()=>{this.resetSettings()}),a&&a.addEventListener("click",()=>{this.saveSettingsFromModal()})}openSettingsModal(){const t=document.getElementById("settingsModal");t&&(this.loadSettingsIntoModal(),t.classList.add("modal-visible"),t.classList.remove("modal-hidden"))}generateModalContent(){const t=document.getElementById("settingsModalBody");t&&(t.innerHTML="",Object.entries(K).forEach(([e,n])=>{const i=document.createElement("h4");if(i.textContent=e,t.appendChild(i),e==="Parsing Options"){const o=document.createElement("div");o.className="setting-description-prose";const s=document.createElement("p");s.innerHTML="<strong>Note:</strong> Parsing trim prefixes are applied first during file parsing. The trimmed function and file names are then used as input for all categorization and naming rules above.",o.appendChild(s),t.appendChild(o)}const a=document.createElement("div");a.className="setting-group",Object.entries(n).forEach(([o,s])=>{const l=xe({id:s.settingKey,title:o,description:s.description,helpTooltip:s.tooltip,defaultRows:3,customRows:2,customPlaceholder:"Add your own ".concat(o.toLowerCase()," here...")});a.appendChild(l)}),t.appendChild(a)}))}loadSettingsIntoModal(){this.generateModalContent();const t=this.settingsManager.getStoredSettings();Object.values(K).forEach(e=>{Object.values(e).forEach(n=>{const i=n.settingKey,a=t[i],o=document.getElementById("useDefault".concat(i));o&&(o.checked=!a?.ignoreDefault);const s=document.getElementById("custom".concat(i));s&&(s.value=a?.custom?a.custom.join("\n"):"")})}),this.populateDefaultRuleTextareas(),this.setupModalEventHandlers(),this.updateAllRuleCounts()}saveSettingsFromModal(){Object.values(K).forEach(e=>{Object.values(e).forEach(n=>{const i=n.settingKey,a=document.getElementById("useDefault".concat(i)),o=document.getElementById("custom".concat(i));if(a&&o){const s=a.checked,c=o.value.split("\n").filter(d=>d.trim()!==""),u={ignoreDefault:!s,custom:c};this.settingsManager.updateSetting(i,u)}})});const t=document.getElementById("settingsModal");t&&(t.classList.add("modal-hidden"),t.classList.remove("modal-visible"))}resetSettings(){this.settingsManager.resetToDefaults(),this.loadSettingsIntoModal()}createTooltip(){this.tooltip=document.createElement("div"),this.tooltip.className="goroutine-tooltip",this.tooltip.classList.add("hidden"),this.container.appendChild(this.tooltip)}showGoroutinePreviewTooltip(t,e){const n=this.profileCollection.getGoroutineByID(t);if(!n)return;const i=this.profileCollection.getCategoryForGoroutine(t),a=i?"".concat(i.name," â†’ "):"",o=n.stack.name,s=n.waitMinutes>0?", ".concat(n.waitMinutes," mins"):"";this.tooltip.textContent="[".concat(n.state).concat(s,"] ").concat(a).concat(o),this.tooltip.style.left="-9999px",this.tooltip.style.top="-9999px",this.tooltip.style.transform="none",this.tooltip.classList.remove("hidden");const l=this.tooltip.getBoundingClientRect(),c=window.innerWidth,u=window.innerHeight;let d=-20,h=10;e.clientX-20+l.width>c&&(d=-l.width+15,e.clientX+d<0&&(d=-e.clientX+10)),e.clientY+10+l.height>u&&(h=-l.height-10,e.clientY+h<0&&(h=-e.clientY+10)),this.tooltip.style.left="".concat(e.pageX,"px"),this.tooltip.style.top="".concat(e.pageY,"px"),this.tooltip.style.transform="translate(".concat(d,"px, ").concat(h,"px)")}hideTooltip(){this.tooltip.classList.add("hidden")}addTooltipToLink(t,e){t.dataset.tooltipGoroutineId=e,t.addEventListener("mouseenter",this.handleTooltipMouseEnter.bind(this)),t.addEventListener("mouseleave",this.handleTooltipMouseLeave.bind(this)),t.addEventListener("mousemove",this.handleTooltipMouseMove.bind(this))}setupCollapsibleSections(){document.querySelectorAll(".collapsible-header").forEach(e=>{if(e.__collapsibleSetup)return;const n=()=>{const i=e.closest(".rules-editor");if(!i)return;i.classList.contains("collapsed-settings")?(i.classList.remove("collapsed-settings"),e.classList.remove("collapsed-settings")):(i.classList.add("collapsed-settings"),e.classList.add("collapsed-settings"))};e.addEventListener("click",n),e.__collapsibleSetup=!0})}populateDefaultRuleTextareas(){const t=this.settingsManager.getDefaults();Object.values(K).forEach(e=>{Object.values(e).forEach(n=>{const i=n.settingKey,a=document.getElementById("default".concat(i));if(a){const o=t[i]||[];a.value=o.join("\n")}})})}setupModalEventHandlers(){Object.values(K).forEach(t=>{Object.values(t).forEach(e=>{this.setupRuleSettingHandlers(e.settingKey)})}),this.setupCollapsibleSections(),this.updateAllRuleCounts()}setupRuleSettingHandlers(t){const e=document.getElementById("useDefault".concat(t));if(e&&!e.__ruleToggleSetup){const n=e.closest(".default-rules-section"),i=document.querySelector("#custom".concat(t))?.closest(".custom-rules-section");if(n){const a=n.querySelector(".default-rules-header"),o=n.querySelector(".default-rules-content");if(a&&o){this.updateDefaultRuleToggleState(e,a,o);const s=c=>{c.target!==e&&!e.contains(c.target)&&e.checked&&(o.classList.toggle("collapsed-settings"),n.classList.toggle("settings-collapsed",o.classList.contains("collapsed-settings")))};a.addEventListener("click",s);const l=()=>{this.updateDefaultRuleToggleState(e,a,o)};e.addEventListener("change",l)}}i&&this.setupCustomRulesSectionHandlers(i,t),e.__ruleToggleSetup=!0}}setupCustomRulesSectionHandlers(t,e){if(t.__customRulesSetup)return;const n=t.querySelector(".custom-rules-header"),i=t.querySelector(".custom-rules-content");if(n&&i){const a=()=>{i.classList.contains("collapsed-settings")?(i.classList.remove("collapsed-settings"),t.classList.remove("settings-collapsed")):(i.classList.add("collapsed-settings"),t.classList.add("settings-collapsed"))};n.addEventListener("click",a);const o=i.querySelector("textarea");if(o){const s=()=>{this.updateRuleCount(t,o)};o.addEventListener("input",s)}t.__customRulesSetup=!0}}updateDefaultRuleToggleState(t,e,n){const i=t.closest(".default-rules-section");t.checked?(e.classList.remove("disabled"),n.style.opacity="1"):(e.classList.add("disabled"),n.style.opacity="0.5",n.classList.add("collapsed-settings"),i&&i.classList.add("settings-collapsed"))}updateRuleCount(t,e){const n=t.querySelector(".custom-rules-title h5");if(n){const i=e.value.trim(),a=i?i.split("\n").filter(l=>l.trim()).length:0,o=n.textContent?.replace(/\s*\(\d+\)$/,"")||"Custom Rules";n.textContent="".concat(o," (").concat(a,")");const s=t.querySelector(".custom-rules-header");s&&(a===0?(s.style.opacity="0.5",s.style.color="#666"):(s.style.opacity="1",s.style.color=""))}}async copyStackToClipboard(t,e){try{const n="# ".concat(e.name," â†’ ").concat(t.name);let i="";if(t.files.length>0){const l=[];for(const c of t.files){const u=new Map;for(const d of c.groups)for(const h of d.goroutines){const p=h.waitMinutes>0?", ".concat(h.waitMinutes,"m"):"",g="".concat(h.state).concat(p);u.has(g)||u.set(g,[]),u.get(g).push(h)}if(u.size>0){t.files.length>1&&l.push("# ".concat(c.fileName));const d=Array.from(u.entries()).sort(([,h],[,p])=>{const g=h[0].state,f=p[0].state,y=h[0].waitMinutes,w=p[0].waitMinutes;return g!==f?g.localeCompare(f):y-w});for(const[h,p]of d){const g=p.map(f=>f.id);if(g.length>12)for(let f=0;f<g.length;f+=12){const w=g.slice(f,f+12).join(",");l.push("goroutine ".concat(w," [").concat(h,"]:"))}else{const f=g.join(",");l.push("goroutine ".concat(f," [").concat(h,"]:"))}}}}i=l.join("\n")}const a=this.formatStackTraceForCopy(t.trace),o=[n];i&&o.push(i),o.push(a);const s=o.join("\n\n");await navigator.clipboard.writeText(s),this.showCopyFeedback()}catch(n){console.error("Failed to copy to clipboard:",n),this.fallbackCopyToClipboard(t)}}groupGoroutinesByStateAndWait(t){const e=new Map;for(const n of t.files)for(const i of n.groups)for(const a of i.goroutines){const o=a.waitMinutes>0?", ".concat(a.waitMinutes," minutes"):"",s="".concat(a.state).concat(o);e.has(s)||e.set(s,[]),e.get(s).push(a)}return e}formatStackTraceForCopy(t){return t.map(e=>"".concat(e.func,"\n	").concat(e.file,":").concat(e.line)).join("\n")}showCopyFeedback(){const t=document.getElementById("copyNotification");t&&(t.style.display="block",t.classList.add("show"),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>{t.style.display="none"},300)},2e3))}fallbackCopyToClipboard(t){const e="# ".concat(t.name);let n="";const i=this.groupGoroutinesByStateAndWait(t);if(i.size>0){const c=[],u=Array.from(i.entries()).sort(([,d],[,h])=>{const p=d[0].state,g=h[0].state,f=d[0].waitMinutes,y=h[0].waitMinutes;return p!==g?p.localeCompare(g):f-y});for(const[d,h]of u){const p=h.map(g=>g.id).join(",");c.push("goroutine ".concat(p," [").concat(d,"]:"))}n=c.join("\n")}const a=this.formatStackTraceForCopy(t.trace),o=[e];n&&o.push(n),o.push(a);const s=o.join("\n\n"),l=document.createElement("textarea");l.value=s,l.style.position="fixed",l.style.left="-9999px",this.container.appendChild(l);try{l.select(),document.execCommand("copy"),this.showCopyFeedback()}catch(c){console.error("Fallback copy failed:",c),alert("Copy failed. Please select and copy the text manually.")}finally{document.body.removeChild(l)}}updateAllRuleCounts(){Object.values(K).forEach(t=>{Object.values(t).forEach(e=>{const n=e.settingKey,i=document.querySelector("#custom".concat(n))?.closest(".custom-rules-section");if(i){const o=i.querySelector("textarea");o&&this.updateRuleCount(i,o)}const a=document.querySelector("#default".concat(n))?.closest(".default-rules-section");if(a){const o=a.querySelector(".default-rules-textarea"),s=a.querySelector(".default-rules-title h5");if(o&&s){const l=o.value.trim(),c=l?l.split("\n").filter(d=>d.trim()).length:0,u=s.textContent?.replace(/\s*\(\d+\)$/,"")||"Default Rules";s.textContent="".concat(u," (").concat(c,")")}}})})}showAncestryTree(t){const e=this.profileCollection.getGoroutineByID(t);if(!e){console.warn("Goroutine ".concat(t," not found"));return}const n=this.buildAncestryTree(t);this.createAncestryModal(n,e)}buildAncestryTree(t){const e=i=>{const a=this.profileCollection.getGoroutineByID(i);if(!a)return null;const o=this.profileCollection.getCategoryForGoroutine(i)||null,l={id:i,goroutine:a,category:o,isTarget:i===t,children:[]};for(const c of a.created){const u=e(c);u&&l.children.push(u)}return l};let n=t;for(;;){let i=this.profileCollection.getGoroutineByID(n);if(!i?.creatorExists)break;n=i.creator}return e(n)}createAncestryModal(t,e){const n=document.getElementById("ancestryModal");n&&n.remove();const a=this.templates.ancestryModal.content.cloneNode(!0).firstElementChild;a.querySelector(".ancestry-modal-close").addEventListener("click",()=>a.remove());const s=a.querySelector(".ancestry-tree-container");a.addEventListener("click",c=>{c.target===a&&a.remove()});const l=c=>{c.key==="Escape"&&a.remove()};document.addEventListener("keydown",l),this.container.appendChild(a),this.renderAncestryTree(s,t,e)}renderAncestryTree(t,e,n){if(!e){const k=this.templates.ancestryEmptyState.content.cloneNode(!0);t.appendChild(k);return}const i=t.querySelector(".ancestry-zoom-controls");t.innerHTML="",i&&t.appendChild(i);const a=t.getBoundingClientRect(),o=a.width,s=a.height,l=xt(e);Qe().nodeSize([120,720]).separation((k,b)=>k.parent===b.parent?1.2:2.5)(l);let h=1/0,p=-1/0,g=1/0,f=-1/0;l.descendants().forEach(k=>{k.x!==void 0&&k.y!==void 0&&(h=Math.min(h,k.x),p=Math.max(p,k.x),g=Math.min(g,k.y),f=Math.max(f,k.y))});const y=f-g,w=p-h,x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttribute("width","100%"),x.setAttribute("height","100%"),x.setAttribute("class","ancestry-tree-svg");const S=document.createElementNS("http://www.w3.org/2000/svg","g");S.id="zoomGroup";const v=document.createElementNS("http://www.w3.org/2000/svg","g");v.setAttribute("transform","translate(".concat(-g,", ").concat(-h,")")),l.links().forEach(k=>{const b=document.createElementNS("http://www.w3.org/2000/svg","line");b.setAttribute("x1",(k.source.y??0).toString()),b.setAttribute("y1",(k.source.x??0).toString()),b.setAttribute("x2",(k.target.y??0).toString()),b.setAttribute("y2",(k.target.x??0).toString()),b.setAttribute("stroke","var(--border-color, #666)"),b.setAttribute("stroke-width","2"),b.setAttribute("stroke-opacity","0.6"),v.appendChild(b)}),l.descendants().forEach(k=>{const b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttribute("transform","translate(".concat(k.y??0,", ").concat(k.x??0,")"));const B=k.data.isTarget,A=document.createElementNS("http://www.w3.org/2000/svg","rect");if(A.setAttribute("x","-320"),A.setAttribute("y","-35"),A.setAttribute("width","640"),A.setAttribute("height","70"),A.setAttribute("rx","8"),A.setAttribute("fill",B?"var(--accent-primary, #007acc)":"var(--bg-tertiary, #444)"),A.setAttribute("stroke",B?"#fff":"var(--border-color, #666)"),A.setAttribute("stroke-width",B?"3":"2"),B){const T=document.createElementNS("http://www.w3.org/2000/svg","animateTransform");T.setAttribute("attributeName","transform"),T.setAttribute("type","scale"),T.setAttribute("values","1;1.05;1"),T.setAttribute("dur","2s"),T.setAttribute("repeatCount","indefinite"),A.appendChild(T)}b.appendChild(A);const _=k.data.category?.name||"",q=k.data.goroutine.stack?.name||"",L=k.data.goroutine.waitMinutes>0?" (".concat(k.data.goroutine.waitMinutes,"m)"):"",R="[".concat(k.data.goroutine.state,"]"),E=document.createElementNS("http://www.w3.org/2000/svg","text");E.setAttribute("text-anchor","middle"),E.setAttribute("dy","-8"),E.setAttribute("fill",B?"#000":"var(--text-primary, #fff)"),E.setAttribute("font-size",B?"15":"13"),E.setAttribute("font-weight",B?"bold":"normal");const D=document.createElementNS("http://www.w3.org/2000/svg","tspan");D.textContent=k.data.goroutine.id,D.setAttribute("class","ancestry-node-id");const W=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(W.textContent=" ".concat(R).concat(L),E.appendChild(D),E.appendChild(W),b.appendChild(E),_||q){const T=_&&q?"".concat(_," â†’ ").concat(q):_||q,N=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");N.setAttribute("x","-310"),N.setAttribute("y","0"),N.setAttribute("width","620"),N.setAttribute("height","30");const z=document.createElement("div");z.className="ancestry-node-label ".concat(B?"target":"normal"),z.textContent=T,N.appendChild(z),b.appendChild(N)}b.setAttribute("class","ancestry-node"),D.addEventListener("click",T=>{T.stopPropagation(),document.getElementById("ancestryModal")?.remove(),this.navigateToGoroutine(k.data.goroutine.id,n.id)}),b.addEventListener("click",T=>{T.stopPropagation(),this.centerAncestryTreeOnNode(k.data.goroutine.id)}),b.addEventListener("mouseenter",()=>{B||A.setAttribute("fill","var(--bg-secondary, #555)")}),b.addEventListener("mouseleave",()=>{B||A.setAttribute("fill","var(--bg-tertiary, #444)")}),v.appendChild(b)}),S.appendChild(v),x.appendChild(S),t.appendChild(x),this.centerOnTargetNode(S,l,n.id,o,s,h,g),this.addZoomPanControls(t,x,S,y,w,o,s),this.setupAncestryZoomControls(t,S,o,s,n.id)}addZoomPanControls(t,e,n,i,a,o,s){const l=n.__currentTransform;let c=l?.scale??1,u=l?.translateX??0,d=l?.translateY??0,h=!1,p=0,g=0;const f=()=>{const w=n.__currentTransform;w&&(c=w.scale,u=w.translateX,d=w.translateY),n.setAttribute("transform","translate(".concat(u,", ").concat(d,") scale(").concat(c,")"))};e.addEventListener("wheel",w=>{w.preventDefault();const x=w.deltaY>0?.97:1.03,S=Math.max(.1,Math.min(3,c*x));if(S!==c){const v=o/2,M=s/2,k=(v-u)/c,b=(M-d)/c;c=S,u=v-k*c,d=M-b*c;const B=n.__currentTransform;B&&(B.scale=c,B.translateX=u,B.translateY=d),f()}}),e.addEventListener("mousedown",w=>{(w.target===e||w.target.closest("#zoomGroup")===n)&&(h=!0,p=w.clientX,g=w.clientY,e.classList.add("grabbing"))}),document.addEventListener("mousemove",w=>{if(h){w.preventDefault(),document.getSelection()?.removeAllRanges();const x=w.clientX-p,S=w.clientY-g;u+=x,d+=S,p=w.clientX,g=w.clientY;const v=n.__currentTransform;v&&(v.translateX=u,v.translateY=d),f()}}),document.addEventListener("mouseup",()=>{h&&(h=!1,e.classList.remove("grabbing"))}),n.__currentTransform={scale:c,translateX:u,translateY:d},n.__updateTransform=f;const y=n.__currentTransform;y&&(c=y.scale,u=y.translateX,d=y.translateY)}setupAncestryZoomControls(t,e,n,i,a){const o=t.closest(".ancestry-modal");if(!o)return;const s=o.querySelector(".ancestry-zoom-in"),l=o.querySelector(".ancestry-zoom-out"),c=o.querySelector(".ancestry-fit-view"),u=e.__currentTransform,d=e.__updateTransform;s&&u&&d&&s.addEventListener("click",()=>{const h=Math.min(3,u.scale*1.2);if(h!==u.scale){const p=n/2,g=i/2,f=(p-u.translateX)/u.scale,y=(g-u.translateY)/u.scale;u.scale=h,u.translateX=p-f*u.scale,u.translateY=g-y*u.scale,d()}}),l&&u&&d&&l.addEventListener("click",()=>{const h=Math.max(.1,u.scale*.8);if(h!==u.scale){const p=n/2,g=i/2,f=(p-u.translateX)/u.scale,y=(g-u.translateY)/u.scale;u.scale=h,u.translateX=p-f*u.scale,u.translateY=g-y*u.scale,d()}}),c&&c.addEventListener("click",()=>{this.centerAncestryTreeOnNode(a,.8)})}centerOnTargetNode(t,e,n,i,a,o,s){const l=e.descendants().find(g=>g.data.goroutine.id===n);if(!l)return;const c=(l.y??0)-s,u=(l.x??0)-o,d=.8,h=i/2-c*d,p=a/2-u*d;t.setAttribute("transform","translate(".concat(h,", ").concat(p,") scale(").concat(d,")")),t.__currentTransform={scale:d,translateX:h,translateY:p}}centerAncestryTreeOnNode(t,e){const n=document.getElementById("ancestryModal");if(!n)return;const i=n.querySelector("#zoomGroup");if(!i)return;const a=n.querySelectorAll("tspan");let o=null;for(let w=0;w<a.length;w++){const x=a[w];if(x.textContent===t){let S=x.parentElement;for(;S&&S.tagName!=="g";)S=S.parentElement;if(S&&S.tagName==="g"&&S.getAttribute("transform")){o=S;break}}}if(!o)return;const s=o.getAttribute("transform");if(!s)return;const l=s.match(/translate\(([^,]+),\s*([^)]+)\)/);if(!l)return;const c=parseFloat(l[1]),u=parseFloat(l[2]),d=n.querySelector(".ancestry-tree-container");if(!d)return;const h=d.getBoundingClientRect(),p=h.width,g=h.height,f=i.__currentTransform,y=i.__updateTransform;if(f&&y){const S=(i.querySelector("g")?.getAttribute("transform")||"").match(/translate\(([^,]+),\s*([^)]+)\)/),v=S?parseFloat(S[1]):0,M=S?parseFloat(S[2]):0,k=c+v,b=u+M;e!==void 0?(f.scale=e,f.translateX=p/2-k*e,f.translateY=g/2-b*e):f.scale<.8?(f.scale=.8,f.translateX=p/2-k*.8,f.translateY=g/2-b*.8):(f.translateX=p/2-k*f.scale,f.translateY=g/2-b*f.scale),i.style.transition="transform 0.3s ease-out",y(),setTimeout(()=>{i.style.transition=""},300)}}}window.StackgazerApp=tn;</script>
  <style rel="stylesheet" crossorigin>#stackgazer{--bg-primary: #1e1e1e;--bg-secondary: #252526;--bg-tertiary: #2d2d30;--bg-quaternary: #3c3c3c;--bg-overlay: rgba(0, 0, 0, .5);--text-primary: #d4d4d4;--text-secondary: #bbb;--text-muted: #888;--text-link: #007acc;--text-link-hover: #4fc3f7;--border-primary: #3e3e42;--border-secondary: #555;--border-light: #464647;--accent-primary: #007acc;--accent-primary-hover: #0087d4;--header-hover-light: #4a4a4a;--accent-border: #007acc;--accent-danger: #d73a49;--accent-danger-hover: #e03e53;--accent-success: #4caf50;--code-function: #4ec9b0;--code-file: #9cdcfe;--code-line: #b5cea8;--code-keyword: #569cd6;--code-string: #d7ba7d;--code-bg: #2d2d30}#stackgazer[data-theme=light]{--bg-primary: #ffffff;--bg-secondary: #f8f9fa;--bg-tertiary: #f5f7fa;--bg-quaternary: #e9ecef;--bg-overlay: rgba(255, 255, 255, .7);--text-primary: #242a35;--text-secondary: #495057;--text-muted: #6c757d;--text-link: #6933ff;--text-link-hover: #5a2dd9;--border-primary: #d6dbe7;--border-secondary: #ced4da;--border-light: #dee2e6;--accent-primary: #6933ff;--accent-primary-hover: #5a2dd9;--header-hover-light: #e6f3ff;--accent-border: #c1c7d0;--accent-danger: #dc3545;--accent-danger-hover: #c82333;--accent-success: #28a745;--code-function: #0969da;--code-file: #098658;--code-line: #0451a5;--code-keyword: #0969da;--code-string: #032f62;--code-bg: #f8f9fa}#stackgazer *{margin:0;padding:0;box-sizing:border-box}#stackgazer{font-family:Monaco,Menlo,Ubuntu Mono,monospace;background:var(--bg-primary);color:var(--text-primary);height:100vh;width:100%;overflow:hidden;position:relative;margin:0;padding:0;border:none;outline:none;box-sizing:border-box;display:block}#stackgazer .btn{background:var(--accent-primary);border:none;color:#fff;padding:8px 12px;border-radius:4px;cursor:pointer;font-family:inherit;font-size:12px;transition:all .2s ease}#stackgazer .btn:hover{background:var(--accent-primary-hover)}#stackgazer .btn:disabled{background:var(--border-secondary);cursor:not-allowed;opacity:.5}#stackgazer .btn:disabled:hover{background:var(--border-secondary)}#stackgazer .btn-danger{background:var(--accent-danger)}#stackgazer .btn-danger:hover{background:var(--accent-danger-hover)}#stackgazer .modal{display:none;position:absolute;z-index:10000;left:0;top:0;width:100%;height:100%;background-color:var(--bg-overlay)}#stackgazer .modal-content{background-color:var(--bg-tertiary);margin:5% auto;border:1px solid var(--border-primary);border-radius:8px;width:90%;max-width:700px;max-height:80vh;box-shadow:0 4px 20px var(--bg-overlay);display:flex;flex-direction:column;position:relative;z-index:10001;overflow:visible}#stackgazer .modal-header{padding:20px 25px 15px;border-bottom:1px solid var(--border-primary);display:flex;justify-content:space-between;align-items:center;background:var(--bg-secondary);border-radius:8px 8px 0 0}#stackgazer .modal-close{background:none;border:none;color:var(--text-muted);font-size:24px;font-weight:700;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .2s ease}#stackgazer .modal-close:hover{background:var(--border-primary);color:var(--text-primary)}#stackgazer .modal-body{padding:25px;color:var(--text-primary);line-height:1.6;flex:1;overflow-y:auto;overflow-x:visible}#stackgazer .container{display:flex;height:100vh}#stackgazer .sidebar{width:300px;background:var(--bg-secondary);border-right:1px solid var(--border-primary);padding:20px;overflow-y:auto}#stackgazer .main-content{flex:1;display:flex;flex-direction:column;overflow:hidden}#stackgazer .view-controls-bar{background:var(--bg-secondary);border-bottom:1px solid var(--border-primary);padding:10px 20px;display:flex;align-items:center;gap:15px;flex-wrap:wrap;min-height:50px}#stackgazer .view-controls-bar .view-controls{display:flex;flex-direction:row;gap:10px;flex-wrap:wrap}#stackgazer .view-controls-bar .left-controls{display:flex;align-items:center;gap:15px;flex:1}#stackgazer .view-controls-bar .right-controls{display:flex;align-items:center;gap:10px}#stackgazer .view-controls-bar select{background:var(--bg-quaternary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);font-family:inherit;font-size:11px;padding:4px 8px}#stackgazer .view-controls-bar select:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .view-controls-bar .control-btn{padding:6px 12px;font-size:11px;min-width:80px}#stackgazer .view-controls-bar label{display:flex;align-items:center;gap:6px;color:var(--text-primary);font-size:11px;white-space:nowrap}#stackgazer .drop-zone{flex:1;display:flex;align-items:center;justify-content:center;border:2px dashed var(--accent-border);margin:20px;border-radius:8px;transition:all .3s ease;cursor:pointer}#stackgazer .drop-zone.dragover{border-color:var(--text-link-hover);background:color-mix(in srgb,var(--accent-primary) 10%,transparent)}#stackgazer .drop-zone.has-content{align-items:flex-start;justify-content:flex-start;padding:0;border:none;margin:0;border-radius:0;overflow-y:auto}#stackgazer .drop-message{text-align:center;color:var(--accent-primary);font-size:18px}#stackgazer .filter-section{margin-bottom:20px}#stackgazer .filter-section h3{color:var(--accent-primary);margin-bottom:10px;font-size:14px}#stackgazer .filter-input{width:100%;padding:8px;background:var(--bg-quaternary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);font-family:inherit;margin-bottom:10px}#stackgazer .filter-input:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .filter-input.error{border-color:var(--accent-danger);background:color-mix(in srgb,var(--accent-danger) 10%,transparent)}#stackgazer .filter-error{font-size:11px;color:var(--accent-danger);margin-top:4px;padding:4px 8px;background:color-mix(in srgb,var(--accent-danger) 10%,transparent);border-radius:4px;border:1px solid var(--accent-danger)}#stackgazer .stack-display{width:100%;height:100%;overflow-y:auto;padding:20px;white-space:pre-wrap;font-size:12px;line-height:1.4;box-sizing:border-box}#stackgazer .stack-group,#stackgazer .stack-section,#stackgazer .section.stack-section{margin-bottom:20px;border:2px solid var(--accent-border);border-radius:8px;cursor:text;-webkit-user-select:text;user-select:text;position:relative}#stackgazer .header{background:var(--accent-primary);color:#fff;padding:12px 15px;font-weight:700;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:14px;display:flex;justify-content:space-between;align-items:center;gap:8px;position:relative}#stackgazer .header:hover{background:var(--accent-primary-hover)}#stackgazer .file-section .header{background:var(--bg-quaternary);color:var(--text-primary)}#stackgazer .file-section .header:hover{background:var(--header-hover-light)}#stackgazer .file-section.single-group>.header{display:none}#stackgazer .file-section .group-section .header{background:var(--bg-quaternary);color:var(--text-primary)}#stackgazer .file-section .group-section .header:hover{background:var(--header-hover-light)}#stackgazer .group-title,#stackgazer .stack-title,#stackgazer .category-title{cursor:text;-webkit-user-select:text;user-select:text;flex:0 1 auto;display:flex;align-items:center;gap:12px;min-width:0}#stackgazer .stack-title:before{content:"â†³";margin-right:-4px;opacity:1;font-size:1.1em;position:relative;top:-3px}#stackgazer .group-title-text{font-weight:700;color:#fff}#stackgazer .group-title-summary{font-weight:400;color:color-mix(in srgb,var(--text-primary) 80%,transparent);font-size:13px;padding-left:12px;border-left:1px solid color-mix(in srgb,var(--text-primary) 30%,transparent)}#stackgazer .group-count,#stackgazer .stack-count{font-weight:400;font-size:13px;text-align:right}#stackgazer .group-controls{display:flex;gap:5px}#stackgazer .group-control-btn{background:color-mix(in srgb,var(--text-primary) 20%,transparent);border:none;color:#fff;padding:4px 8px;border-radius:3px;cursor:pointer;font-family:inherit;font-size:10px}#stackgazer .group-control-btn:hover{background:color-mix(in srgb,var(--text-primary) 30%,transparent)}#stackgazer .pin-button{--pin-size: 28px;--pin-font: 16px;--pin-top: -14px;--pin-right: -14px;--pin-z: 10;--pin-hover-size: 53px;--pin-hover-font: 26px;--pin-hover-offset: -26px;--pin-pinned-size: 36px;--pin-pinned-font: 18px;--pin-pinned-offset: -18px;--pin-target-size: 24px;position:absolute;background:var(--bg-quaternary);border:1px solid var(--border-secondary);color:var(--text-muted);border-radius:50%;cursor:pointer;font-family:inherit;transition:all .2s ease;opacity:0;display:flex;align-items:center;justify-content:center;font-weight:400;width:var(--pin-size);height:var(--pin-size);font-size:var(--pin-font);top:var(--pin-top);right:var(--pin-right);z-index:var(--pin-z)}#stackgazer .pin-button.size-small{--pin-size: 18px;--pin-font: 10px;--pin-top: 3px;--pin-right: -25px;--pin-z: 5;--pin-hover-size: 32px;--pin-hover-font: 16px;--pin-hover-offset: -30px;--pin-hover-top: -4px;--pin-pinned-size: 20px;--pin-pinned-font: 11px;--pin-pinned-top: 2px;--pin-pinned-offset: -27px;--pin-target-size: 16px}#stackgazer .section:hover>.header>.pin-button:not(.pinned),#stackgazer .goroutine-entry:hover>.pin-button:not(.pinned){opacity:.7}#stackgazer .pin-button:before{content:"";position:absolute;top:calc(var(--pin-target-size) * -1);left:calc(var(--pin-target-size) * -1);right:calc(var(--pin-target-size) * -1);bottom:calc(var(--pin-target-size) * -1);border-radius:50%}#stackgazer .pin-button:hover{background:var(--bg-quaternary);border-color:var(--border-primary);color:var(--text-primary);opacity:1!important;width:var(--pin-hover-size);height:var(--pin-hover-size);font-size:var(--pin-hover-font);top:calc(var(--pin-top) - (var(--pin-hover-size) - var(--pin-size)) / 2);right:calc(var(--pin-right) - (var(--pin-hover-size) - var(--pin-size)) / 2)}#stackgazer .pin-button.size-small:hover{top:calc(var(--pin-top) - (var(--pin-hover-size) - var(--pin-size)) / 2);right:calc(var(--pin-right) - (var(--pin-hover-size) - var(--pin-size)) / 2)}#stackgazer .pin-button.pinned{background:var(--bg-quaternary);opacity:1!important;border:2px solid var(--border-primary);color:var(--text-primary);width:var(--pin-pinned-size);height:var(--pin-pinned-size);font-size:var(--pin-pinned-font);top:var(--pin-top);right:var(--pin-right)}#stackgazer .pin-button.size-small.pinned{top:var(--pin-top)}#stackgazer .pin-button.pinned:hover{color:var(--text-primary);border:2px solid var(--text-primary);width:var(--pin-hover-size);height:var(--pin-hover-size);font-size:var(--pin-hover-font);top:calc(var(--pin-top) - (var(--pin-hover-size) - var(--pin-pinned-size)) / 2);right:calc(var(--pin-right) - (var(--pin-hover-size) - var(--pin-pinned-size)) / 2)}#stackgazer .pin-button.size-small.pinned:hover{top:calc(var(--pin-top) - (var(--pin-hover-size) - var(--pin-pinned-size)) / 2);right:calc(var(--pin-right) - (var(--pin-hover-size) - var(--pin-pinned-size)) / 2)}#stackgazer .header .counts{margin-right:36px;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .header-right{display:flex;flex-direction:column;align-items:flex-end;gap:2px}#stackgazer .category-stats,#stackgazer .stack-stats{font-size:9px;color:color-mix(in srgb,white 60%,transparent);white-space:nowrap;text-align:right;margin-right:36px;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .category-stats:empty,#stackgazer .stack-stats:empty{display:none}#stackgazer .group-content,#stackgazer .stack-content{background:var(--bg-tertiary);padding-bottom:1px}#stackgazer .group-content.collapsed-container,#stackgazer .stack-content.collapsed-container{display:none}#stackgazer .unique-stack-view{background:var(--bg-tertiary);border:1px solid var(--border-primary);border-radius:6px;margin:10px;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .unique-stack-header{background:var(--bg-quaternary);color:var(--text-primary);padding:8px 15px;font-size:12px;font-weight:700;border-bottom:1px solid var(--border-primary);border-radius:6px 6px 0 0;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .unique-stack-content{padding:15px;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .state-group{background:var(--bg-quaternary);margin:10px;border-radius:4px;overflow:visible}#stackgazer .state-group-header{background:var(--bg-quaternary);color:var(--text-primary);padding:8px 12px;font-weight:700;font-size:11px;cursor:pointer;-webkit-user-select:none;user-select:none;display:flex;justify-content:space-between;align-items:center}#stackgazer .state-group-header:hover{background:var(--header-hover-light)}#stackgazer .state-group-content{display:block}#stackgazer .state-group-content.collapsed-section{display:none}#stackgazer .remaining-goroutines{display:block}#stackgazer .remaining-goroutines.collapsed-section{display:none}#stackgazer .show-more-link{padding:6px 12px;margin:0;background:transparent;border:none;cursor:pointer;text-align:center;color:var(--accent-primary);font-size:11px;transition:color .2s;border-bottom:1px dashed var(--border-primary)}#stackgazer .show-more-link:hover{color:var(--text-link-hover)}#stackgazer .show-more-text{-webkit-user-select:none;user-select:none}#stackgazer .goroutine-entry{background:transparent;border-bottom:1px dashed var(--border-primary);overflow:visible;cursor:text;-webkit-user-select:text;user-select:text;position:relative}#stackgazer .goroutine-entry:last-child{border-bottom:none}#stackgazer .goroutine-entry.highlighted{background:color-mix(in srgb,var(--accent-primary) 25%,transparent)!important;transition:background-color .3s ease}#stackgazer .goroutine-header{background:transparent;color:var(--text-primary);padding:6px 12px;font-size:11px;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .goroutine-header-first-line{display:flex;justify-content:space-between;align-items:center}#stackgazer .goroutine-header-left{display:flex;align-items:center;gap:4px}#stackgazer .group-header-left{display:flex;align-items:center;gap:6px}#stackgazer .goroutine-header-second-line{margin-top:4px;font-size:10px;color:var(--text-secondary);font-style:italic}#stackgazer .created-goroutines-label,#stackgazer .created-goroutines-more{color:var(--text-muted)}#stackgazer .created-goroutines-more.clickable{color:var(--text-link);cursor:pointer;text-decoration:underline}#stackgazer .created-goroutines-more.clickable:hover{color:var(--text-link-hover)}#stackgazer .goroutine-header:hover{background:var(--bg-quaternary)}#stackgazer .goroutine-created-by{font-size:10px;color:var(--text-muted);font-style:italic}#stackgazer .goroutine-created-by .creator-link{color:var(--text-link);cursor:pointer;text-decoration:underline}#stackgazer .goroutine-created-by .creator-link:hover{color:var(--text-link-hover)}#stackgazer .goroutine-created-by .creator-missing{color:var(--text-muted);text-decoration:line-through}#stackgazer .goroutine-stack{padding:10px 15px;display:none}#stackgazer .goroutine-stack.expanded{display:block}#stackgazer .stack-line{margin-bottom:2px}#stackgazer .stack-trace{background:var(--code-bg);margin:10px;padding:10px;border-radius:4px;border:1px solid var(--border-secondary);cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .trace-header{font-weight:700;color:var(--accent-primary);margin-bottom:8px;font-size:12px}#stackgazer .section{background:var(--bg-tertiary);margin:10px;border:1px solid var(--border-primary);border-radius:4px;position:relative}#stackgazer .file-section .group-section{margin:0 0 0 10px;border-radius:0;border-left:none;border-right:none}#stackgazer .file-section.single-group .group-section{margin-left:0}#stackgazer .file-section .group-section:first-child{border-top-left-radius:4px;border-top-right-radius:4px;border-top:1px solid var(--border-primary)}#stackgazer .file-section .group-section:last-child{border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-bottom:1px solid var(--border-primary)}#stackgazer .file-section .group-section:only-child{border:1px solid var(--border-primary);border-radius:4px}#stackgazer .category-section{border-radius:12px}#stackgazer .category-section>.header{position:sticky;top:-23px;z-index:100;border-radius:6px 6px 0 0}#stackgazer .stack-section>.header{position:sticky;top:20px;z-index:90}#stackgazer .category-section>.header .pin-button{--pin-top: 5px;--pin-hover-offset: -21px}#stackgazer .stack-section>.header .pin-button{--pin-top: 5px;--pin-hover-offset: -21px}#stackgazer .section-content{padding:10px;transition:all .2s ease}#stackgazer .file-section>.section-content{padding:0}#stackgazer .expandable.container-collapsed>.section-content{display:none}#stackgazer .expandable.section-collapsed>.section-content{display:none}#stackgazer .group-section .section-content:empty{display:none}#stackgazer .expandable .expand-icon:before{content:"â–¼";margin-right:6px}#stackgazer .expandable.container-collapsed .expand-icon:before,#stackgazer .expandable.section-collapsed .expand-icon:before{content:"â–¶"}#stackgazer .custom-rules-section .custom-rules-title h5:before{content:"â–¼";margin-right:6px;font-size:10px;color:var(--text-muted);transition:transform .2s ease}#stackgazer .custom-rules-section.settings-collapsed .custom-rules-title h5:before{content:"â–¶"}#stackgazer .group-labels{margin-top:8px;font-size:10px;color:var(--text-muted);font-style:italic}#stackgazer .function-name{color:var(--code-function);word-break:break-all;overflow-wrap:break-word}#stackgazer .file-path{color:var(--code-file);word-break:break-all;overflow-wrap:break-word}#stackgazer .line-number{color:var(--code-line)}#stackgazer .function-args-short{color:var(--text-secondary);font-size:10px;cursor:pointer}#stackgazer .function-args-short:hover{color:var(--text-muted)}#stackgazer .function-args-full{color:var(--text-primary);font-size:10px}#stackgazer .creator-link{color:var(--code-keyword);cursor:pointer;text-decoration:underline;transition:color .2s ease}#stackgazer .creator-link:hover{color:var(--text-link-hover);text-decoration:underline}#stackgazer .goroutine-tooltip{position:absolute;background:var(--bg-tertiary);border:1px solid var(--border-light);border-radius:4px;padding:8px 12px;font-size:12px;color:var(--text-primary);box-shadow:0 4px 8px var(--bg-overlay);z-index:1000;pointer-events:none;max-width:800px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#stackgazer .goroutine-tooltip .tooltip-label{font-weight:700;color:var(--code-keyword)}#stackgazer .goroutine-tooltip .tooltip-value{color:var(--code-string)}#stackgazer .goroutine-tooltip .tooltip-stack{margin-top:4px;font-family:Courier New,monospace;font-size:11px;color:var(--code-file)}#stackgazer .creator-missing{text-decoration:line-through}#stackgazer .created-by-line{margin-top:5px;padding-top:5px;border-top:1px solid var(--border-primary)}#stackgazer .created-by-text{color:var(--text-muted)}#stackgazer .stats{background:var(--bg-tertiary);padding:15px;border-bottom:1px solid var(--border-primary);font-size:12px}#stackgazer .stats-item{margin-bottom:5px;display:flex;justify-content:space-between}#stackgazer .state-stats{margin-top:10px;padding-top:10px;border-top:1px solid var(--border-light)}#stackgazer .state-stats div{display:flex;justify-content:space-between;margin-bottom:2px;font-size:11px;color:var(--text-secondary)}#stackgazer .state-stat-item{margin-bottom:3px;font-size:11px;color:var(--text-secondary)}#stackgazer .state-item{cursor:pointer;padding:2px 4px;border-radius:2px;transition:background-color .2s}#stackgazer .state-item:hover{background-color:var(--border-primary)}#stackgazer .state-item.state-only{background-color:color-mix(in srgb,var(--accent-primary) 20%,transparent);color:var(--accent-primary);font-weight:700}#stackgazer .state-item.state-excluded{text-decoration:line-through;color:var(--accent-danger)}#stackgazer .state-item.state-grayed{opacity:.5;color:var(--text-secondary)}#stackgazer .sidebar .view-controls{display:none}#stackgazer .control-btn{background:var(--accent-primary);border:none;color:#fff;padding:8px 12px;border-radius:4px;cursor:pointer;font-family:inherit;font-size:12px;transition:all .2s ease}#stackgazer .control-btn:hover{background:var(--accent-primary-hover)}#stackgazer .control-btn:disabled{background:var(--border-secondary);cursor:not-allowed;opacity:.5}#stackgazer .control-btn:disabled:hover{background:var(--border-secondary)}#stackgazer .clear-btn{padding:8px 16px;width:100%;margin-top:10px}#stackgazer .file-section{margin-bottom:10px}#stackgazer .file-list-container{border:1px solid var(--border-secondary);border-radius:6px;background:var(--bg-tertiary);transition:all .3s ease;min-height:40px}#stackgazer .file-list-container.dragover{border-color:var(--accent-primary);background:color-mix(in srgb,var(--accent-primary) 10%,transparent)}#stackgazer .file-list{max-height:200px;overflow-y:auto;overflow-x:hidden}#stackgazer .file-item{display:flex;align-items:center;background:var(--bg-quaternary);padding:8px 10px;margin:5px 5px 0;border-radius:4px;font-size:12px;gap:8px}#stackgazer .file-item:last-child{margin-bottom:5px}#stackgazer .file-item.file-hidden{opacity:.5;background:var(--bg-secondary)}#stackgazer .file-item.file-hidden .file-name-text{color:var(--text-muted);text-decoration:line-through}#stackgazer .file-item:hover{background:var(--border-primary)}#stackgazer .file-item.file-hidden:hover{background:var(--bg-quaternary)}#stackgazer .file-name-text{flex:1;margin-right:8px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#stackgazer .file-name-text{display:inline-block;cursor:pointer;border-radius:2px;padding:1px 2px;transition:all .2s;position:relative}#stackgazer .file-name-text:hover{background-color:color-mix(in srgb,var(--text-primary) 10%,transparent);transform:translateY(-1px)}#stackgazer .file-name-text:hover:after{content:"âœï¸";position:absolute;right:-16px;top:50%;transform:translateY(-50%);font-size:10px;opacity:.7}#stackgazer .file-name-text.editing{background-color:var(--accent-primary);color:#fff;outline:2px solid var(--text-link-hover);outline-offset:1px;cursor:text;border-radius:3px;padding:2px 4px;box-shadow:0 0 8px color-mix(in srgb,var(--text-link-hover) 40%,transparent)}#stackgazer .file-name-text.editing:focus{background-color:var(--accent-primary-hover);outline-color:var(--text-link-hover);box-shadow:0 0 12px color-mix(in srgb,var(--text-link-hover) 60%,transparent)}#stackgazer .file-remove-btn{background:var(--accent-danger);border:none;color:#fff;border-radius:50%;width:18px;height:18px;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;line-height:1;transition:all .2s ease}#stackgazer .file-remove-btn:hover{background:var(--accent-danger-hover);transform:scale(1.1)}#stackgazer .file-stats{font-size:10px;color:var(--text-muted);white-space:nowrap;flex-shrink:0}#stackgazer .file-drop-area{padding:8px;text-align:center;color:var(--text-muted);font-size:10px;opacity:.7;cursor:pointer;border-top:1px dashed var(--border-secondary);margin-top:5px;display:none}#stackgazer .file-list-container:hover .file-drop-area,#stackgazer .file-list-container.dragover .file-drop-area{opacity:1}#stackgazer .file-list-container.has-files .file-drop-area{display:block}#stackgazer .empty-state{padding:15px;text-align:center;color:var(--text-muted);font-size:11px}#stackgazer .add-file-btn{background:transparent;border:1px solid var(--border-secondary);color:var(--text-muted);border-radius:50%;width:14px;height:14px;font-size:8px;font-weight:400;cursor:pointer;margin-left:2px;vertical-align:middle;display:inline-flex;align-items:center;justify-content:center;line-height:1;opacity:.6}#stackgazer .add-file-btn:hover{background:var(--border-primary);color:var(--text-primary);border-color:var(--text-muted);opacity:1}#stackgazer .clear-all-btn{background:transparent;border:1px solid var(--accent-danger);color:var(--accent-danger);border-radius:50%;width:16px;height:16px;font-size:10px;font-weight:700;cursor:pointer;margin-left:8px;margin-bottom:10px;vertical-align:middle;display:inline-flex;align-items:center;justify-content:center;line-height:1;opacity:.7}#stackgazer .clear-all-btn:hover{background:var(--accent-danger);color:#fff;opacity:1}#stackgazer .files-header,#stackgazer .filter-header{display:flex;align-items:center;justify-content:space-between;width:100%}#stackgazer .files-title{display:flex;align-items:center}#stackgazer .filter-help-btn{background:transparent;border:1px solid var(--border-secondary);color:var(--text-secondary);border-radius:50%;width:14px;height:14px;font-size:8px;font-weight:400;cursor:pointer;margin-left:2px;vertical-align:middle;display:inline-flex;align-items:center;justify-content:center;line-height:1;opacity:.6}#stackgazer .filter-help-btn:hover{background:var(--border-primary);color:var(--text-primary);border-color:var(--text-secondary);opacity:1}#stackgazer .modal-header h3{color:var(--accent-primary);margin:0;font-size:18px}#stackgazer .modal-body h4{color:var(--accent-primary);margin:20px 0 10px;font-size:14px;border-bottom:1px solid var(--border-primary);padding-bottom:5px}#stackgazer .modal-body h4:first-child{margin-top:0}#stackgazer .modal-body ul{margin:10px 0 20px 20px;padding:0}#stackgazer .modal-body li{margin-bottom:8px;list-style-type:disc}#stackgazer .modal-body code{background:var(--bg-quaternary);border:1px solid var(--border-secondary);border-radius:3px;padding:2px 6px;font-family:Monaco,Menlo,Ubuntu Mono,monospace;font-size:11px;color:var(--code-function)}#stackgazer .modal-body p{margin:10px 0}#stackgazer .modal-body strong{color:var(--accent-success)}#stackgazer .side-by-side-container{width:100%}#stackgazer .side-by-side-headers{display:flex;gap:20px;margin-bottom:5px}#stackgazer .side-by-side-headers .column-header{flex:1;background:var(--bg-quaternary);color:var(--text-primary);padding:6px 10px;font-weight:700;font-size:11px;border-radius:4px 4px 0 0}#stackgazer .side-by-side-row{display:flex;gap:20px;margin-bottom:1px;align-items:flex-start}#stackgazer .function-side,#stackgazer .location-side{flex:1;padding:2px 10px;border-left:2px solid var(--accent-primary);min-height:20px;display:flex;align-items:flex-start;flex-wrap:wrap;word-break:break-all;overflow-wrap:break-word;min-width:0}#stackgazer .function-side{background:color-mix(in srgb,var(--code-function) 10%,transparent)}#stackgazer .location-side{background:color-mix(in srgb,var(--code-file) 10%,transparent)}#stackgazer .creator-function{color:var(--code-function);font-weight:700}#stackgazer .settings-container{position:absolute;bottom:15px;left:15px;display:flex;gap:10px}#stackgazer .settings-btn{background:transparent;border:1px solid var(--border-secondary);color:var(--text-muted);border-radius:50%;width:32px;height:32px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:.6;transition:all .2s ease}#stackgazer .settings-btn:hover{background:var(--border-primary);color:var(--text-primary);border-color:var(--text-muted);opacity:1;transform:rotate(90deg)}#stackgazer .theme-toggle-btn{background:transparent;border:1px solid var(--border-secondary);color:var(--text-muted);border-radius:50%;width:32px;height:32px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:.6;transition:all .2s ease}#stackgazer .theme-toggle-btn:hover{background:var(--border-primary);color:var(--text-primary);border-color:var(--text-muted);opacity:1}#stackgazer .github-btn{background:transparent;border:1px solid var(--border-secondary);color:var(--text-secondary);border-radius:50%;width:32px;height:32px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:.6;transition:all .2s ease;text-decoration:none;position:relative}#stackgazer .github-btn:after{content:"";width:16px;height:16px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23bbb'%3E%3Cpath d='M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z'/%3E%3C/svg%3E");background-size:16px 16px;background-repeat:no-repeat;background-position:center}#stackgazer .github-btn:hover{background:var(--border-primary);color:var(--text-primary);border-color:var(--text-muted);opacity:1}#stackgazer .setting-group{margin-bottom:20px;padding:15px;background:var(--bg-quaternary);border-radius:6px;border:1px solid var(--border-secondary)}#stackgazer .setting-title{display:flex;align-items:center;gap:6px;margin-bottom:8px;font-weight:700;color:var(--text-primary);font-size:14px}#stackgazer .setting-help-icon{background:transparent;border:1px solid var(--text-muted);color:var(--text-muted);border-radius:50%;width:16px;height:16px;font-size:10px;font-weight:700;cursor:help;display:flex;align-items:center;justify-content:center;position:relative;opacity:.8;transition:all .2s ease}#stackgazer .setting-help-icon:hover{background:var(--bg-quaternary);color:var(--text-primary);border-color:var(--text-secondary);opacity:1}#stackgazer .setting-help-icon[data-tooltip]:hover:after{content:attr(data-tooltip);position:absolute;left:0;top:24px;background:var(--bg-primary);color:var(--text-primary);padding:8px 12px;border-radius:6px;font-size:11px;font-weight:400;line-height:1.4;white-space:pre-line;width:320px;text-align:left;box-shadow:0 4px 12px color-mix(in srgb,var(--bg-overlay) 80%,transparent);border:1px solid var(--border-secondary);z-index:10002;pointer-events:none}#stackgazer .setting-help-icon[data-tooltip]:hover:before{content:"";position:absolute;left:8px;top:20px;border:4px solid transparent;border-bottom-color:var(--border-secondary);z-index:10003;pointer-events:none}#stackgazer .setting-label{display:block;cursor:pointer;color:var(--text-primary);font-size:13px}#stackgazer .setting-checkbox-label{display:flex;align-items:center;gap:8px;cursor:pointer;color:var(--text-primary);font-size:13px}#stackgazer .setting-checkbox-text{color:var(--text-primary)}#stackgazer .setting-text{font-weight:700;margin-left:8px}#stackgazer .setting-description{font-size:11px;color:var(--text-muted);margin-top:8px;line-height:1.4}#stackgazer .setting-checkbox{width:16px;height:16px;margin:0;vertical-align:middle}#stackgazer .setting-input{background:var(--bg-tertiary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);padding:6px 10px;font-family:inherit;font-size:12px;width:80px;margin-top:4px}#stackgazer .setting-input:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .setting-text-input{background:var(--bg-tertiary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);padding:6px 10px;font-family:inherit;font-size:12px;width:100%;margin-top:4px}#stackgazer .setting-text-input:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .setting-text-input::placeholder{color:var(--text-muted);font-style:italic}#stackgazer .setting-textarea{background:var(--bg-tertiary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);padding:8px 10px;font-family:SF Mono,Monaco,Inconsolata,Roboto Mono,monospace;font-size:11px;width:100%;margin-top:4px;resize:vertical;min-height:60px}#stackgazer .setting-textarea:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .setting-textarea::placeholder{color:var(--text-muted);font-style:italic}#stackgazer .rules-editor{border:1px solid var(--border-secondary);border-radius:4px;background:var(--bg-secondary);margin-bottom:8px;overflow:hidden;padding:0}#stackgazer .rules-list{border:none;border-radius:0;background:transparent;margin-bottom:0;overflow:hidden}#stackgazer .rule-item{background:transparent;border:none;border-bottom:1px solid var(--border-secondary);border-radius:0;padding:0 4px 0 0;margin-bottom:0;display:flex;align-items:flex-start;gap:8px;min-height:20px}#stackgazer .rule-item:last-child{border-bottom:none}#stackgazer .rule-item:hover{background:var(--bg-quaternary)}#stackgazer .rule-controls{display:flex;align-items:center;gap:8px;width:100%;flex-wrap:nowrap;margin:0;padding:0}#stackgazer .rule-type-select{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border-primary);border-radius:4px;padding:4px 8px;font-size:12px;min-width:80px}#stackgazer .rule-pattern,#stackgazer .rule-to,#stackgazer .rule-while-custom{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border-primary);border-radius:4px;padding:4px 8px;font-size:12px;flex:1;min-width:120px}#stackgazer .rule-pattern{min-width:180px}#stackgazer .rule-to{min-width:100px}#stackgazer .rule-while{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border-primary);border-radius:4px;padding:4px 8px;font-size:12px;min-width:90px}#stackgazer .rule-while-custom{min-width:100px}#stackgazer .remove-rule-btn{background:transparent;color:var(--text-muted);border:none;border-radius:0;width:20px;height:20px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;opacity:.6}#stackgazer .remove-rule-btn:hover{color:var(--accent-danger);opacity:1}#stackgazer .footer-buttons{display:flex;gap:4px;padding:6px 12px;border-top:1px solid var(--border-secondary)}#stackgazer .rules-editor.collapsed-settings .rules-list,#stackgazer .rules-editor.collapsed-settings .footer-buttons{display:none}#stackgazer .add-rule-btn{background:transparent;color:var(--text-secondary);border:1px solid var(--border-secondary);border-radius:3px;padding:4px 8px;font-size:10px;cursor:pointer;transition:all .2s;flex:1}#stackgazer .add-rule-btn:hover{background:var(--accent-primary);color:#fff;border-color:var(--accent-primary)}#stackgazer .rule-input-container{position:relative;flex:1;min-width:120px;margin:0;padding:0}#stackgazer .rule-type-prefix{position:absolute;left:0;top:0;bottom:0;color:var(--text-muted);font-size:10px;font-weight:500;pointer-events:none;z-index:0;background:var(--bg-tertiary);border-right:1px solid var(--border-secondary);padding:0;margin:0;line-height:1;display:flex;align-items:center;min-width:48px;justify-content:center}#stackgazer .rule-replacement-line .rule-type-prefix,#stackgazer .rule-while-container .rule-type-prefix{min-width:60px}#stackgazer .rule-input{background:transparent;color:var(--text-primary);border:none;border-radius:0;padding:1px 4px;font-size:12px;width:100%;outline:none;height:18px;line-height:16px}#stackgazer .skip-rule .rule-input,#stackgazer .trim-rule .rule-input,#stackgazer .fold-rule .rule-pattern-input{padding-left:52px}#stackgazer .fold-rule .rule-replacement-input,#stackgazer .fold-rule .rule-while-input{padding-left:64px}#stackgazer .unknown-rule .rule-json-input{width:100%;padding:2px 4px;font-size:11px;font-family:monospace;resize:vertical;min-height:36px}#stackgazer .rule-replacement-line{margin-top:1px;display:flex;gap:8px}#stackgazer .rule-replacement-line .rule-input-container:first-child{flex:1;max-width:250px}#stackgazer .rule-while-container{flex:1;min-width:120px}#stackgazer .rule-category-container{flex:1;min-width:150px}#stackgazer .match-rule .rule-pattern-input{padding-left:64px}#stackgazer .match-rule .rule-category-input{padding-left:32px}#stackgazer .fold-rule-content{flex:1;display:flex;flex-direction:column;gap:0px}#stackgazer .fold-rule .rule-controls{flex-wrap:nowrap;width:100%}#stackgazer .find-rule-content{flex:1;display:flex;flex-direction:column;gap:0px}#stackgazer .ancestry-modal{position:absolute;top:0;left:0;width:100%;height:100%;background:#000c;z-index:1000;padding:20px;box-sizing:border-box}#stackgazer .ancestry-modal-content{background:var(--bg-primary);border:1px solid var(--border-primary);border-radius:8px;width:95%;height:90%;max-width:none;margin:2.5% auto;display:flex;flex-direction:column;overflow:visible;box-shadow:0 4px 20px #00000080;position:relative}#stackgazer .ancestry-modal-header{padding:1rem;border-bottom:1px solid var(--border-primary);display:flex;justify-content:space-between;align-items:center}#stackgazer .ancestry-modal-title{margin:0;color:var(--text-primary)}#stackgazer .ancestry-modal-close{position:absolute;top:-18px;right:-18px;background:var(--bg-tertiary);border:1px solid var(--border-primary);border-radius:50%;color:var(--text-primary);font-size:24px;cursor:pointer;padding:0;width:36px;height:36px;display:flex;align-items:center;justify-content:center;z-index:20;transition:all .2s ease}#stackgazer .ancestry-modal-close:hover{background:var(--bg-quaternary);border-color:var(--accent-primary);transform:scale(1.1)}#stackgazer .ancestry-tree-container{flex:1;overflow:auto;padding:20px;background:var(--bg-secondary);position:relative;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}#stackgazer .ancestry-zoom-controls{position:absolute;top:20px;right:20px;display:flex;flex-direction:column;gap:5px;z-index:10}#stackgazer .ancestry-zoom-controls button{background:var(--bg-tertiary);border:1px solid var(--border-primary);color:var(--text-primary);padding:8px 12px;cursor:pointer;border-radius:4px;font-size:14px}#stackgazer .ancestry-zoom-controls button:hover{background:var(--bg-quaternary)}#stackgazer .ancestry-tree-svg{display:block;background:var(--bg-secondary, #2a2a2a);cursor:grab;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}#stackgazer .ancestry-tree-svg.grabbing{cursor:grabbing}#stackgazer .ancestry-node{cursor:pointer}#stackgazer .ancestry-node-id{cursor:pointer;text-decoration:underline}#stackgazer .ancestry-node-label{font-size:11px;text-align:center;line-height:1.2;word-wrap:break-word;overflow-wrap:break-word;-webkit-hyphens:auto;hyphens:auto;max-height:30px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}#stackgazer .ancestry-node-label.target{color:#000}#stackgazer .ancestry-node-label.normal{color:var(--text-muted, #999)}#stackgazer .ancestry-empty-state{color:var(--text-primary, #fff);text-align:center;padding:2rem;margin:0}#stackgazer .find-rule .rule-controls{flex-wrap:nowrap;width:100%}#stackgazer .skipwhile-rule-content{flex:1;display:flex;flex-direction:column;gap:0px}#stackgazer .skipwhile-rule .rule-controls{flex-wrap:nowrap;width:100%}#stackgazer .collapsible-group{border:1px solid var(--border-secondary);border-radius:4px;margin-bottom:16px}#stackgazer .rules-editor-header.collapsible-header{cursor:pointer;display:flex;align-items:center;gap:6px;padding:4px 8px;background:var(--bg-tertiary);border-radius:0;border-bottom:1px solid var(--border-secondary);-webkit-user-select:none;user-select:none;font-size:11px;font-weight:500;color:var(--text-muted);margin:0}#stackgazer .rules-editor-header.collapsible-header:hover{background:var(--bg-secondary);color:var(--text-secondary)}#stackgazer .expand-icon{font-size:10px;color:var(--text-muted);transition:transform .2s ease}#stackgazer .collapsible-header.collapsed-settings .expand-icon{transform:rotate(-90deg)}#stackgazer .collapsible-content{padding:0}#stackgazer .collapsible-content.collapsed-settings{display:none}#stackgazer .setting-description-prose{margin-bottom:16px}#stackgazer .setting-description-prose p{margin:0;font-size:12px;line-height:1.4;color:var(--text-secondary)}#stackgazer .setting-description-prose strong{color:var(--text-primary);font-weight:600}@media (max-width: 768px){#stackgazer .footer-buttons{flex-direction:column}#stackgazer .rule-controls{flex-direction:column;align-items:stretch;gap:4px}#stackgazer .rule-type-label{min-width:auto}#stackgazer .rule-input{min-width:auto;width:100%}}#stackgazer .settings-actions{padding:20px 25px;border-top:1px solid var(--border-primary);background:var(--bg-secondary);display:flex;gap:10px;justify-content:flex-end;border-radius:0 0 8px 8px;flex-shrink:0}#stackgazer .settings-reset-btn,#stackgazer .settings-save-btn{padding:8px 16px}#stackgazer .demo-link{color:var(--code-keyword);text-decoration:none;cursor:pointer;transition:color .2s ease,text-decoration .2s ease;font-size:14px}#stackgazer .demo-link:hover{color:var(--text-link-hover);text-decoration:underline}#stackgazer .hidden{display:none!important}#stackgazer .cursor-pointer{cursor:pointer}#stackgazer .main-content.filtered .filtered{display:none!important}#stackgazer .modal-visible{display:block!important}#stackgazer .modal-hidden{display:none!important}#stackgazer .file-section .header{cursor:pointer;display:flex;justify-content:space-between}#stackgazer .file-section .header .title{font-weight:700;font-size:14px;display:flex;align-items:center;gap:6px}#stackgazer .group-sub-header{font-size:1em;color:var(--text-primary);font-weight:500;margin-bottom:8px;display:flex;justify-content:space-between;padding:6px 12px;background-color:var(--border-primary);border-radius:3px}#stackgazer .group-sub-header-label{font-weight:700;font-size:1.2em;color:var(--text-primary);margin-top:4px}#stackgazer .group-sub-header-label.unlabeled{font-style:italic;color:var(--text-muted)}#stackgazer .group-sub-header-count{color:var(--text-secondary);font-size:.95em;font-weight:500}#stackgazer .group-sub-section{margin-top:6px}#stackgazer .demo-add-files,#stackgazer .demo-try-demo{font-size:14px;color:var(--text-muted)}#stackgazer .demo-add-files{margin-top:10px}#stackgazer .demo-try-demo{margin:20px 0 10px}#stackgazer .demo-section-divider{margin-top:25px;padding-top:5px;border-top:1px solid var(--border-secondary)}#stackgazer .demo-buttons{text-align:center;margin-top:10px;gap:20px;display:flex;justify-content:center}#stackgazer .custom-rules-section,#stackgazer .default-rules-section{margin:12px 0}#stackgazer .custom-rules-section h5,#stackgazer .default-rules-section h5{font-size:12px;font-weight:600;color:var(--text-primary);margin:0 0 6px}#stackgazer .default-rules-header{display:flex;align-items:center;justify-content:space-between;cursor:pointer;padding:2px 0;margin-bottom:6px}#stackgazer .default-rules-title{display:flex;align-items:center;gap:6px}#stackgazer .default-rules-title .expand-icon{font-size:10px;color:var(--text-muted);transition:transform .2s ease}#stackgazer .default-rules-section:has(.default-rules-content.collapsed-settings) .expand-icon{transform:rotate(-90deg)}#stackgazer .default-rules-section.settings-collapsed .expand-icon{transform:rotate(-90deg)}#stackgazer .default-rules-header h5{margin:0;transition:color .2s ease}#stackgazer .default-rules-header.disabled h5{color:var(--text-muted)}#stackgazer .default-rules-content{transition:all .2s ease}#stackgazer .default-rules-content.collapsed-settings,#stackgazer .custom-rules-content.collapsed-settings{display:none}#stackgazer .default-rules-textarea{background:var(--bg-tertiary);color:var(--text-muted);border-color:var(--border-secondary)}#stackgazer .toggle-switch{position:relative;width:34px;height:18px;display:inline-block}#stackgazer .toggle-switch input{opacity:0;width:0;height:0}#stackgazer .toggle-slider{position:absolute;cursor:pointer;inset:0;background-color:var(--border-secondary);transition:.2s;border-radius:18px}#stackgazer .toggle-slider:before{position:absolute;content:"";height:14px;width:14px;left:2px;bottom:2px;background-color:var(--bg-primary);transition:.2s;border-radius:50%}#stackgazer input:checked+.toggle-slider{background-color:var(--accent-primary)}#stackgazer input:checked+.toggle-slider:before{transform:translate(16px)}#stackgazer .copy-button{--copy-size: 28px;--copy-font: 16px;--copy-top: 50px;--copy-right: -14px;--copy-z: 10;--copy-hover-size: 40px;--copy-hover-font: 20px;--copy-hover-top: 44px;--copy-hover-right: -20px;position:absolute;background:var(--bg-quaternary);border:1px solid var(--border-secondary);border-radius:50%;width:var(--copy-size);height:var(--copy-size);font-size:var(--copy-font);color:var(--text-muted);cursor:pointer;opacity:0;transition:all .2s ease;display:flex;align-items:center;justify-content:center;top:var(--copy-top);right:var(--copy-right);z-index:var(--copy-z)}#stackgazer .copy-button.size-small{--copy-size: 18px;--copy-font: 10px;--copy-top: 40px;--copy-right: -25px;--copy-z: 5;--copy-hover-size: 26px;--copy-hover-font: 14px;--copy-hover-top: 36px;--copy-hover-right: -29px}#stackgazer .section.container-collapsed>.header>.copy-button{display:none}#stackgazer .section:hover>.header>.copy-button:not(.pinned),#stackgazer .goroutine-entry:hover>.copy-button:not(.pinned){opacity:.7}#stackgazer .copy-button:hover{background:var(--bg-quaternary);border-color:var(--border-primary);color:var(--text-primary);opacity:1!important;width:var(--copy-hover-size);height:var(--copy-hover-size);font-size:var(--copy-hover-font);top:var(--copy-hover-top);right:var(--copy-hover-right)}#stackgazer .copy-button:before{content:"";position:absolute;inset:-16px;border-radius:50%}#stackgazer .copy-button.size-small:hover{top:var(--copy-hover-top);right:var(--copy-hover-right)}#stackgazer .narrow-menu-btn,#stackgazer .narrow-filter-container,#stackgazer .narrow-controls,#stackgazer .narrow-controls-header,#stackgazer .narrow-close-btn,#stackgazer .narrow-back-btn{display:none!important}@media (max-width: 900px){#stackgazer .narrow-menu-btn,#stackgazer .narrow-filter-container,#stackgazer .narrow-controls,#stackgazer .narrow-controls-header,#stackgazer .narrow-close-btn{display:flex!important}#stackgazer .narrow-controls-header,#stackgazer .narrow-close-btn{display:block!important}#stackgazer .narrow-back-btn:not(:disabled){display:flex!important}#stackgazer .container{position:relative}#stackgazer .sidebar{position:fixed;top:0;left:-300px;height:100vh;z-index:1000;transition:left .3s ease;box-shadow:2px 0 10px #0000004d;overflow-y:auto;padding:20px 20px 80px;box-sizing:border-box}#stackgazer .sidebar.narrow-open{left:0}#stackgazer .sidebar-overlay{position:fixed;inset:0;background:var(--bg-overlay);z-index:999;opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s ease}#stackgazer .sidebar-overlay.active{opacity:1;visibility:visible}#stackgazer .main-content{width:100%}#stackgazer .view-controls-bar{flex-direction:column;gap:10px;padding:10px 15px}#stackgazer .narrow-filter-container{width:100%;order:-1;display:flex;gap:8px;align-items:center}#stackgazer .narrow-menu-btn{background:var(--accent-primary);border:none;border-radius:6px;color:#fff;font-size:16px;cursor:pointer;padding:8px 12px;transition:all .2s ease;flex-shrink:0}#stackgazer .narrow-menu-btn:hover{background:var(--accent-primary-hover);transform:scale(1.05)}#stackgazer .narrow-menu-btn.active{background:var(--accent-danger);transform:scale(.95)}#stackgazer .narrow-filter-input{flex:1;padding:8px 12px;background:var(--bg-quaternary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);font-family:inherit;font-size:14px}#stackgazer .narrow-filter-input:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .narrow-filter-input::placeholder{color:var(--text-muted)}#stackgazer .narrow-back-btn{position:fixed;bottom:20px;left:20px;width:44px;height:44px;background:var(--accent-primary);border:none;border-radius:50%;color:#fff;font-size:18px;cursor:pointer;box-shadow:0 4px 12px #0000004d;z-index:1002;transition:all .3s ease;display:flex;align-items:center;justify-content:center}#stackgazer .narrow-back-btn:hover:not(:disabled){background:var(--accent-primary-hover);transform:scale(1.1)}#stackgazer .narrow-back-btn:disabled{background:var(--border-secondary);cursor:not-allowed;opacity:.5}#stackgazer .view-controls-bar #expandAllBtn,#stackgazer .view-controls-bar #collapseAllBtn,#stackgazer .view-controls-bar #unpinAllBtn,#stackgazer .view-controls-bar #stackDisplayModeSelect,#stackgazer .view-controls-bar #backBtn{display:none}#stackgazer .view-controls-bar .left-controls,#stackgazer .view-controls-bar .right-controls{flex-wrap:wrap;gap:8px}#stackgazer .view-controls-bar .control-btn{font-size:12px;padding:6px 10px;min-width:auto}#stackgazer .view-controls-bar select{font-size:12px;padding:6px 8px}.narrow-controls{flex-direction:column;gap:10px;padding:15px;background:var(--bg-quaternary);border-radius:6px;margin-bottom:15px}#stackgazer .narrow-controls-row{display:flex;gap:8px;flex-wrap:wrap}#stackgazer .narrow-controls .control-btn{flex:1;min-width:80px;font-size:11px;padding:8px 12px}#stackgazer .narrow-select{width:100%;background:var(--bg-tertiary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);font-family:inherit;font-size:11px;padding:8px 12px}#stackgazer .narrow-select:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .narrow-close-btn{position:fixed;top:20px;left:-18px;background:var(--bg-primary);border:2px solid var(--border-secondary);border-radius:50%;color:var(--text-secondary);font-size:20px;cursor:pointer;width:36px;height:36px;display:flex;align-items:center;justify-content:center;z-index:1002;transition:left .3s ease,opacity .2s ease;box-shadow:0 2px 8px #00000026;opacity:0;visibility:hidden}#stackgazer .narrow-close-btn.visible{opacity:1;visibility:visible;left:282px}#stackgazer .narrow-close-btn:hover{background:var(--bg-secondary);color:var(--text-primary);border-color:var(--accent-primary);transform:scale(1.1);box-shadow:0 4px 12px #0003}#stackgazer .drop-zone{margin:10px}#stackgazer .drop-zone.has-content{padding:10px}}@media (max-width: 400px){#stackgazer .header{flex-wrap:wrap;align-items:flex-start;gap:4px}#stackgazer .header-right{width:100%;align-items:flex-start;margin-top:4px}#stackgazer .header .counts{margin-right:0;font-size:12px}#stackgazer .state-summary{font-size:11px}}#stackgazer .rule-validation-feedback{margin-top:8px;font-size:12px;line-height:1.4}#stackgazer .rule-errors,#stackgazer .rule-warnings{margin-bottom:4px}#stackgazer .rule-error-item{color:var(--accent-error);margin:2px 0;padding:2px 4px;background-color:var(--accent-error-bg, rgba(220, 53, 69, .1));border-radius:3px}#stackgazer .rule-warning-item{color:var(--accent-warning, #fd7e14);margin:2px 0;padding:2px 4px;background-color:var(--accent-warning-bg, rgba(253, 126, 20, .1));border-radius:3px}#stackgazer textarea.rule-error{border-color:var(--accent-error)!important;box-shadow:0 0 0 2px #dc354533}#stackgazer textarea.rule-warning{border-color:var(--accent-warning, #fd7e14)!important;box-shadow:0 0 0 2px #fd7e1433}#stackgazer .copy-notification{position:absolute;top:20px;right:20px;background:var(--accent-success);color:#fff;padding:8px 16px;border-radius:4px;font-size:12px;z-index:10000;pointer-events:none;opacity:0;transition:opacity .3s ease}#stackgazer .copy-notification.show{opacity:1}#stackgazer .loading-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:10001;pointer-events:auto}#stackgazer .loading-spinner{width:60px;height:60px;border:4px solid var(--bg-tertiary);border-top:4px solid var(--accent-primary);border-radius:50%;animation:spin 1s linear infinite}#stackgazer .loading-content{display:flex;flex-direction:column;align-items:center;gap:20px;color:var(--text-primary);background:var(--bg-secondary);padding:30px;border-radius:12px;border:1px solid var(--border-color);min-width:300px;text-align:center}#stackgazer .loading-message{font-size:16px;font-weight:500}#stackgazer .loading-details{font-size:14px;color:var(--text-secondary);opacity:.8}#stackgazer .loading-progress{width:100%;max-width:250px;height:8px;background:var(--bg-tertiary);border-radius:4px;overflow:hidden}#stackgazer .loading-progress-bar{height:100%;background:var(--accent-primary);border-radius:4px;width:0%;transition:width .3s ease}#stackgazer .loading-progress-indeterminate{height:100%;background:linear-gradient(90deg,transparent,var(--accent-primary),transparent);border-radius:4px;width:50%;animation:loading-slide 2s ease-in-out infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes loading-slide{0%{transform:translate(-100%)}to{transform:translate(200%)}}</style>
</head>

<body>
    <div id="stackgazer"></div>
    <script>
        // Initialize the app (StackgazerApp is made available globally by the bundled code)
        document.addEventListener('DOMContentLoaded', function() {
            // Add custom settings here.
            const app = new window.StackgazerApp("stackgazer", defaults => {
                return {
                    ...defaults,
                functionTrimPrefixes: ['github.com/cockroachdb/cockroach/pkg/'],
                fileTrimPrefixes: [
                    'bazel-out/k8-opt/bin/pkg/.*_go_proto_/', 
                    'github.com/cockroachdb/cockroach/'
                ],
                categorySkipRules: [
                    ...defaults.categorySkipRules,
                        'google.golang.org/grpc',
                        'util/stop', 'util/ctxgroup',    
                        'jobs.(*Registry).resumeJob',
                        'jobs.(*Registry).runJob',
                        'jobs.(*Registry).stepThroughStateMachine',
                        'kv/kvclient/rangefeed.(*RangeFeed).run', 
                        'kv/kvpb._', 
                        'rpc.NewServerEx',  
                        'rpc.internalClientAdapter', 
                        'rpc.makeInternalClientAdapter', 
                        'rpc.serverStreamInterceptorsChain', 
                        'rpc.kvAuth', 
                        'sql/flowinfra.(*FlowBase).StartInternal.func', 
                        'sql/execinfra.(*ProcessorBaseNoHelper).Run', 
                        'sql/execinfra.Run'
                ],
                nameSkipRules: [
                    ...defaults.nameSkipRules,
                        'rpc.NewContext.ClientInterceptor.func8',
                        'kv/bulk.(*CPUPacer).Pace',
                        'util/cidr.metricsConn.Read',
                        'server.(*Node).batchInternal'
                    ],
                nameFoldRules: [
                    ...defaults.nameFoldRules,
                    's|util/ctxgroup.Group.Wait,|waitgroup|',
                    's|util/ctxgroup.GroupWorkers,|waitgroup|',
                    's|util/ctxgroup.GoAndWait,|waitgroup|',
                    's|util/admission.(*WorkQueue).Admit,^(util/admission|kv/kvserver/kvadmission)|AC|',
                ],
                nameFindRules: [
                    ...defaults.nameFindRules,
                    's|kv/kvclient/kvcoord.(*DistSender).Send,^(kv/kvclient/kvcoord|kv\\.)|DistSender|',
                ],
                nameExtractionPatterns: [
                    ...defaults.nameExtractionPatterns,
                    's|pgwire\\.\\(\\*Server\\)\\.serveImpl.*?\\{0x1,\\s*0x2,\\s*\\{0x([0-9a-fA-F]+),|hex:n$1|',
                    's|pgwire\\.\\(\\*Server\\)\\.serveImpl.*?\\{0x0,\\s*0x4,\\s*\\{0x([0-9a-fA-F]+),|hex:n$1|',
                    's|# labels:.*?"n":"([0-9]+)"|n$1|',
                    's|tags=([^,\\s]+)|$1|',
                ]
                };
            });
            window.app = app;
            console.log('Stackgazer loaded: go ahead, gaze into the abyss.');

            // Listen for postMessage events from parent
            window.addEventListener('message', async (event) => {
                if (event.origin !== window.location.origin) return;

                if (event.data && event.data.type === 'LOAD_STACK_FILE') {
                    try {
                        // Use 'name' if provided, otherwise fall back to 'path'
                        const fileName = event.data.name || event.data.path;
                        console.log('Stackgazer: Loading stack file:', fileName);
                        const file = new File([event.data.content], fileName, {
                            type: 'text/plain',
                        });
                        await app.handleFiles([file]);
                    } catch (error) {
                        console.error('Stackgazer: Error processing stack file:', event.data.path, error);
                    }
                }
            });
        });
    </script>
</body>

</html>